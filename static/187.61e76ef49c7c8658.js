"use strict";(self.webpackChunkharbor_portal=self.webpackChunkharbor_portal||[]).push([[187],{187:(K,f,r)=>{r.r(f),r.d(f,{ProjectScannerModule:()=>F});var h=r(858),Z=r(6296),c=r(9375),N=r(8746),g=r(268),S=r(2421),p=r(3526),C=r(4128),n=r(4650),v=r(9151),x=r(2443),A=r(2466),T=r(5266),m=r(4006),b=r(6895);function E(t,a){1&t&&(n.TgZ(0,"div",13),n._UZ(1,"span",14),n.qZA())}function O(t,a){1&t&&(n.TgZ(0,"label",22),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&t&&(n.xp6(1),n.Oqu(n.lcZ(2,1,"SCANNER.SCANNER")))}function I(t,a){if(1&t){const e=n.EpF();n.TgZ(0,"button",23),n.NdJ("click",function(){n.CHM(e);const i=n.oxw(2);return n.KtG(i.open())}),n._uU(1),n.ALo(2,"translate"),n.qZA()}2&t&&(n.xp6(1),n.hij(" ",n.lcZ(2,1,"SCANNER.EDIT")," "))}function q(t,a){1&t&&(n.TgZ(0,"label",24),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&t&&(n.xp6(1),n.Oqu(n.lcZ(2,1,"SCANNER.NOT_AVAILABLE")))}function L(t,a){1&t&&(n.TgZ(0,"label",24),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&t&&(n.xp6(1),n.Oqu(n.lcZ(2,1,"SCANNER.NO_PROJECT_SCANNER")))}function U(t,a){1&t&&(n.TgZ(0,"span",34),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&t&&(n.xp6(1),n.Oqu(n.lcZ(2,1,"SCANNER.DISABLED")))}function J(t,a){1&t&&(n.TgZ(0,"span",35),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&t&&(n.xp6(1),n.Oqu(n.lcZ(2,1,"SCANNER.UNHEALTHY")))}function M(t,a){1&t&&(n.TgZ(0,"span",36),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&t&&(n.xp6(1),n.Oqu(n.lcZ(2,1,"SCANNER.HEALTHY")))}function R(t,a){if(1&t&&(n.TgZ(0,"div",16)(1,"label",31),n._uU(2),n.ALo(3,"translate"),n.qZA(),n.TgZ(4,"div",18)(5,"div",25),n._UZ(6,"input",37),n.qZA()()()),2&t){const e=n.oxw(3);n.xp6(2),n.Oqu(n.lcZ(3,2,"SCANNER.ADAPTER")),n.xp6(4),n.Q6J("ngModel",null==e.scanner?null:e.scanner.adapter)}}function y(t,a){if(1&t&&(n.TgZ(0,"div",16)(1,"label",31),n._uU(2),n.ALo(3,"translate"),n.qZA(),n.TgZ(4,"div",18)(5,"div",25),n._UZ(6,"input",38),n.qZA()()()),2&t){const e=n.oxw(3);n.xp6(2),n.Oqu(n.lcZ(3,2,"SCANNER.VENDOR")),n.xp6(4),n.Q6J("ngModel",null==e.scanner?null:e.scanner.vendor)}}function P(t,a){if(1&t&&(n.TgZ(0,"div",16)(1,"label",31),n._uU(2),n.ALo(3,"translate"),n.qZA(),n.TgZ(4,"div",18)(5,"div",25),n._UZ(6,"input",39),n.qZA()()()),2&t){const e=n.oxw(3);n.xp6(2),n.Oqu(n.lcZ(3,2,"SCANNER.VERSION")),n.xp6(4),n.Q6J("ngModel",null==e.scanner?null:e.scanner.version)}}function j(t,a){if(1&t&&(n.ynx(0),n.TgZ(1,"div",16)(2,"label",22),n._uU(3),n.ALo(4,"translate"),n.qZA(),n.TgZ(5,"div",18)(6,"div",25)(7,"div",26)(8,"span",27),n._uU(9),n.qZA(),n.YNc(10,U,3,3,"span",28),n.YNc(11,J,3,3,"span",29),n.YNc(12,M,3,3,"span",30),n.qZA()()()(),n.TgZ(13,"div",16)(14,"label",31),n._uU(15),n.ALo(16,"translate"),n.qZA(),n.TgZ(17,"div",18)(18,"div",25),n._UZ(19,"input",32),n.qZA()()(),n.YNc(20,R,7,4,"div",33),n.YNc(21,y,7,4,"div",33),n.YNc(22,P,7,4,"div",33),n.BQk()),2&t){const e=n.oxw(2);n.xp6(3),n.Oqu(n.lcZ(4,10,"SCANNER.NAME")),n.xp6(6),n.Oqu(null==e.scanner?null:e.scanner.name),n.xp6(1),n.Q6J("ngIf",null==e.scanner?null:e.scanner.disabled),n.xp6(1),n.Q6J("ngIf","unhealthy"===(null==e.scanner?null:e.scanner.health)),n.xp6(1),n.Q6J("ngIf","healthy"===(null==e.scanner?null:e.scanner.health)),n.xp6(3),n.Oqu(n.lcZ(16,12,"SCANNER.ENDPOINT")),n.xp6(4),n.Q6J("ngModel",null==e.scanner?null:e.scanner.url),n.xp6(1),n.Q6J("ngIf",null==e.scanner?null:e.scanner.adapter),n.xp6(1),n.Q6J("ngIf",null==e.scanner?null:e.scanner.vendor),n.xp6(1),n.Q6J("ngIf",null==e.scanner?null:e.scanner.version)}}function Q(t,a){if(1&t){const e=n.EpF();n.TgZ(0,"button",40),n.NdJ("click",function(){n.CHM(e);const i=n.oxw(2);return n.KtG(i.open())}),n._uU(1),n.ALo(2,"translate"),n.qZA()}2&t&&(n.xp6(1),n.hij(" ",n.lcZ(2,1,"SCANNER.SELECT_SCANNER")," "))}function D(t,a){if(1&t&&(n.TgZ(0,"div",15)(1,"div",16),n.YNc(2,O,3,3,"label",17),n.TgZ(3,"div",18),n.YNc(4,I,3,3,"button",19),n.YNc(5,q,3,3,"label",20),n.YNc(6,L,3,3,"label",20),n.qZA()(),n.YNc(7,j,23,14,"ng-container",8),n.YNc(8,Q,3,3,"button",21),n.qZA()),2&t){const e=n.oxw();n.xp6(2),n.Q6J("ngIf",!e.scanner),n.xp6(2),n.Q6J("ngIf",!e.scanner&&e.hasCreatePermission&&e.scanners&&e.scanners.length>0),n.xp6(1),n.Q6J("ngIf",!e.scanner&&e.hasCreatePermission&&!(e.scanners&&e.scanners.length>0)),n.xp6(1),n.Q6J("ngIf",!e.scanner&&!e.hasCreatePermission),n.xp6(1),n.Q6J("ngIf",e.scanner),n.xp6(1),n.Q6J("ngIf",e.hasCreatePermission&&e.scanners&&e.scanners.length>0)}}function Y(t,a){if(1&t&&(n.TgZ(0,"span",44),n._uU(1),n.qZA()),2&t){const e=n.oxw().$implicit;n.xp6(1),n.Oqu(e.is_default)}}function w(t,a){if(1&t&&(n.TgZ(0,"span"),n._uU(1),n.qZA()),2&t){const e=n.oxw().$implicit;n.xp6(1),n.Oqu(e.is_default)}}function H(t,a){if(1&t&&(n.TgZ(0,"clr-dg-row",41)(1,"clr-dg-cell"),n._uU(2),n.qZA(),n.TgZ(3,"clr-dg-cell"),n._uU(4),n.qZA(),n.TgZ(5,"clr-dg-cell",42),n.YNc(6,Y,2,1,"span",43),n.YNc(7,w,2,1,"span",8),n.qZA(),n.TgZ(8,"clr-dg-cell"),n._uU(9),n.qZA()()),2&t){const e=a.$implicit;n.Q6J("clrDgItem",e),n.xp6(2),n.Oqu(e.name),n.xp6(2),n.Oqu(e.url),n.xp6(2),n.Q6J("ngIf",e.is_default),n.xp6(1),n.Q6J("ngIf",!e.is_default),n.xp6(2),n.Oqu(e.description)}}function B(t,a){if(1&t&&(n.TgZ(0,"span"),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&t){const e=n.oxw();n.xp6(1),n.AsE("1 - ",null==e.scanners?null:e.scanners.length," ",n.lcZ(2,2,"WEBHOOK.OF")," ")}}const z=[{path:"",component:(()=>{class t{constructor(e,l,i,o,d,u){this.msgHandler=e,this.errorHandler=l,this.route=i,this.userPermissionService=o,this.translate=d,this.projectService=u,this.loading=!1,this.opened=!1,this.saveBtnState=c.xp5.DEFAULT,this.onSaving=!1,this.hasCreatePermission=!1}ngOnInit(){this.projectId=+this.route.snapshot.parent.parent.params.id,this.getPermission(),this.init()}getPermission(){this.projectId&&this.userPermissionService.getPermission(this.projectId,g._W.SCANNER.KEY,g._W.SCANNER.VALUE.CREATE).subscribe(e=>{this.hasCreatePermission=e,this.hasCreatePermission&&this.getScanners()})}init(){this.getScanner()}getScanner(e){this.loading=!0,this.projectService.getScannerOfProject({projectNameOrId:this.projectId.toString()}).pipe((0,N.x)(()=>this.loading=!1)).subscribe(l=>{l&&"{}"!==JSON.stringify(l)&&(this.scanner=l,e&&"healthy"!==this.scanner.health&&this.translate.get("SCANNER.SET_UNHEALTHY_SCANNER",{name:this.scanner.name}).subscribe(i=>{this.errorHandler.warning(i)}))},l=>{this.errorHandler.error(l)})}getScanners(){this.projectId&&this.projectService.listScannerCandidatesOfProjectResponse({projectNameOrId:this.projectId.toString(),page:1,pageSize:p.L8}).subscribe(e=>{if(e.headers){const l=e.headers.get("X-Total-Count"),i=parseInt(l,0);let o=e.body||[];if(i<=p.L8)o&&o.length>0&&(this.scanners=o.filter(d=>!d.disabled));else{const d=Math.ceil(i/p.L8),u=[];for(let s=2;s<=d;s++)u.push(this.projectService.listScannerCandidatesOfProject({page:s,pageSize:p.L8,projectNameOrId:this.projectId.toString()}));(0,C.D)(u).subscribe(s=>{s&&s.length&&(s.forEach(_=>{o=o.concat(_)}),this.scanners=o.filter(_=>!_.disabled))})}}})}close(){this.opened=!1,this.selectedScanner=null}open(){this.opened=!0,this.inlineAlert.close(),this.scanners.forEach(e=>{this.scanner&&e.uuid===this.scanner.uuid&&(this.selectedScanner=e)})}get valid(){return this.selectedScanner&&!(this.scanner&&this.scanner.uuid===this.selectedScanner.uuid)}save(){this.saveBtnState=c.xp5.LOADING,this.projectService.setScannerOfProject({projectNameOrId:this.projectId.toString(),payload:{uuid:this.selectedScanner.uuid}}).subscribe(e=>{this.close(),this.msgHandler.showSuccess("Update Success"),this.getScanner(!0),this.saveBtnState=c.xp5.SUCCESS},e=>{this.inlineAlert.showInlineError(e),this.saveBtnState=c.xp5.ERROR})}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(v.d),n.Y36(x.q),n.Y36(h.gz),n.Y36(g.Hx),n.Y36(A.sK),n.Y36(T.Y))},t.\u0275cmp=n.Xpm({type:t,selectors:[["scanner"]],viewQuery:function(e,l){if(1&e&&n.Gf(S.l,5),2&e){let i;n.iGM(i=n.CRH())&&(l.inlineAlert=i.first)}},decls:34,vars:39,consts:[["class","clr-row mt-2 center",4,"ngIf"],["class","clr-form clr-form-horizontal",4,"ngIf"],[3,"clrModalSize","clrModalOpen","clrModalStaticBackdrop","clrModalClosable","clrModalOpenChange"],[1,"modal-title"],[1,"modal-body","body-format"],[3,"clrDgSingleSelected","clrDgSingleSelectedChange"],[3,"clrDgField"],[3,"clrDgItem",4,"clrDgItems","clrDgItemsOf"],[4,"ngIf"],[3,"clrDgPageSize"],[1,"modal-footer"],["id","cancel","type","button",1,"btn","btn-outline",3,"click"],["id","save-scanner","type","button",1,"btn","btn-primary",3,"clrLoading","disabled","click"],[1,"clr-row","mt-2","center"],[1,"spinner","spinner-md"],[1,"clr-form","clr-form-horizontal"],[1,"clr-form-control"],["class","clr-control-label name",4,"ngIf"],[1,"clr-control-container"],["id","edit-scanner-copy","class","btn btn-primary",3,"click",4,"ngIf"],["class","name",4,"ngIf"],["id","edit-scanner","type","button","class","btn btn-secondary mt-1",3,"click",4,"ngIf"],[1,"clr-control-label","name"],["id","edit-scanner-copy",1,"btn","btn-primary",3,"click"],[1,"name"],[1,"clr-input-wrapper"],[1,"clr-input-wrapper","name"],["id","scanner-name",1,"scanner-name"],["class","label label-warning ml-1",4,"ngIf"],["class","label label-danger ml-1",4,"ngIf"],["class","label label-success ml-1",4,"ngIf"],[1,"clr-control-label"],["readonly","","type","text","id","scanner-endpoint","autocomplete","off",1,"clr-input","width-240",3,"ngModel"],["class","clr-form-control",4,"ngIf"],[1,"label","label-warning","ml-1"],[1,"label","label-danger","ml-1"],[1,"label","label-success","ml-1"],["readonly","","type","text","id","scanner-scanner","autocomplete","off",1,"clr-input","width-240",3,"ngModel"],["readonly","","type","text","id","scanner-vendor","autocomplete","off",1,"clr-input","width-240",3,"ngModel"],["readonly","","type","text","id","scanner-version","autocomplete","off",1,"clr-input","width-240",3,"ngModel"],["id","edit-scanner","type","button",1,"btn","btn-secondary","mt-1",3,"click"],[3,"clrDgItem"],[1,"position-relative"],["class","label label-info",4,"ngIf"],[1,"label","label-info"]],template:function(e,l){1&e&&(n.YNc(0,E,2,0,"div",0),n.YNc(1,D,9,6,"div",1),n.TgZ(2,"clr-modal",2),n.NdJ("clrModalOpenChange",function(o){return l.opened=o}),n.TgZ(3,"h3",3),n._uU(4),n.ALo(5,"translate"),n.qZA(),n.TgZ(6,"div",4),n._UZ(7,"inline-alert",3),n.TgZ(8,"clr-datagrid",5),n.NdJ("clrDgSingleSelectedChange",function(o){return l.selectedScanner=o}),n.TgZ(9,"clr-dg-column",6),n._uU(10),n.ALo(11,"translate"),n.qZA(),n.TgZ(12,"clr-dg-column",6),n._uU(13),n.ALo(14,"translate"),n.qZA(),n.TgZ(15,"clr-dg-column"),n._uU(16),n.ALo(17,"translate"),n.qZA(),n.TgZ(18,"clr-dg-column"),n._uU(19),n.ALo(20,"translate"),n.qZA(),n.YNc(21,H,10,6,"clr-dg-row",7),n.TgZ(22,"clr-dg-footer"),n.YNc(23,B,3,4,"span",8),n._uU(24),n.ALo(25,"translate"),n._UZ(26,"clr-dg-pagination",9),n.qZA()()(),n.TgZ(27,"div",10)(28,"button",11),n.NdJ("click",function(){return l.close()}),n._uU(29),n.ALo(30,"translate"),n.qZA(),n.TgZ(31,"button",12),n.NdJ("click",function(){return l.save()}),n._uU(32),n.ALo(33,"translate"),n.qZA()()()),2&e&&(n.Q6J("ngIf",l.loading),n.xp6(1),n.Q6J("ngIf",!l.loading),n.xp6(1),n.Q6J("clrModalSize","xl")("clrModalOpen",l.opened)("clrModalStaticBackdrop",!0)("clrModalClosable",!1),n.xp6(2),n.Oqu(n.lcZ(5,23,"SCANNER.SELECT_SCANNER")),n.xp6(4),n.Q6J("clrDgSingleSelected",l.selectedScanner),n.xp6(1),n.Q6J("clrDgField","name"),n.xp6(1),n.Oqu(n.lcZ(11,25,"SCANNER.NAME")),n.xp6(2),n.Q6J("clrDgField","url"),n.xp6(1),n.Oqu(n.lcZ(14,27,"SCANNER.ENDPOINT")),n.xp6(3),n.Oqu(n.lcZ(17,29,"SCANNER.DEFAULT")),n.xp6(3),n.Oqu(n.lcZ(20,31,"SCANNER.DESCRIPTION")),n.xp6(2),n.Q6J("clrDgItemsOf",l.scanners),n.xp6(2),n.Q6J("ngIf",(null==l.scanners?null:l.scanners.length)>0),n.xp6(1),n.AsE(" ",null==l.scanners?null:l.scanners.length," ",n.lcZ(25,33,"WEBHOOK.ITEMS")," "),n.xp6(2),n.Q6J("clrDgPageSize",10),n.xp6(3),n.hij(" ",n.lcZ(30,35,"BUTTON.CANCEL")," "),n.xp6(2),n.Q6J("clrLoading",l.saveBtnState)("disabled",!l.valid),n.xp6(1),n.hij(" ",n.lcZ(33,37,"BUTTON.OK")," "))},dependencies:[m.Fj,m.JJ,m.On,c.C9t,c.m4W,c.f6,c.Z4N,c.fv_,c.dRQ,c.Ltv,c.PDs,c.KHL,c.Gcc,c.jND,c.Nh1,c.dml,c.K8c,c.qAN,c.VLi,c.cCV,c.MPb,c.MgK,b.O5,S.l,A.X$],styles:[".scanner-name[_ngcontent-%COMP%]{height:1rem;display:inline-block;padding:0 .25rem;max-height:1rem;font-size:.5417rem}.edit[_ngcontent-%COMP%]{margin-top:-5px;margin-left:-8px;font-size:.58rem}.width-240[_ngcontent-%COMP%]{width:240px}.center[_ngcontent-%COMP%]{justify-content:center;align-items:center}.clr-form-control[_ngcontent-%COMP%]{margin-top:.75rem!important}.name[_ngcontent-%COMP%]{height:1.75rem;line-height:1.75rem}"]}),t})()}];let F=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=n.oAB({type:t}),t.\u0275inj=n.cJS({imports:[h.Bz.forChild(z),Z.m]}),t})()}}]);