"use strict";(self.webpackChunkharbor_portal=self.webpackChunkharbor_portal||[]).push([[1659],{1659:(Z,P,o)=>{o.r(P),o.d(P,{UserModule:()=>te});var a=o(6296),T=o(4128),v=o(9646),e=o(4650),A=o(7954),m=o(2421),U=o(1992),_=o(4373),C=o(9151),s=o(9375),u=o(2466);let c=(()=>{class i{constructor(n,t,r){this.session=n,this.userService=t,this.msgHandler=r,this.opened=!1,this.onGoing=!1,this.formValueChanged=!1,this.addNew=new e.vpe}getNewUser(){return this.newUserForm.getData()}get inProgress(){return this.onGoing}get isValid(){return this.newUserForm.isValid&&null==this.error}formValueChange(n){null!=this.error&&(this.error=null),this.formValueChanged=!0,this.inlineAlert.close()}open(){this.newUserForm.reset(),this.formValueChanged=!1,this.onGoing=!1,this.error=null,this.inlineAlert.close(),this.opened=!0}close(){this.formValueChanged?this.newUserForm.isEmpty()?this.opened=!1:this.inlineAlert.showInlineConfirmation({message:"ALERT.FORM_CHANGE_CONFIRMATION"}):this.opened=!1}confirmCancel(n){this.opened=!1}create(){if(!this.isValid)return;let n=this.getNewUser();if(!n)return;let t=this.session.getCurrentUser();!t||!t.has_admin_role||(this.onGoing=!0,this.userService.addUser(n).subscribe(()=>{this.onGoing=!1,this.addNew.emit(n),this.opened=!1,this.msgHandler.showSuccess("USER.SAVE_SUCCESS")},r=>{this.onGoing=!1,this.error=r,this.msgHandler.isAppLevel(r)?(this.msgHandler.handleError(r),this.opened=!1):this.inlineAlert.showInlineError(r)}))}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(U.m),e.Y36(_.K),e.Y36(C.d))},i.\u0275cmp=e.Xpm({type:i,selectors:[["new-user-modal"]],viewQuery:function(n,t){if(1&n&&(e.Gf(A.T,7),e.Gf(m.l,5)),2&n){let r;e.iGM(r=e.CRH())&&(t.newUserForm=r.first),e.iGM(r=e.CRH())&&(t.inlineAlert=r.first)}},outputs:{addNew:"addNew"},decls:15,vars:14,consts:[[3,"clrModalOpen","clrModalStaticBackdrop","clrModalClosable","clrModalOpenChange"],[1,"modal-title"],[1,"modal-title",3,"confirmEvt"],[1,"modal-body","body-format"],[3,"valueChange"],[1,"modal-footer"],[1,"spinner","spinner-inline","loading-top",3,"hidden"],["type","button",1,"btn","btn-outline",3,"click"],["type","button","id","save-button",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,t){1&n&&(e.TgZ(0,"clr-modal",0),e.NdJ("clrModalOpenChange",function(l){return t.opened=l}),e.TgZ(1,"h3",1),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"inline-alert",2),e.NdJ("confirmEvt",function(l){return t.confirmCancel(l)}),e.qZA(),e.TgZ(5,"div",3)(6,"new-user-form",4),e.NdJ("valueChange",function(l){return t.formValueChange(l)}),e.qZA()(),e.TgZ(7,"div",5),e._UZ(8,"span",6),e.TgZ(9,"button",7),e.NdJ("click",function(){return t.close()}),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"button",8),e.NdJ("click",function(){return t.create()}),e._uU(13),e.ALo(14,"translate"),e.qZA()()()),2&n&&(e.Q6J("clrModalOpen",t.opened)("clrModalStaticBackdrop",!0)("clrModalClosable",!1),e.xp6(2),e.Oqu(e.lcZ(3,8,"USER.ADD_USER_TITLE")),e.xp6(6),e.Q6J("hidden",!1===t.inProgress),e.xp6(2),e.hij(" ",e.lcZ(11,10,"BUTTON.CANCEL")," "),e.xp6(2),e.Q6J("disabled",!t.isValid||t.inProgress),e.xp6(1),e.hij(" ",e.lcZ(14,12,"BUTTON.OK")," "))},dependencies:[s.qAN,s.VLi,m.l,A.T,u.X$],styles:[".form-group-override[_ngcontent-%COMP%]{padding-left:170px!important}.form-group-label-override[_ngcontent-%COMP%]{font-size:14px;font-weight:400}.sub-label-for-input[_ngcontent-%COMP%]{position:absolute;top:26px;font-size:10px;font-weight:400;line-height:12px;left:170px}.body-format[_ngcontent-%COMP%]{overflow-y:hidden}.loading-top[_ngcontent-%COMP%]{top:8px}",".modal-title{padding-bottom:0}  .modal-header .modal-title{padding:0}"]}),i})();var p=o(4050),h=o(4006),w=o(6895);const b=["resetPwdForm"];function I(i,d){if(1&i){const n=e.EpF();e.TgZ(0,"clr-icon",23),e.NdJ("click",function(){e.CHM(n);const r=e.oxw();return e.KtG(r.showNewPwd=!r.showNewPwd)}),e.qZA()}}function R(i,d){if(1&i){const n=e.EpF();e.TgZ(0,"clr-icon",24),e.NdJ("click",function(){e.CHM(n);const r=e.oxw();return e.KtG(r.showNewPwd=!r.showNewPwd)}),e.qZA()}}function D(i,d){1&i&&(e.TgZ(0,"clr-control-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"TOOLTIP.PASSWORD")," "))}function y(i,d){if(1&i){const n=e.EpF();e.TgZ(0,"clr-icon",23),e.NdJ("click",function(){e.CHM(n);const r=e.oxw();return e.KtG(r.showConfirmPwd=!r.showConfirmPwd)}),e.qZA()}}function L(i,d){if(1&i){const n=e.EpF();e.TgZ(0,"clr-icon",24),e.NdJ("click",function(){e.CHM(n);const r=e.oxw();return e.KtG(r.showConfirmPwd=!r.showConfirmPwd)}),e.qZA()}}function x(i,d){1&i&&(e.TgZ(0,"clr-control-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"TOOLTIP.CONFIRM_PWD")," "))}let S=(()=>{class i{constructor(n,t,r,l){this.userService=n,this.msgHandler=t,this.translateService=r,this.ref=l,this.showNewPwd=!1,this.showConfirmPwd=!1,this.opened=!1,this.onGoing=!1,this.password="",this.validationState={newPassword:!0,reNewPassword:!0},this.confirmPwd=""}get showProgress(){return this.onGoing}get isValid(){return this.resetPwdForm&&this.resetPwdForm.valid&&this.samePassword()}getValidationState(n){return this.validationState&&this.validationState[n]}confirmCancel(n){this.opened=!1}open(n){this.showConfirmPwd=!1,this.showNewPwd=!1,this.onGoing=!1,this.validationState={newPassword:!0,reNewPassword:!0},this.resetPwdForm.resetForm(),this.inlineAlert.close(),this.userId=n,this.opened=!0}close(){this.password||this.confirmPwd?this.inlineAlert.showInlineConfirmation({message:"ALERT.FORM_CHANGE_CONFIRMATION"}):this.opened=!1}send(){!this.password||!this.confirmPwd||!this.isValid||(this.onGoing=!0,this.userService.changePassword(this.userId,this.password,this.confirmPwd).subscribe(()=>{this.onGoing=!1,this.opened=!1,this.msgHandler.showSuccess("USER.RESET_OK");let n=setInterval(()=>this.ref.markForCheck(),100);setTimeout(()=>clearInterval(n),2e3)},n=>{this.onGoing=!1,400===n.status?this.translateService.get("USER.EXISTING_PASSWORD").subscribe(r=>{this.inlineAlert.showInlineError(r)}):this.inlineAlert.showInlineError(n);let t=setInterval(()=>this.ref.markForCheck(),100);setTimeout(()=>clearInterval(t),2e3)}))}handleValidation(n,t){t?(this.validationState[n]=this.getControlValidationState(n),this.validationState[n]&&(this.validationState.reNewPassword=this.samePassword())):this.validationState[n]=!0}getControlValidationState(n){if(this.resetPwdForm){let t=this.resetPwdForm.controls[n];if(t)return t.valid}return!1}samePassword(){if(this.resetPwdForm){let n=this.resetPwdForm.controls.newPassword,t=this.resetPwdForm.controls.reNewPassword;if(n&&t)return n.value===t.value}return!1}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(_.K),e.Y36(C.d),e.Y36(u.sK),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["change-password"]],viewQuery:function(n,t){if(1&n&&(e.Gf(b,5),e.Gf(m.l,5)),2&n){let r;e.iGM(r=e.CRH())&&(t.resetPwdForm=r.first),e.iGM(r=e.CRH())&&(t.inlineAlert=r.first)}},decls:42,vars:40,consts:[[3,"clrModalOpen","clrModalStaticBackdrop","clrModalClosable","clrModalOpenChange"],[1,"modal-title"],[1,"modal-title",3,"confirmEvt"],[1,"modal-body","body-format"],[1,"clr-form","clr-form-horizontal"],["resetPwdForm","ngForm"],[1,"clr-form-control"],["for","newPassword",1,"clr-control-label","required"],[1,"clr-control-container"],[1,"clr-input-wrapper"],["id","newPassword","required","","pattern","^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\\s).{8,128}$","name","newPassword","size","25",1,"clr-input","pwd-input",3,"type","placeholder","ngModel","ngModelChange","input","blur"],["newPassInput","ngModel"],["shape","eye","class","pw-eye",3,"click",4,"ngIf"],["shape","eye-hide","class","pw-eye",3,"click",4,"ngIf"],["shape","exclamation-circle",1,"clr-validate-icon"],[4,"ngIf"],["for","reNewPassword",1,"clr-control-label","required"],["id","reNewPassword","required","","pattern","^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\\s).{8,128}$","name","reNewPassword","size","25",1,"clr-input","pwd-input",3,"type","placeholder","ngModel","ngModelChange","input","blur"],["reNewPassInput",""],[1,"modal-footer"],[1,"spinner","spinner-inline","loading-top",3,"hidden"],["type","button",1,"btn","btn-outline",3,"click"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["shape","eye",1,"pw-eye",3,"click"],["shape","eye-hide",1,"pw-eye",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"clr-modal",0),e.NdJ("clrModalOpenChange",function(l){return t.opened=l}),e.TgZ(1,"h3",1),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"inline-alert",2),e.NdJ("confirmEvt",function(l){return t.confirmCancel(l)}),e.qZA(),e.TgZ(5,"div",3)(6,"form",4,5)(8,"div",6)(9,"label",7),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"div",8)(13,"div",9)(14,"input",10,11),e.NdJ("ngModelChange",function(l){return t.password=l})("input",function(){return t.handleValidation("newPassword",!1)})("blur",function(){return t.handleValidation("newPassword",!0)}),e.ALo(16,"translate"),e.qZA(),e.YNc(17,I,1,0,"clr-icon",12),e.YNc(18,R,1,0,"clr-icon",13),e._UZ(19,"clr-icon",14),e.qZA(),e.YNc(20,D,3,3,"clr-control-error",15),e.qZA()(),e.TgZ(21,"div",6)(22,"label",16),e._uU(23),e.ALo(24,"translate"),e.qZA(),e.TgZ(25,"div",8)(26,"div",9)(27,"input",17,18),e.NdJ("ngModelChange",function(l){return t.confirmPwd=l})("input",function(){return t.handleValidation("reNewPassword",!1)})("blur",function(){return t.handleValidation("reNewPassword",!0)}),e.ALo(29,"translate"),e.qZA(),e.YNc(30,y,1,0,"clr-icon",12),e.YNc(31,L,1,0,"clr-icon",13),e._UZ(32,"clr-icon",14),e.qZA(),e.YNc(33,x,3,3,"clr-control-error",15),e.qZA()()()(),e.TgZ(34,"div",19),e._UZ(35,"span",20),e.TgZ(36,"button",21),e.NdJ("click",function(){return t.close()}),e._uU(37),e.ALo(38,"translate"),e.qZA(),e.TgZ(39,"button",22),e.NdJ("click",function(){return t.send()}),e._uU(40),e.ALo(41,"translate"),e.qZA()()()),2&n&&(e.Q6J("clrModalOpen",t.opened)("clrModalStaticBackdrop",!0)("clrModalClosable",!1),e.xp6(2),e.Oqu(e.lcZ(3,26,"RESET_PWD.TITLE")),e.xp6(8),e.Oqu(e.lcZ(11,28,"CHANGE_PWD.NEW_PWD")),e.xp6(2),e.ekj("clr-error",!t.getValidationState("newPassword")),e.xp6(2),e.s9C("placeholder",e.lcZ(16,30,"PLACEHOLDER.NEW_PWD")),e.Q6J("type",t.showNewPwd?"text":"password")("ngModel",t.password),e.xp6(3),e.Q6J("ngIf",!t.showNewPwd),e.xp6(1),e.Q6J("ngIf",t.showNewPwd),e.xp6(2),e.Q6J("ngIf",!t.getValidationState("newPassword")),e.xp6(3),e.Oqu(e.lcZ(24,32,"CHANGE_PWD.CONFIRM_PWD")),e.xp6(2),e.ekj("clr-error",!t.getValidationState("reNewPassword")),e.xp6(2),e.s9C("placeholder",e.lcZ(29,34,"PLACEHOLDER.CONFIRM_PWD")),e.Q6J("type",t.showConfirmPwd?"text":"password")("ngModel",t.confirmPwd),e.xp6(3),e.Q6J("ngIf",!t.showConfirmPwd),e.xp6(1),e.Q6J("ngIf",t.showConfirmPwd),e.xp6(2),e.Q6J("ngIf",!t.getValidationState("reNewPassword")),e.xp6(2),e.Q6J("hidden",!1===t.showProgress),e.xp6(2),e.hij(" ",e.lcZ(38,36,"BUTTON.CANCEL")," "),e.xp6(2),e.Q6J("disabled",!t.isValid||t.showProgress),e.xp6(1),e.hij(" ",e.lcZ(41,38,"BUTTON.OK")," "))},dependencies:[h._Y,h.Fj,h.JJ,h.JL,h.Q7,h.c5,h.On,h.F,s.qvL,s.qAN,s.VLi,s.MgK,s.VqA,w.O5,m.l,u.X$],styles:[".form[_ngcontent-%COMP%]   .form-block[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   .form-block[_ngcontent-%COMP%]{margin:.5rem 0 2rem}.pw-eye[_ngcontent-%COMP%]{margin-left:-20px;margin-right:8px;cursor:pointer}.pwd-input[_ngcontent-%COMP%]{padding-right:26px}",".form-group-override[_ngcontent-%COMP%]{padding-left:170px!important}.form-group-label-override[_ngcontent-%COMP%]{font-size:14px;font-weight:400}.sub-label-for-input[_ngcontent-%COMP%]{position:absolute;top:26px;font-size:10px;font-weight:400;line-height:12px;left:170px}.body-format[_ngcontent-%COMP%]{overflow-y:hidden}.loading-top[_ngcontent-%COMP%]{top:8px}"]}),i})();var N=o(4004),F=o(262),g=o(3819),J=o(6742),O=o(5832),G=o(8726),q=o(529),M=o(3526),H=o(5681),B=o(8025),Q=o(312),V=o(8348),k=o(3046);function z(i,d){if(1&i){const n=e.EpF();e.TgZ(0,"clr-dropdown-menu")(1,"clr-dropdown")(2,"button",25),e.NdJ("click",function(){e.CHM(n);const r=e.oxw();return e.KtG(r.openChangePwdModal())}),e._UZ(3,"clr-icon",26),e._uU(4),e.ALo(5,"translate"),e.qZA(),e._UZ(6,"div",27),e.TgZ(7,"button",28),e.NdJ("click",function(){e.CHM(n);const r=e.oxw();return e.KtG(r.deleteUsers(r.selectedRow))}),e._UZ(8,"clr-icon",29),e._uU(9),e.ALo(10,"translate"),e.qZA()()()}if(2&i){const n=e.oxw();e.xp6(2),e.Q6J("disabled",1!==n.selectedRow.length||!n.canCreateUser),e.xp6(2),e.hij("\xa0",e.lcZ(5,4,"RESET_PWD.TITLE")," "),e.xp6(3),e.Q6J("disabled",!n.selectedRow.length||n.onlySelf),e.xp6(2),e.hij("\xa0",e.lcZ(10,6,"USER.DEL_ACTION")," ")}}function Y(i,d){1&i&&(e.TgZ(0,"clr-tooltip-content",30)(1,"span"),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&i&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"USER.UNKNOWN_TIP")))}function K(i,d){if(1&i&&(e.TgZ(0,"clr-dg-row",31)(1,"clr-dg-cell"),e._uU(2),e.qZA(),e.TgZ(3,"clr-dg-cell"),e._uU(4),e.qZA(),e.TgZ(5,"clr-dg-cell"),e._uU(6),e.qZA(),e.TgZ(7,"clr-dg-cell"),e._uU(8),e.ALo(9,"harborDatetime"),e.qZA()()),2&i){const n=d.$implicit,t=e.oxw();e.Q6J("clrDgItem",n),e.xp6(2),e.Oqu(n.username),e.xp6(2),e.Oqu(t.isSystemAdmin(n)),e.xp6(2),e.Oqu(n.email),e.xp6(2),e.Oqu(e.xi3(9,5,n.creation_time,"short"))}}function W(i,d){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){e.oxw();const n=e.MAs(47);e.xp6(1),e.lnq("",n.firstItem+1," - ",n.lastItem+1," ",e.lcZ(2,3,"USER.OF"),"")}}const j=function(){return[15,25,50]};let X=(()=>{class i{constructor(n,t,r,l,f,ne,re){this.userService=n,this.translate=t,this.deletionDialogService=r,this.msgHandler=l,this.session=f,this.appConfigService=ne,this.operationService=re,this.users=[],this.selectedRow=[],this.ISADMINISTRATOR="USER.ENABLE_ADMIN_ACTION",this.totalCount=0,this.currentPage=1,this.pageSize=(0,M.tb)(M.V2.SYSTEM_USER_COMPONENT),this.onGoing=!0,this.adminMenuText="",this.adminColumn="",this.deletionSubscription=r.confirmationConfirm$.subscribe(E=>{E&&3===E.source&&1===E.state&&this.delUser(E.data)})}isMySelf(n){let t=this.session.getCurrentUser();return!(!t||t.user_id!==n)}get onlySelf(){return 1===this.selectedRow.length&&this.isMySelf(this.selectedRow[0].user_id)}get canCreateUser(){let n=this.appConfigService.getConfig();return!n||!("ldap_auth"===n.auth_mode||"uaa_auth"===n.auth_mode||"oidc_auth"===n.auth_mode)}get ifSameRole(){let n=[];return this.selectedRow.forEach(t=>{if(0===t.user_id||this.isMySelf(t.user_id))return!1;n.push(t.sysadmin_flag?1:0)}),n.length&&n.every(t=>0===t)?(this.ISADMINISTRATOR="USER.ENABLE_ADMIN_ACTION",!0):!(!n.length||!n.every(t=>1===t)||(this.ISADMINISTRATOR="USER.DISABLE_ADMIN_ACTION",0))}isSystemAdmin(n){if(!n)return"{{MISS}}";let t=n.sysadmin_flag?"USER.IS_ADMIN":"USER.IS_NOT_ADMIN";const r=this.appConfigService.getConfig();return r&&r.auth_mode!==J.Au.DB_AUTH&&!n.sysadmin_flag&&(t="USER.UNKNOWN"),this.translate.get(t).subscribe(l=>this.adminColumn=l),this.adminColumn}adminActions(n){return n?(this.translate.get(n.sysadmin_flag?"USER.DISABLE_ADMIN_ACTION":"USER.ENABLE_ADMIN_ACTION").subscribe(r=>this.adminMenuText=r),this.adminMenuText):"{{MISS}}"}get inProgress(){return this.onGoing}ngOnDestroy(){this.deletionSubscription&&this.deletionSubscription.unsubscribe(),this.timerHandler&&(clearInterval(this.timerHandler),this.timerHandler=null)}openChangePwdModal(){1===this.selectedRow.length&&this.changePwdDialog.open(this.selectedRow[0].user_id)}doFilter(n){this.selectedRow=[],this.currentTerm=n.trim(),this.currentPage=1,this.onGoing=!0,this.getUserListByPaging()}changeAdminRole(){let n=[];if(this.selectedRow.length){if("USER.ENABLE_ADMIN_ACTION"===this.ISADMINISTRATOR)for(let t=0;t<this.selectedRow.length;t++){if(0===this.selectedRow[t].user_id||this.isMySelf(this.selectedRow[t].user_id))continue;let r=new p.n;r.user_id=this.selectedRow[t].user_id,r.sysadmin_flag=!0,n.push(this.userService.updateUserRole(r))}if("USER.DISABLE_ADMIN_ACTION"===this.ISADMINISTRATOR)for(let t=0;t<this.selectedRow.length;t++){if(0===this.selectedRow[t].user_id||this.isMySelf(this.selectedRow[t].user_id))continue;let r=new p.n;r.user_id=this.selectedRow[t].user_id,r.sysadmin_flag=!1,n.push(this.userService.updateUserRole(r))}(0,T.D)(...n).subscribe(()=>{this.selectedRow=[],this.refresh()},t=>{this.selectedRow=[],this.msgHandler.handleError(t)})}}deleteUsers(n){let t=[];if(this.onlySelf)return;n&&n.length&&n.forEach(l=>{t.push(l.username)});let r=new G.c("USER.DELETION_TITLE","USER.DELETION_SUMMARY",t.join(","),n,3,2);this.deletionDialogService.openComfirmDialog(r)}delUser(n){let t=[];n&&n.length&&(n.forEach(r=>{t.push(this.delOperate(r))}),(0,T.D)(...t).subscribe(r=>{let l;r&&r.length&&r.forEach(f=>{f instanceof q.UA&&(l=(0,O.Po)(f))}),l?this.msgHandler.handleError(l):this.translate.get("BATCH.DELETED_SUCCESS").subscribe(f=>{this.msgHandler.showSuccess(f)}),this.selectedRow=[],this.currentTerm="",this.refresh()}))}delOperate(n){let t=new g.gB;return t.name="OPERATION.DELETE_USER",t.data.id=n.user_id,t.state=g.yb.progressing,t.data.name=n.username,this.operationService.publishInfo(t),this.isMySelf(n.user_id)?this.translate.get("BATCH.DELETED_FAILURE").pipe((0,N.U)(r=>{(0,g.hm)(t,g.yb.failure,r)})):this.userService.deleteUser(n.user_id).pipe((0,N.U)(()=>{this.translate.get("BATCH.DELETED_SUCCESS").subscribe(r=>{(0,g.hm)(t,g.yb.success)})}),(0,F.K)(r=>{const l=(0,O.Po)(r);return this.translate.get(l).subscribe(f=>(0,g.hm)(t,g.yb.failure,f)),(0,v.of)(r)}))}refreshUser(){this.selectedRow=[],this.currentTerm="",this.onGoing=!0,this.getUserListByPaging()}addNewUser(){!this.canCreateUser||this.newUserDialog.open()}addUserToList(n){this.refresh()}load(n){n&&n.page&&(this.pageSize=n.page.size,(0,M.Pe)(M.V2.SYSTEM_USER_COMPONENT,this.pageSize)),this.selectedRow=[],this.onGoing=!0,this.getUserListByPaging()}refresh(){this.currentPage=1,this.refreshUser()}getUserListByPaging(){this.userService.getUserListByPaging(this.currentPage,this.pageSize,this.currentTerm).subscribe(n=>{if(n.headers){let t=n.headers.get("X-Total-Count");t&&(this.totalCount=parseInt(t,0))}this.users=n.body,this.onGoing=!1},n=>{this.msgHandler.handleError(n),this.onGoing=!1})}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(_.K),e.Y36(u.sK),e.Y36(H.O),e.Y36(C.d),e.Y36(U.m),e.Y36(B._),e.Y36(Q.f9))},i.\u0275cmp=e.Xpm({type:i,selectors:[["harbor-user"]],viewQuery:function(n,t){if(1&n&&(e.Gf(c,7),e.Gf(S,7)),2&n){let r;e.iGM(r=e.CRH())&&(t.newUserDialog=r.first),e.iGM(r=e.CRH())&&(t.changePwdDialog=r.first)}},features:[e._Bn([_.K])],decls:56,vars:50,consts:[[1,"row","relative"],[1,"col-lg-12","col-md-12","col-sm-12","col-xs-12"],[1,"custom-h2"],[1,"action-panel-pos","rightPos"],[1,"filter-pos",3,"withDivider","filterPlaceholder","currentValue","filterEvt"],[1,"refresh-btn"],["shape","refresh","ng-disabled","inProgress",3,"hidden","click"],[1,"spinner","spinner-inline",3,"hidden"],[3,"clrDgLoading","clrDgSelected","clrDgRefresh","clrDgSelectedChange"],["type","button","id","add-new-user",1,"btn","btn-secondary",3,"disabled","click"],["shape","plus","size","16"],["type","button","id","set-admin",1,"btn","btn-secondary",3,"disabled","click"],["shape","wrench","size","16"],["clrDropdownTrigger","",1,"btn","btn-link",3,"clrCloseMenuOnItemClick"],["id","member-action"],["shape","caret down"],[4,"clrIfOpen"],["clrTooltipTrigger","","shape","info-circle","size","24"],["clrPosition","top-right","clrSize","lg",4,"clrIfOpen"],[3,"clrDgItem",4,"ngFor","ngForOf"],[3,"clrDgPageSize","clrDgPage","clrDgTotalItems","clrDgPageChange"],["pagination",""],[3,"clrPageSizeOptions"],[4,"ngIf"],[3,"addNew"],["type","button","id","changePwd",1,"btn","btn-secondary",3,"disabled","click"],["shape","edit","size","16"],[1,"dropdown-divider"],["id","deleteUser","type","button",1,"btn","btn-secondary",3,"disabled","click"],["shape","times","size","16"],["clrPosition","top-right","clrSize","lg"],[3,"clrDgItem"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h2",2),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"div",3)(6,"hbr-filter",4),e.NdJ("filterEvt",function(l){return t.doFilter(l)}),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"span",5)(9,"clr-icon",6),e.NdJ("click",function(){return t.refresh()}),e.qZA(),e._UZ(10,"span",7),e.qZA()(),e.TgZ(11,"div")(12,"clr-datagrid",8),e.NdJ("clrDgRefresh",function(l){return t.load(l)})("clrDgSelectedChange",function(l){return t.selectedRow=l}),e.TgZ(13,"clr-dg-action-bar")(14,"button",9),e.NdJ("click",function(){return t.addNewUser()}),e._UZ(15,"clr-icon",10),e._uU(16),e.ALo(17,"translate"),e.qZA(),e.TgZ(18,"button",11),e.NdJ("click",function(){return t.changeAdminRole()}),e._UZ(19,"clr-icon",12),e._uU(20),e.ALo(21,"translate"),e.qZA(),e.TgZ(22,"clr-dropdown",13)(23,"span",14),e._uU(24),e.ALo(25,"translate"),e._UZ(26,"clr-icon",15),e.qZA(),e.YNc(27,z,11,8,"clr-dropdown-menu",16),e.qZA()(),e.TgZ(28,"clr-dg-column"),e._uU(29),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"clr-dg-column")(32,"span"),e._uU(33),e.ALo(34,"translate"),e.qZA(),e.TgZ(35,"clr-tooltip"),e._UZ(36,"clr-icon",17),e.YNc(37,Y,4,3,"clr-tooltip-content",18),e.qZA()(),e.TgZ(38,"clr-dg-column"),e._uU(39),e.ALo(40,"translate"),e.qZA(),e.TgZ(41,"clr-dg-column"),e._uU(42),e.ALo(43,"translate"),e.qZA(),e.YNc(44,K,10,8,"clr-dg-row",19),e.TgZ(45,"clr-dg-footer")(46,"clr-dg-pagination",20,21),e.NdJ("clrDgPageChange",function(l){return t.currentPage=l}),e.TgZ(48,"clr-dg-page-size",22),e._uU(49),e.ALo(50,"translate"),e.qZA(),e.YNc(51,W,3,5,"span",23),e._uU(52),e.ALo(53,"translate"),e.qZA()()()(),e.TgZ(54,"new-user-modal",24),e.NdJ("addNew",function(l){return t.addUserToList(l)}),e.qZA(),e._UZ(55,"change-password"),e.qZA()()),2&n&&(e.xp6(3),e.Oqu(e.lcZ(4,27,"SIDE_NAV.SYSTEM_MGMT.USER")),e.xp6(3),e.s9C("filterPlaceholder",e.lcZ(7,29,"USER.FILTER_PLACEHOLDER")),e.Q6J("withDivider",!0)("currentValue",t.currentTerm),e.xp6(3),e.Q6J("hidden",t.inProgress),e.xp6(1),e.Q6J("hidden",!1===t.inProgress),e.xp6(2),e.Q6J("clrDgLoading",t.inProgress)("clrDgSelected",t.selectedRow),e.xp6(2),e.Q6J("disabled",!t.canCreateUser),e.xp6(2),e.hij("\xa0",e.lcZ(17,31,"USER.ADD_ACTION")," "),e.xp6(2),e.Q6J("disabled",!t.ifSameRole),e.xp6(2),e.hij("\xa0",e.lcZ(21,33,t.ISADMINISTRATOR)," "),e.xp6(2),e.Q6J("clrCloseMenuOnItemClick",!1),e.xp6(2),e.Oqu(e.lcZ(25,35,"BUTTON.ACTIONS")),e.xp6(5),e.Oqu(e.lcZ(30,37,"USER.COLUMN_NAME")),e.xp6(4),e.Oqu(e.lcZ(34,39,"USER.COLUMN_ADMIN")),e.xp6(6),e.Oqu(e.lcZ(40,41,"USER.COLUMN_EMAIL")),e.xp6(3),e.Oqu(e.lcZ(43,43,"USER.COLUMN_REG_NAME")),e.xp6(2),e.Q6J("ngForOf",t.users),e.xp6(2),e.Q6J("clrDgPageSize",t.pageSize)("clrDgPage",t.currentPage)("clrDgTotalItems",t.totalCount),e.xp6(2),e.Q6J("clrPageSizeOptions",e.DdM(49,j)),e.xp6(1),e.Oqu(e.lcZ(50,45,"PAGINATION.PAGE_SIZE")),e.xp6(2),e.Q6J("ngIf",t.totalCount>0),e.xp6(1),e.AsE(" ",t.totalCount," ",e.lcZ(53,47,"USER.ITEMS")," "))},dependencies:[s.C9t,s.Gwl,s.m4W,s.Z4N,s.fv_,s.dRQ,s.Ltv,s.YYR,s.PDs,s.KHL,s.Gcc,s.jND,s.Nh1,s.dml,s.K8c,s.qvL,s.nqY,s.f_W,s.zwp,s.ZUS,s.Jmj,s.bMv,s.zDF,w.sg,w.O5,V.z,S,c,u.X$,k.Z],styles:[".custom-add-button[_ngcontent-%COMP%]{font-size:12px;margin-left:-12px}.filter-icon[_ngcontent-%COMP%]{position:relative;right:-12px}.filter-pos[_ngcontent-%COMP%]{float:right;margin-right:24px;position:relative;top:10px}.action-panel-pos[_ngcontent-%COMP%]{position:relative;padding-left:12px;margin-top:12px}.refresh-btn[_ngcontent-%COMP%]{position:absolute;right:6px;top:17px;cursor:pointer}.refresh-btn[_ngcontent-%COMP%]:hover{color:#007cbb}.hide-create[_ngcontent-%COMP%]{visibility:hidden!important}.rightPos[_ngcontent-%COMP%]{position:absolute;right:20px;height:32px;z-index:100}.relative[_ngcontent-%COMP%]{position:relative}"]}),i})();var $=o(858);const ee=[{path:"",component:X}];let te=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[a.m,$.Bz.forChild(ee)]}),i})()},8348:(Z,P,o)=>{o.d(P,{z:()=>C});var a=o(4650),T=o(7579),v=o(8372),e=o(4006),A=o(6895),m=o(9375);const U=["inputElement"];function _(s,u){1&s&&a._UZ(0,"span",4)}let C=(()=>{class s{constructor(c){this.cd=c,this.placeHolder="",this.filterTerms=new T.x,this.isExpanded=!1,this.filterEvt=new a.vpe,this.openFlag=new a.vpe,this.readonly=null,this.expandMode=!1,this.withDivider=!1}set filterPlaceholder(c){this.placeHolder=c}ngOnInit(){this.filterTerms.pipe((0,v.b)(500)).subscribe(c=>{this.filterEvt.emit(c)})}valueChange(){this.filterTerms.next(this.currentValue&&this.currentValue.trim())}inputFocus(){this.openFlag.emit(this.isExpanded)}onClick(){this.expandMode||(this.isExpanded=!this.isExpanded,this.isExpanded&&(this.cd.detectChanges(),this.inputElement.nativeElement.focus()),this.openFlag.emit(this.isExpanded))}get isShowSearchBox(){return this.expandMode||!this.expandMode&&this.isExpanded}}return s.\u0275fac=function(c){return new(c||s)(a.Y36(a.sBO))},s.\u0275cmp=a.Xpm({type:s,selectors:[["hbr-filter"]],viewQuery:function(c,p){if(1&c&&a.Gf(U,5),2&c){let h;a.iGM(h=a.CRH())&&(p.inputElement=h.first)}},inputs:{readonly:"readonly",currentValue:"currentValue",filterPlaceholder:"filterPlaceholder",expandMode:"expandMode",withDivider:"withDivider",width:"width"},outputs:{filterEvt:"filterEvt",openFlag:"openFlag"},decls:5,vars:9,consts:[["shape","search","size","20",1,"search-btn",3,"click"],["type","text","autofocus","",1,"filter-input","clr-input",3,"hidden","placeholder","ngModel","keyup","focus","ngModelChange"],["inputElement",""],["class","filter-divider",4,"ngIf"],[1,"filter-divider"]],template:function(c,p){1&c&&(a.TgZ(0,"span")(1,"clr-icon",0),a.NdJ("click",function(){return p.onClick()}),a.qZA(),a.TgZ(2,"input",1,2),a.NdJ("keyup",function(){return p.valueChange()})("focus",function(){return p.inputFocus()})("ngModelChange",function(w){return p.currentValue=w}),a.qZA(),a.YNc(4,_,1,0,"span",3),a.qZA()),2&c&&(a.xp6(1),a.ekj("filter-icon",p.isShowSearchBox),a.xp6(1),a.Udp("width",p.width,"px"),a.s9C("placeholder",p.placeHolder),a.Q6J("hidden",!p.isShowSearchBox)("ngModel",p.currentValue),a.uIk("readOnly",p.readonly),a.xp6(2),a.Q6J("ngIf",p.withDivider))},dependencies:[e.Fj,e.JJ,e.On,A.O5,m.qvL],styles:[".filter-icon[_ngcontent-%COMP%]{position:relative;right:-20px}.filter-divider[_ngcontent-%COMP%]{display:inline-block;height:16px;width:1px;padding-top:12px;padding-bottom:12px;position:relative;top:9px;margin-right:6px;margin-left:6px}.search-btn[_ngcontent-%COMP%]{cursor:pointer}.search-btn[_ngcontent-%COMP%]:hover{color:#007cbb}.filter-input[_ngcontent-%COMP%]{padding-left:24px}"]}),s})()}}]);