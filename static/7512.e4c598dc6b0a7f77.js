"use strict";(self.webpackChunkharbor_portal=self.webpackChunkharbor_portal||[]).push([[7512],{7512:(k,R,l)=>{l.r(R),l.d(R,{MemberModule:()=>de});var a=l(858),I=l(6296),T=l(8746),f=l(4004),S=l(262),x=l(2843),v=l(4128),E=l(8372),C=l(3900),e=l(4650),g=l(7579),p=l(9646),u=l(2421),i=l(9375),O=l(270),J=l(3168),G=l(9151),h=l(4006),A=l(6895),U=l(2466);const B=["memberForm"];function j(s,d){if(1&s){const t=e.EpF();e.TgZ(0,"li",30),e.NdJ("click",function(){const o=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.selectedName(o.username))}),e._uU(1),e.qZA()}if(2&s){const t=d.$implicit;e.xp6(1),e.hij(" ",t.username," ")}}function F(s,d){if(1&s&&(e.TgZ(0,"clr-control-error",31),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,1,t.memberTooltip)," ")}}let y=(()=>{class s{constructor(t,r,n,o){this.memberService=t,this.userService=r,this.messageHandlerService=n,this.route=o,this.member={},this.addMemberOpened=!1,this.staticBackdrop=!0,this.closable=!1,this.added=new e.vpe,this.isMemberNameValid=!0,this.memberTooltip="MEMBER.USERNAME_IS_REQUIRED",this.nameChecker=new g.x,this.searcher=new g.x,this.checkOnGoing=!1,this.searchedUserLists=[],this.btnStatus=i.xp5.DEFAULT,this.roleId=1}ngOnInit(){let r,t=this.route.snapshot.parent.parent.data;t&&(r=t.projectResolver.has_project_admin_role),r&&(this.searcherSub||(this.searcherSub=this.searcher.pipe((0,E.b)(500),(0,C.w)(n=>n?this.userService.listUsers({page:1,pageSize:10,q:encodeURIComponent(`username=~${n}`)}):(0,p.of)([]))).subscribe(n=>{n&&(this.searchedUserLists=n)})),this.nameCheckerSub||(this.nameCheckerSub=this.nameChecker.pipe((0,E.b)(500),(0,C.w)(n=>n?(this.checkOnGoing=!0,this.memberService.listProjectMembers({page:1,pageSize:10,projectNameOrId:this.projectId.toString(),entityname:n}).pipe((0,T.x)(()=>this.checkOnGoing=!1))):(0,p.of)([]))).subscribe(n=>{n&&n.length&&n.filter(o=>o.entity_name===this.member.username).length>0&&(this.isMemberNameValid=!1,this.memberTooltip="MEMBER.USERNAME_ALREADY_EXISTS")})))}ngOnDestroy(){this.nameCheckerSub&&(this.nameCheckerSub.unsubscribe(),this.nameCheckerSub=null),this.searcherSub&&(this.searcherSub.unsubscribe(),this.searcherSub=null)}onSubmit(){!this.member.username||0===this.member.username.length||(this.btnStatus=i.xp5.LOADING,this.memberService.createProjectMember({projectNameOrId:this.projectId.toString(),projectMember:{role_id:this.roleId,member_user:this.member}}).subscribe(()=>{this.addMemberOpened=!1,this.btnStatus=i.xp5.SUCCESS,this.messageHandlerService.showSuccess("MEMBER.ADDED_SUCCESS"),this.added.emit(!0)},t=>{this.btnStatus=i.xp5.ERROR,this.inlineAlert.showInlineError(t)}))}selectedName(t){this.member.username=t,this.nameChecker.next(t),this.searchedUserLists=[]}onCancel(){this.addMemberOpened=!1}leaveInput(){this.searchedUserLists=[]}openAddMemberModal(){this.currentForm.reset({member_role:1}),this.inlineAlert.close(),this.member={},this.addMemberOpened=!0,this.member.username="",this.isMemberNameValid=!0,this.memberTooltip="MEMBER.USERNAME_IS_REQUIRED",this.searchedUserLists=[]}handleValidation(){this.nameChecker.next(this.member.username),this.searcher.next(this.member.username),this.member.username?this.isMemberNameValid=!0:(this.searchedUserLists=[],this.isMemberNameValid=!1,this.memberTooltip="MEMBER.USERNAME_IS_REQUIRED")}isValid(){return this.currentForm&&this.currentForm.valid&&this.isMemberNameValid&&!this.checkOnGoing}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(O.n),e.Y36(J.K),e.Y36(G.d),e.Y36(a.gz))},s.\u0275cmp=e.Xpm({type:s,selectors:[["add-member"]],viewQuery:function(t,r){if(1&t&&(e.Gf(B,7),e.Gf(u.l,5)),2&t){let n;e.iGM(n=e.CRH())&&(r.currentForm=n.first),e.iGM(n=e.CRH())&&(r.inlineAlert=n.first)}},inputs:{projectId:"projectId"},outputs:{added:"added"},decls:62,vars:56,consts:[[3,"clrModalOpen","clrModalStaticBackdrop","clrModalClosable","clrModalOpenChange"],[1,"modal-title"],[1,"modal-body"],[1,"clr-form","clr-form-horizontal"],["memberForm","ngForm"],[1,"clr-form-control"],[1,"required","clr-control-label"],[1,"clr-control-container"],[1,"clr-input-wrapper",3,"mouseleave"],["type","text","id","member_name","name","member_name","required","","autocomplete","off",1,"clr-input",3,"ngModel","ngModelChange","keyup"],["memberName","ngModel"],["shape","exclamation-circle",1,"clr-validate-icon"],[1,"spinner","spinner-inline",3,"hidden"],[1,"selectBox"],[3,"click",4,"ngFor","ngForOf"],["class","tooltip-content",4,"ngIf"],[1,"clr-control-label"],["clrRadio","","type","radio","name","member_role","id","checkrads_project_admin",3,"value","ngModel","ngModelChange"],["for","checkrads_project_admin"],["clrRadio","","type","radio","name","member_role","id","checkrads_project_maintainer",3,"value","ngModel","ngModelChange"],["for","checkrads_project_maintainer"],["clrRadio","","type","radio","name","member_role","id","checkrads_developer",3,"value","ngModel","ngModelChange"],["for","checkrads_developer"],["clrRadio","","type","radio","name","member_role","id","checkrads_guest",3,"value","ngModel","ngModelChange"],["for","checkrads_guest"],["clrRadio","","type","radio","name","member_role","id","checkrads_limited_guest",3,"value","ngModel","ngModelChange"],["for","checkrads_limited_guest"],[1,"modal-footer"],["type","button",1,"btn","btn-outline",3,"click"],["type","button",1,"btn","btn-primary",3,"clrLoading","disabled","click"],[3,"click"],[1,"tooltip-content"]],template:function(t,r){if(1&t&&(e.TgZ(0,"clr-modal",0),e.NdJ("clrModalOpenChange",function(o){return r.addMemberOpened=o}),e.TgZ(1,"h3",1),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",2),e._UZ(5,"inline-alert",1),e.TgZ(6,"label"),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"form",3,4)(11,"div",5)(12,"label",6),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"div",7)(16,"div",8),e.NdJ("mouseleave",function(){return r.leaveInput()}),e.TgZ(17,"input",9,10),e.NdJ("ngModelChange",function(o){return r.member.username=o})("keyup",function(){return r.handleValidation()}),e.qZA(),e._UZ(19,"clr-icon",11)(20,"span",12),e.TgZ(21,"div",13)(22,"ul"),e.YNc(23,j,2,1,"li",14),e.qZA()()(),e.YNc(24,F,3,3,"clr-control-error",15),e.qZA()(),e.TgZ(25,"div",5)(26,"label",16),e._uU(27),e.ALo(28,"translate"),e.qZA(),e.TgZ(29,"div",7)(30,"clr-radio-wrapper")(31,"input",17),e.NdJ("ngModelChange",function(o){return r.roleId=o}),e.qZA(),e.TgZ(32,"label",18),e._uU(33),e.ALo(34,"translate"),e.qZA()(),e.TgZ(35,"clr-radio-wrapper")(36,"input",19),e.NdJ("ngModelChange",function(o){return r.roleId=o}),e.qZA(),e.TgZ(37,"label",20),e._uU(38),e.ALo(39,"translate"),e.qZA()(),e.TgZ(40,"clr-radio-wrapper")(41,"input",21),e.NdJ("ngModelChange",function(o){return r.roleId=o}),e.qZA(),e.TgZ(42,"label",22),e._uU(43),e.ALo(44,"translate"),e.qZA()(),e.TgZ(45,"clr-radio-wrapper")(46,"input",23),e.NdJ("ngModelChange",function(o){return r.roleId=o}),e.qZA(),e.TgZ(47,"label",24),e._uU(48),e.ALo(49,"translate"),e.qZA()(),e.TgZ(50,"clr-radio-wrapper")(51,"input",25),e.NdJ("ngModelChange",function(o){return r.roleId=o}),e.qZA(),e.TgZ(52,"label",26),e._uU(53),e.ALo(54,"translate"),e.qZA()()()()()(),e.TgZ(55,"div",27)(56,"button",28),e.NdJ("click",function(){return r.onCancel()}),e._uU(57),e.ALo(58,"translate"),e.qZA(),e.TgZ(59,"button",29),e.NdJ("click",function(){return r.onSubmit()}),e._uU(60),e.ALo(61,"translate"),e.qZA()()()),2&t){const n=e.MAs(18);e.Q6J("clrModalOpen",r.addMemberOpened)("clrModalStaticBackdrop",r.staticBackdrop)("clrModalClosable",r.closable),e.xp6(2),e.Oqu(e.lcZ(3,34,"MEMBER.NEW_MEMBER")),e.xp6(5),e.Oqu(e.lcZ(8,36,"MEMBER.NEW_USER_INFO")),e.xp6(6),e.Oqu(e.lcZ(14,38,"MEMBER.NAME")),e.xp6(2),e.ekj("clr-error",n.invalid&&(n.touched||n.dirty)||!r.isMemberNameValid),e.xp6(2),e.Q6J("ngModel",r.member.username),e.xp6(3),e.Q6J("hidden",!r.checkOnGoing),e.xp6(1),e.Udp("display",r.searchedUserLists.length?"block":"none"),e.xp6(2),e.Q6J("ngForOf",r.searchedUserLists),e.xp6(1),e.Q6J("ngIf",n.invalid&&(n.touched||n.dirty)||!r.isMemberNameValid),e.xp6(3),e.Oqu(e.lcZ(28,40,"MEMBER.ROLE")),e.xp6(4),e.Q6J("value",1)("ngModel",r.roleId),e.xp6(2),e.Oqu(e.lcZ(34,42,"MEMBER.PROJECT_ADMIN")),e.xp6(3),e.Q6J("value",4)("ngModel",r.roleId),e.xp6(2),e.Oqu(e.lcZ(39,44,"MEMBER.PROJECT_MAINTAINER")),e.xp6(3),e.Q6J("value",2)("ngModel",r.roleId),e.xp6(2),e.Oqu(e.lcZ(44,46,"MEMBER.DEVELOPER")),e.xp6(3),e.Q6J("value",3)("ngModel",r.roleId),e.xp6(2),e.Oqu(e.lcZ(49,48,"MEMBER.GUEST")),e.xp6(3),e.Q6J("value",5)("ngModel",r.roleId),e.xp6(2),e.Oqu(e.lcZ(54,50,"MEMBER.LIMITED_GUEST")),e.xp6(4),e.hij(" ",e.lcZ(58,52,"BUTTON.CANCEL")," "),e.xp6(2),e.Q6J("clrLoading",r.btnStatus)("disabled",!r.isValid()),e.xp6(1),e.hij(" ",e.lcZ(61,54,"BUTTON.OK")," ")}},dependencies:[h._Y,h.Fj,h._,h.JJ,h.JL,h.Q7,h.On,h.F,i.qvL,i.qAN,i.VLi,i.cCV,i.MPb,i.MgK,i.VqA,i.asN,i.EeQ,A.sg,A.O5,u.l,U.X$],styles:[".form-group-label-override[_ngcontent-%COMP%]{font-size:14px;font-weight:400}.selectBox[_ngcontent-%COMP%]{position:absolute;width:173px;height:auto;background-color:#fff;border:1px solid rgba(0,0,0,.15);border-right-width:2px;border-bottom-width:2px;border-radius:6px;box-shadow:0 5px 10px #0003;z-index:100}.selectBox[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{list-style:none;padding:3px 20px;cursor:pointer}.selectBox[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{color:#262626;background-image:linear-gradient(180deg,#f5f5f5 0,#e8e8e8);background-repeat:repeat-x}.modal-body[_ngcontent-%COMP%]{overflow:visible}"]}),s})();var M=l(268),_=l(3819),Z=l(6742),q=l(5832),Q=l(8726),P=l(3526),D=l(8025),Y=l(5326);const V=["groupForm"];function H(s,d){if(1&s){const t=e.EpF();e.TgZ(0,"li",21),e.NdJ("click",function(){const o=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.selectGroup(o.group_name))}),e._uU(1),e.qZA()}if(2&s){const t=d.$implicit;e.xp6(1),e.hij(" ",t.group_name," ")}}function z(s,d){if(1&s&&(e.TgZ(0,"clr-control-error",22),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,1,t.groupTooltip)," ")}}function K(s,d){if(1&s){const t=e.EpF();e.TgZ(0,"clr-radio-wrapper")(1,"input",23),e.NdJ("ngModelChange",function(n){e.CHM(t);const o=e.oxw();return e.KtG(o.roleId=n)}),e.qZA(),e.TgZ(2,"label",24),e._uU(3),e.ALo(4,"translate"),e.qZA()()}if(2&s){const t=d.$implicit,r=e.oxw();e.xp6(1),e.s9C("id","check_root_project_"+t.NAME),e.Q6J("value",t.VALUE)("ngModel",r.roleId),e.xp6(1),e.s9C("for","check_root_project_"+t.NAME),e.xp6(1),e.Oqu(e.lcZ(4,5,t.LABEL))}}let w=(()=>{class s{constructor(t,r,n,o){this.memberService=t,this.appConfigService=r,this.messageHandlerService=n,this.userGroupService=o,this.projectRoots=Z.wU,this.memberGroup={group_name:""},this.roleId=1,this.addGroupOpened=!1,this.staticBackdrop=!0,this.closable=!1,this.added=new e.vpe,this.checkOnGoing=!1,this.searchedGroups=[],this.groupChecker=new g.x,this.groupSearcher=new g.x,this.btnStatus=i.xp5.DEFAULT,this.isGroupNameValid=!0,this.groupTooltip="MEMBER.GROUP_NAME_REQUIRED",this.isNameChecked=!1}ngOnInit(){this.groupCheckerSub||(this.groupCheckerSub=this.groupChecker.pipe((0,E.b)(500),(0,C.w)(t=>{if(t){this.checkOnGoing=!0;const r={projectNameOrId:this.projectId.toString(),page:1,pageSize:10,entityname:t};return this.memberService.listProjectMembers(r).pipe((0,T.x)(()=>this.checkOnGoing=!1))}return(0,p.of)([])})).subscribe(t=>{t&&t.length&&t.filter(r=>r.entity_name===this.memberGroup.group_name).length>0&&(this.isGroupNameValid=!1,this.groupTooltip="MEMBER.GROUP_ALREADY_ADDED")})),this.groupSearcherSub||(this.groupSearcherSub=this.groupSearcher.pipe((0,E.b)(500),(0,C.w)(t=>t?this.userGroupService.searchUserGroups({page:1,pageSize:10,groupname:t}):(0,p.of)([]))).subscribe(t=>{if(t&&(this.searchedGroups=t),this.appConfigService.isLdapMode()&&this.memberGroup.group_name){let r=!1;this.searchedGroups.forEach(n=>{n.group_name===this.memberGroup.group_name&&(r=!0)}),r?this.isNameChecked=!0:(this.isGroupNameValid=!1,this.groupTooltip="MEMBER.NON_EXISTENT_GROUP")}}))}ngOnDestroy(){this.groupCheckerSub&&(this.groupCheckerSub.unsubscribe(),this.groupCheckerSub=null),this.groupSearcherSub&&(this.groupSearcherSub.unsubscribe(),this.groupSearcherSub=null)}createGroupAsMember(){this.btnStatus=i.xp5.LOADING,this.appConfigService.isHttpAuthMode()&&(this.memberGroup.group_type=Z.YT.HTTP_TYPE),this.appConfigService.isLdapMode()&&(this.memberGroup.group_type=Z.YT.LDAP_TYPE),this.appConfigService.isOidcMode()&&(this.memberGroup.group_type=Z.YT.OIDC_TYPE),this.memberService.createProjectMember({projectNameOrId:this.projectId.toString(),projectMember:{role_id:this.roleId,member_group:this.memberGroup}}).subscribe(t=>{this.messageHandlerService.showSuccess("MEMBER.ADDED_SUCCESS"),this.btnStatus=i.xp5.SUCCESS,this.addGroupOpened=!1,this.added.emit(!0)},t=>{this.btnStatus=i.xp5.ERROR,this.inlineAlert.showInlineError(t),this.added.emit(!1)})}onSubmit(){this.createGroupAsMember()}onCancel(){this.addGroupOpened=!1}openAddGroupModal(){this.currentForm.reset({member_role:1}),this.addGroupOpened=!0,this.inlineAlert.close(),this.memberGroup={group_name:""},this.isGroupNameValid=!0,this.groupTooltip="MEMBER.USERNAME_IS_REQUIRED",this.searchedGroups=[]}isValid(){return!(this.appConfigService.isLdapMode()&&!this.isNameChecked)&&this.isGroupNameValid&&this.currentForm&&this.currentForm.valid&&!this.checkOnGoing}selectGroup(t){this.appConfigService.isLdapMode()&&(this.isNameChecked=!0,this.isGroupNameValid=!0),this.memberGroup.group_name=t,this.groupChecker.next(t),this.searchedGroups=[]}leaveInput(){this.searchedGroups=[]}input(){this.appConfigService.isLdapMode()&&(this.isNameChecked=!1),this.groupChecker.next(this.memberGroup.group_name),this.groupSearcher.next(this.memberGroup.group_name),this.memberGroup.group_name?this.isGroupNameValid=!0:(this.searchedGroups=[],this.isGroupNameValid=!1,this.groupTooltip="MEMBER.GROUP_NAME_REQUIRED")}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(O.n),e.Y36(D._),e.Y36(G.d),e.Y36(Y.o))},s.\u0275cmp=e.Xpm({type:s,selectors:[["add-group"]],viewQuery:function(t,r){if(1&t&&(e.Gf(V,7),e.Gf(u.l,5)),2&t){let n;e.iGM(n=e.CRH())&&(r.currentForm=n.first),e.iGM(n=e.CRH())&&(r.inlineAlert=n.first)}},inputs:{projectId:"projectId"},outputs:{added:"added"},decls:39,vars:35,consts:[[3,"clrModalOpen","clrModalStaticBackdrop","clrModalClosable","clrModalOpenChange"],[1,"modal-title"],[1,"modal-body"],[1,"clr-form","clr-form-horizontal"],["groupForm","ngForm"],[1,"clr-form-control"],[1,"required","clr-control-label"],[1,"clr-control-container"],[1,"clr-input-wrapper",3,"mouseleave"],["type","text","id","group-name","name","groupName","required","","autocomplete","off",1,"clr-input",3,"ngModel","ngModelChange","keyup"],["groupName","ngModel"],["shape","exclamation-circle",1,"clr-validate-icon"],[1,"spinner","spinner-inline",3,"hidden"],[1,"selectBox"],[3,"click",4,"ngFor","ngForOf"],["class","tooltip-content",4,"ngIf"],[1,"clr-control-label"],[4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-outline",3,"click"],["type","button",1,"btn","btn-primary",3,"clrLoading","disabled","click"],[3,"click"],[1,"tooltip-content"],["clrRadio","","type","radio","name","member_role",3,"id","value","ngModel","ngModelChange"],[3,"for"]],template:function(t,r){if(1&t&&(e.TgZ(0,"clr-modal",0),e.NdJ("clrModalOpenChange",function(o){return r.addGroupOpened=o}),e.TgZ(1,"h3",1),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",2),e._UZ(5,"inline-alert",1),e.TgZ(6,"label"),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"form",3,4)(11,"div",5)(12,"label",6),e._uU(13),e.ALo(14,"translate"),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"div",7)(17,"div",8),e.NdJ("mouseleave",function(){return r.leaveInput()}),e.TgZ(18,"input",9,10),e.NdJ("ngModelChange",function(o){return r.memberGroup.group_name=o})("keyup",function(){return r.input()}),e.qZA(),e._UZ(20,"clr-icon",11)(21,"span",12),e.TgZ(22,"div",13)(23,"ul"),e.YNc(24,H,2,1,"li",14),e.qZA()()(),e.YNc(25,z,3,3,"clr-control-error",15),e.qZA()(),e.TgZ(26,"div",5)(27,"label",16),e._uU(28),e.ALo(29,"translate"),e.qZA(),e.TgZ(30,"div",7),e.YNc(31,K,5,7,"clr-radio-wrapper",17),e.qZA()()()(),e.TgZ(32,"div",18)(33,"button",19),e.NdJ("click",function(){return r.onCancel()}),e._uU(34),e.ALo(35,"translate"),e.qZA(),e.TgZ(36,"button",20),e.NdJ("click",function(){return r.onSubmit()}),e._uU(37),e.ALo(38,"translate"),e.qZA()()()),2&t){const n=e.MAs(19);e.Q6J("clrModalOpen",r.addGroupOpened)("clrModalStaticBackdrop",r.staticBackdrop)("clrModalClosable",r.closable),e.xp6(2),e.Oqu(e.lcZ(3,21,"GROUP.NEW_MEMBER")),e.xp6(5),e.Oqu(e.lcZ(8,23,"GROUP.NEW_USER_INFO")),e.xp6(6),e.AsE("",e.lcZ(14,25,"GROUP.GROUP")," ",e.lcZ(15,27,"GROUP.NAME"),""),e.xp6(3),e.ekj("clr-error",n.invalid&&(n.touched||n.dirty)||!r.isGroupNameValid),e.xp6(2),e.Q6J("ngModel",r.memberGroup.group_name),e.xp6(3),e.Q6J("hidden",!r.checkOnGoing),e.xp6(1),e.Udp("display",r.searchedGroups.length?"block":"none"),e.xp6(2),e.Q6J("ngForOf",r.searchedGroups),e.xp6(1),e.Q6J("ngIf",n.invalid&&(n.touched||n.dirty)||!r.isGroupNameValid),e.xp6(3),e.Oqu(e.lcZ(29,29,"GROUP.ROLE")),e.xp6(3),e.Q6J("ngForOf",r.projectRoots),e.xp6(3),e.hij(" ",e.lcZ(35,31,"BUTTON.CANCEL")," "),e.xp6(2),e.Q6J("clrLoading",r.btnStatus)("disabled",!r.isValid()),e.xp6(1),e.hij(" ",e.lcZ(38,33,"BUTTON.OK")," ")}},dependencies:[h._Y,h.Fj,h._,h.JJ,h.JL,h.Q7,h.On,h.F,i.qvL,i.qAN,i.VLi,i.cCV,i.MPb,i.MgK,i.VqA,i.asN,i.EeQ,A.sg,A.O5,u.l,U.X$],styles:[".form-group-label-override[_ngcontent-%COMP%]{font-size:14px;font-weight:400}.selectBox[_ngcontent-%COMP%]{position:absolute;width:173px;height:auto;background-color:#fff;border:1px solid rgba(0,0,0,.15);border-right-width:2px;border-bottom-width:2px;border-radius:6px;box-shadow:0 5px 10px #0003;z-index:100}.selectBox[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{list-style:none;padding:3px 20px;cursor:pointer}.selectBox[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{color:#262626;background-image:linear-gradient(180deg,#f5f5f5 0,#e8e8e8);background-repeat:repeat-x}"]}),s})();var W=l(5681),$=l(1992),X=l(312),ee=l(2443),te=l(8348);function re(s,d){if(1&s){const t=e.EpF();e.TgZ(0,"clr-dropdown-menu")(1,"label",21),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"button",22),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.changeMembersRole(n.selectedRow,1))}),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"button",22),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.changeMembersRole(n.selectedRow,4))}),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"button",22),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.changeMembersRole(n.selectedRow,2))}),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"button",22),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.changeMembersRole(n.selectedRow,3))}),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"button",22),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.changeMembersRole(n.selectedRow,5))}),e._uU(17),e.ALo(18,"translate"),e.qZA(),e._UZ(19,"div",23),e.TgZ(20,"button",22),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.openDeleteMembersDialog(n.selectedRow))}),e._uU(21),e.ALo(22,"translate"),e.qZA()()}if(2&s){const t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,13,"MEMBER.SET_ROLE")),e.xp6(2),e.Q6J("disabled",!(t.selectedRow.length&&t.hasUpdateMemberPermission)||t.onlySelf),e.xp6(1),e.hij(" ",e.lcZ(6,15,"MEMBER.PROJECT_ADMIN")," "),e.xp6(2),e.Q6J("disabled",!(t.selectedRow.length&&t.hasUpdateMemberPermission)||t.onlySelf),e.xp6(1),e.hij(" ",e.lcZ(9,17,"MEMBER.PROJECT_MAINTAINER")," "),e.xp6(2),e.Q6J("disabled",!(t.selectedRow.length&&t.hasUpdateMemberPermission)||t.onlySelf),e.xp6(1),e.hij(" ",e.lcZ(12,19,"MEMBER.DEVELOPER")," "),e.xp6(2),e.Q6J("disabled",!(t.selectedRow.length&&t.hasUpdateMemberPermission)||t.onlySelf),e.xp6(1),e.hij(" ",e.lcZ(15,21,"MEMBER.GUEST")," "),e.xp6(2),e.Q6J("disabled",!(t.selectedRow.length&&t.hasUpdateMemberPermission)||t.onlySelf),e.xp6(1),e.hij(" ",e.lcZ(18,23,"MEMBER.LIMITED_GUEST")," "),e.xp6(3),e.Q6J("disabled",!(t.selectedRow.length&&t.hasDeleteMemberPermission)||t.onlySelf),e.xp6(1),e.hij(" ",e.lcZ(22,25,"MEMBER.REMOVE")," ")}}function ne(s,d){1&s&&e._UZ(0,"span",26)}function oe(s,d){if(1&s&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&s){const t=e.oxw().$implicit,r=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,1,r.roleInfo[t.role_id]))}}function ie(s,d){if(1&s&&(e.TgZ(0,"clr-dg-row",24)(1,"clr-dg-cell"),e._uU(2),e.qZA(),e.TgZ(3,"clr-dg-cell"),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"clr-dg-cell"),e.YNc(7,ne,1,0,"span",25),e.YNc(8,oe,3,3,"span",19),e.qZA()()),2&s){const t=d.$implicit,r=e.oxw();e.Q6J("clrDgItem",t),e.xp6(2),e.Oqu(t.entity_name),e.xp6(2),e.Oqu(e.lcZ(5,5,r.member_type_toString(t.entity_type))),e.xp6(3),e.Q6J("ngIf",r.ChangeRoleOngoing(t.id)),e.xp6(1),e.Q6J("ngIf",!r.ChangeRoleOngoing(t.id))}}function se(s,d){if(1&s&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&s){e.oxw();const t=e.MAs(40);e.xp6(1),e.lnq("",t.firstItem+1," - ",t.lastItem+1," ",e.lcZ(2,3,"MEMBER.OF")," ")}}const le=function(){return[15,25,50]},ae=[{path:"",component:(()=>{class s{constructor(t,r,n,o,c,m,b,L,ce,pe,ue){this.route=t,this.router=r,this.memberService=n,this.translate=o,this.messageHandlerService=c,this.OperateDialogService=m,this.session=b,this.operationService=L,this.appConfigService=ce,this.userPermissionService=pe,this.errorHandlerEntity=ue,this.roleInfo=Z.Hp,this.batchOps="delete",this.selectedRow=[],this.isDelete=!1,this.isChangeRole=!1,this.loading=!0,this.isChangingRole=!1,this.batchChangeRoleInfos={},this.page=1,this.pageSize=(0,P.tb)(P.V2.MEMBER_COMPONENT),this.total=0,this.delSub=m.confirmationConfirm$.subscribe(N=>{N&&1===N.state&&2===N.source&&"delete"===this.batchOps&&this.deleteMembers(N.data)})}ngOnDestroy(){this.delSub&&this.delSub.unsubscribe()}ngOnInit(){this.projectId=+this.route.snapshot.parent.parent.params.id,this.currentUser=this.session.getCurrentUser(),this.getMemberPermissionRule(this.projectId),this.appConfigService.isLdapMode()&&(this.isLdapMode=!0),this.appConfigService.isHttpAuthMode()&&(this.isHttpAuthMode=!0),this.appConfigService.isOidcMode()&&(this.isOidcMode=!0)}doSearch(t){this.searchMember=t,this.retrieve(this.searchMember)}refresh(){this.page=1,this.total=0,this.selectedRow=[],this.searchMember=null,this.retrieve("")}clrDgRefresh(t){this.retrieve("",t)}retrieve(t,r){r&&r.page&&(this.pageSize=r.page.size,(0,P.Pe)(P.V2.MEMBER_COMPONENT,this.pageSize)),this.loading=!0,this.selectedRow=[],this.memberService.listProjectMembersResponse({entityname:t,page:this.page,pageSize:this.pageSize,projectNameOrId:this.projectId.toString()}).pipe((0,T.x)(()=>{this.loading=!1})).subscribe(n=>{if(n.headers){let o=n.headers.get("X-Total-Count");o&&(this.total=parseInt(o,0))}this.members=n.body||[]},n=>{this.messageHandlerService.handleError(n)})}get onlySelf(){return 1===this.selectedRow.length&&"u"===this.selectedRow[0].entity_type&&this.selectedRow[0].entity_id===this.currentUser.user_id}member_type_toString(t){return"u"===t?"MEMBER.USER_TYPE":"MEMBER.GROUP_TYPE"}openAddMemberModal(){this.addMemberComponent.openAddMemberModal()}addedMember(t){this.refresh()}openAddGroupModal(){this.addGroupComponent.openAddGroupModal()}addedGroup(t){this.searchMember="",this.retrieve("")}changeMembersRole(t,r){if(!t)return;let n=(c,m)=>this.memberService.updateProjectMember({projectNameOrId:this.projectId.toString(),mid:m.id,role:{role_id:r}}).pipe((0,f.U)(()=>this.batchChangeRoleInfos[m.id]="done"),(0,S.K)(b=>(this.messageHandlerService.handleError(b),(0,x._)(b))));this.batchChangeRoleInfos={};let o=[];t.forEach(c=>{"u"===c.entity_type&&c.entity_id===this.currentUser.user_id||(this.batchChangeRoleInfos[c.id]="pending",o.push(n(0,c)))}),(0,v.D)(...o).subscribe(()=>{this.refresh()})}ChangeRoleOngoing(t){return"pending"===this.batchChangeRoleInfos[t]}openDeleteMembersDialog(t){this.batchOps="delete";let r=[];if(t&&t.length){t.forEach(o=>{r.push(o.entity_name)});let n=new Q.c("MEMBER.DELETION_TITLE","MEMBER.DELETION_SUMMARY",r.join(","),t,2,2);this.OperateDialogService.openComfirmDialog(n)}}deleteMembers(t){if(!t)return;let r=[],n=o=>{let c=new _.gB;return c.name="u"===o.entity_type?"OPERATION.DELETE_MEMBER":"OPERATION.DELETE_GROUP",c.data.id=o.id,c.state=_.yb.progressing,c.data.name=o.entity_name,this.operationService.publishInfo(c),"u"===o.entity_type&&o.entity_id===this.currentUser.user_id?(this.translate.get("BATCH.DELETED_FAILURE").subscribe(m=>{(0,_.hm)(c,_.yb.failure,m)}),null):this.memberService.deleteProjectMember({projectNameOrId:this.projectId.toString(),mid:o.id}).pipe((0,f.U)(m=>{this.translate.get("BATCH.DELETED_SUCCESS").subscribe(b=>{(0,_.hm)(c,_.yb.success)})}),(0,S.K)(m=>{const b=(0,q.Po)(m);return this.translate.get(b).subscribe(L=>(0,_.hm)(c,_.yb.failure,L)),(0,x._)(m)}))};t.forEach(o=>r.push(n(o))),(0,v.D)(...r).subscribe(()=>{this.batchOps="idle",this.refresh()},o=>{this.errorHandlerEntity.error(o)})}getMemberPermissionRule(t){let r=this.userPermissionService.getPermission(t,M._W.MEMBER.KEY,M._W.MEMBER.VALUE.CREATE),n=this.userPermissionService.getPermission(t,M._W.MEMBER.KEY,M._W.MEMBER.VALUE.UPDATE),o=this.userPermissionService.getPermission(t,M._W.MEMBER.KEY,M._W.MEMBER.VALUE.DELETE);(0,v.D)(r,n,o).subscribe(c=>{this.hasCreateMemberPermission=c[0],this.hasUpdateMemberPermission=c[1],this.hasDeleteMemberPermission=c[2]},c=>this.errorHandlerEntity.error(c))}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(a.gz),e.Y36(a.F0),e.Y36(O.n),e.Y36(U.sK),e.Y36(G.d),e.Y36(W.O),e.Y36($.m),e.Y36(X.f9),e.Y36(D._),e.Y36(M.Hx),e.Y36(ee.q))},s.\u0275cmp=e.Xpm({type:s,selectors:[["ng-component"]],viewQuery:function(t,r){if(1&t&&(e.Gf(y,5),e.Gf(w,5)),2&t){let n;e.iGM(n=e.CRH())&&(r.addMemberComponent=n.first),e.iGM(n=e.CRH())&&(r.addGroupComponent=n.first)}},decls:49,vars:44,consts:[[1,"row","content-space"],[1,"row","flex-items-xs-between","rightPos"],[1,"flex-xs-middle","option-left"],[1,"flex-xs-middle","option-right"],[3,"withDivider","filterPlaceholder","currentValue","filterEvt"],[1,"refresh-btn",3,"click"],["shape","refresh"],[1,"col-lg-12","col-md-12","col-sm-12","col-xs-12"],[1,"btn","btn-secondary",3,"disabled","click"],["shape","plus","size","16"],["clrDropdownTrigger","",1,"btn","btn-link",3,"clrCloseMenuOnItemClick"],["id","member-action"],["shape","caret down"],[4,"clrIfOpen"],[1,"datagrid-pt",3,"clrDgSelected","clrDgLoading","clrDgRefresh","clrDgSelectedChange"],[3,"clrDgItem",4,"ngFor","ngForOf"],[3,"clrDgPageSize","clrDgPage","clrDgTotalItems","clrDgPageChange"],["pagination",""],[3,"clrPageSizeOptions"],[4,"ngIf"],[3,"projectId","added"],[1,"dropdown-header"],["clrDropdownItem","",3,"disabled","click"],[1,"dropdown-divider"],[3,"clrDgItem"],["class","spinner spinner-inline",4,"ngIf"],[1,"spinner","spinner-inline"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"div")(2,"div",1),e._UZ(3,"div",2),e.TgZ(4,"div",3)(5,"hbr-filter",4),e.NdJ("filterEvt",function(o){return r.doSearch(o)}),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"span",5),e.NdJ("click",function(){return r.refresh()}),e._UZ(8,"clr-icon",6),e.qZA()()()(),e.TgZ(9,"div",7)(10,"clr-dg-action-bar")(11,"button",8),e.NdJ("click",function(){return r.openAddMemberModal()}),e.TgZ(12,"span"),e._UZ(13,"clr-icon",9),e._uU(14),e.ALo(15,"translate"),e.qZA()(),e.TgZ(16,"button",8),e.NdJ("click",function(){return r.openAddGroupModal()}),e.TgZ(17,"span"),e._UZ(18,"clr-icon",9),e._uU(19),e.ALo(20,"translate"),e.qZA()(),e.TgZ(21,"clr-dropdown",10)(22,"span",11),e._uU(23),e.ALo(24,"translate"),e._UZ(25,"clr-icon",12),e.qZA(),e.YNc(26,re,23,27,"clr-dropdown-menu",13),e.qZA()(),e.TgZ(27,"clr-datagrid",14),e.NdJ("clrDgRefresh",function(o){return r.clrDgRefresh(o)})("clrDgSelectedChange",function(o){return r.selectedRow=o}),e.TgZ(28,"clr-dg-column"),e._uU(29),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"clr-dg-column"),e._uU(32),e.ALo(33,"translate"),e.qZA(),e.TgZ(34,"clr-dg-column"),e._uU(35),e.ALo(36,"translate"),e.qZA(),e.YNc(37,ie,9,7,"clr-dg-row",15),e.TgZ(38,"clr-dg-footer")(39,"clr-dg-pagination",16,17),e.NdJ("clrDgPageChange",function(o){return r.page=o}),e.TgZ(41,"clr-dg-page-size",18),e._uU(42),e.ALo(43,"translate"),e.qZA(),e.YNc(44,se,3,5,"span",19),e._uU(45),e.ALo(46,"translate"),e.qZA()()()(),e.TgZ(47,"add-member",20),e.NdJ("added",function(o){return r.addedMember(o)}),e.qZA(),e.TgZ(48,"add-group",20),e.NdJ("added",function(o){return r.addedGroup(o)}),e.qZA()()),2&t&&(e.xp6(5),e.s9C("filterPlaceholder",e.lcZ(6,25,"MEMBER.FILTER_PLACEHOLDER")),e.Q6J("withDivider",!0)("currentValue",r.searchMember),e.xp6(6),e.Q6J("disabled",!r.hasCreateMemberPermission),e.xp6(3),e.hij("\xa0",e.lcZ(15,27,"MEMBER.USER"),""),e.xp6(2),e.Q6J("disabled",!r.hasCreateMemberPermission||!(r.isLdapMode||r.isHttpAuthMode||r.isOidcMode)),e.xp6(3),e.hij("\xa0",e.lcZ(20,29,"MEMBER.LDAP_GROUP"),""),e.xp6(2),e.Q6J("clrCloseMenuOnItemClick",!1),e.xp6(2),e.Oqu(e.lcZ(24,31,"MEMBER.ACTION")),e.xp6(4),e.Q6J("clrDgSelected",r.selectedRow)("clrDgLoading",r.loading),e.xp6(2),e.Oqu(e.lcZ(30,33,"MEMBER.NAME")),e.xp6(3),e.Oqu(e.lcZ(33,35,"MEMBER.MEMBER_TYPE")),e.xp6(3),e.Oqu(e.lcZ(36,37,"MEMBER.ROLE")),e.xp6(2),e.Q6J("ngForOf",r.members),e.xp6(2),e.Q6J("clrDgPageSize",r.pageSize)("clrDgPage",r.page)("clrDgTotalItems",r.total),e.xp6(2),e.Q6J("clrPageSizeOptions",e.DdM(43,le)),e.xp6(1),e.Oqu(e.lcZ(43,39,"PAGINATION.PAGE_SIZE")),e.xp6(2),e.Q6J("ngIf",r.total),e.xp6(1),e.AsE(" ",r.total," ",e.lcZ(46,41,"MEMBER.ITEMS")," "),e.xp6(2),e.Q6J("projectId",r.projectId),e.xp6(1),e.Q6J("projectId",r.projectId))},dependencies:[i.C9t,i.Gwl,i.m4W,i.Z4N,i.fv_,i.dRQ,i.Ltv,i.YYR,i.PDs,i.KHL,i.Gcc,i.jND,i.Nh1,i.dml,i.K8c,i.qvL,i.nqY,i.MgK,i.f_W,i.zwp,i.ZUS,i.lU3,A.sg,A.O5,te.z,y,w,U.X$],styles:[".option-left[_ngcontent-%COMP%]{padding-left:16px;position:relative;top:10px}.option-right[_ngcontent-%COMP%]{padding-right:16px}.refresh-btn[_ngcontent-%COMP%]{cursor:pointer}.refresh-btn[_ngcontent-%COMP%]:hover{color:#007cbb}[_nghost-%COMP%]  .btn-group-overflow .dropdown-toggle{line-height:24px;height:24px}.rightPos[_ngcontent-%COMP%]{position:absolute;z-index:100;right:35px;margin-top:4px}clr-datagrid[_ngcontent-%COMP%]     clr-checkbox{position:inherit}[_nghost-%COMP%]  clr-checkbox.checkbox.datagrid-foot-select{position:inherit}.content-space[_ngcontent-%COMP%]{margin-top:28px;position:relative}.datagrid-pt[_ngcontent-%COMP%]{padding-top:0}.dropdown-header[_ngcontent-%COMP%]{text-transform:none;font-size:13px}"]}),s})()}];let de=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[a.Bz.forChild(ae),I.m]}),s})()},8348:(k,R,l)=>{l.d(R,{z:()=>C});var a=l(4650),I=l(7579),T=l(8372),f=l(4006),S=l(6895),x=l(9375);const v=["inputElement"];function E(e,g){1&e&&a._UZ(0,"span",4)}let C=(()=>{class e{constructor(p){this.cd=p,this.placeHolder="",this.filterTerms=new I.x,this.isExpanded=!1,this.filterEvt=new a.vpe,this.openFlag=new a.vpe,this.readonly=null,this.expandMode=!1,this.withDivider=!1}set filterPlaceholder(p){this.placeHolder=p}ngOnInit(){this.filterTerms.pipe((0,T.b)(500)).subscribe(p=>{this.filterEvt.emit(p)})}valueChange(){this.filterTerms.next(this.currentValue&&this.currentValue.trim())}inputFocus(){this.openFlag.emit(this.isExpanded)}onClick(){this.expandMode||(this.isExpanded=!this.isExpanded,this.isExpanded&&(this.cd.detectChanges(),this.inputElement.nativeElement.focus()),this.openFlag.emit(this.isExpanded))}get isShowSearchBox(){return this.expandMode||!this.expandMode&&this.isExpanded}}return e.\u0275fac=function(p){return new(p||e)(a.Y36(a.sBO))},e.\u0275cmp=a.Xpm({type:e,selectors:[["hbr-filter"]],viewQuery:function(p,u){if(1&p&&a.Gf(v,5),2&p){let i;a.iGM(i=a.CRH())&&(u.inputElement=i.first)}},inputs:{readonly:"readonly",currentValue:"currentValue",filterPlaceholder:"filterPlaceholder",expandMode:"expandMode",withDivider:"withDivider",width:"width"},outputs:{filterEvt:"filterEvt",openFlag:"openFlag"},decls:5,vars:9,consts:[["shape","search","size","20",1,"search-btn",3,"click"],["type","text","autofocus","",1,"filter-input","clr-input",3,"hidden","placeholder","ngModel","keyup","focus","ngModelChange"],["inputElement",""],["class","filter-divider",4,"ngIf"],[1,"filter-divider"]],template:function(p,u){1&p&&(a.TgZ(0,"span")(1,"clr-icon",0),a.NdJ("click",function(){return u.onClick()}),a.qZA(),a.TgZ(2,"input",1,2),a.NdJ("keyup",function(){return u.valueChange()})("focus",function(){return u.inputFocus()})("ngModelChange",function(O){return u.currentValue=O}),a.qZA(),a.YNc(4,E,1,0,"span",3),a.qZA()),2&p&&(a.xp6(1),a.ekj("filter-icon",u.isShowSearchBox),a.xp6(1),a.Udp("width",u.width,"px"),a.s9C("placeholder",u.placeHolder),a.Q6J("hidden",!u.isShowSearchBox)("ngModel",u.currentValue),a.uIk("readOnly",u.readonly),a.xp6(2),a.Q6J("ngIf",u.withDivider))},dependencies:[f.Fj,f.JJ,f.On,S.O5,x.qvL],styles:[".filter-icon[_ngcontent-%COMP%]{position:relative;right:-20px}.filter-divider[_ngcontent-%COMP%]{display:inline-block;height:16px;width:1px;padding-top:12px;padding-bottom:12px;position:relative;top:9px;margin-right:6px;margin-left:6px}.search-btn[_ngcontent-%COMP%]{cursor:pointer}.search-btn[_ngcontent-%COMP%]:hover{color:#007cbb}.filter-input[_ngcontent-%COMP%]{padding-left:24px}"]}),e})()}}]);