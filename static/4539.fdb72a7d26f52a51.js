"use strict";(self.webpackChunkharbor_portal=self.webpackChunkharbor_portal||[]).push([[4539],{4539:(w,v,a)=>{a.r(v),a.d(v,{P2pProviderModule:()=>ot});var d=a(858),S=a(6296),A=a(8372),C=a(3900),P=a(8746),g=a(3526),m=a(268),c=a(3824),Z=a(7579),f=a(4128),s=a(9375),e=a(4650),_=a(2466),x=a(9151),E=a(298),u=a(4006),T=a(6895),R=a(8348),b=a(3046);function k(n,l){1&n&&(e.TgZ(0,"div",42),e._UZ(1,"span",43),e.TgZ(2,"span"),e._uU(3),e.ALo(4,"translate"),e.qZA()()),2&n&&(e.xp6(3),e.Oqu(e.lcZ(4,1,"REPLICATION.IN_PROGRESS")))}function J(n,l){1&n&&(e.TgZ(0,"div",44),e._UZ(1,"clr-icon",45),e.TgZ(2,"span"),e._uU(3),e.ALo(4,"translate"),e.qZA()()),2&n&&(e.xp6(3),e.Oqu(e.lcZ(4,1,"REPLICATION.SUCCESS")))}function j(n,l){1&n&&(e.TgZ(0,"div",46),e._UZ(1,"clr-icon",47),e.TgZ(2,"span"),e._uU(3),e.ALo(4,"translate"),e.qZA()()),2&n&&(e.xp6(3),e.Oqu(e.lcZ(4,1,"REPLICATION.FAILURE")))}function V(n,l){1&n&&e._UZ(0,"clr-icon",52)}function Y(n,l){if(1&n&&(e.TgZ(0,"clr-tooltip-content",53)(1,"span"),e._uU(2),e.qZA()()),2&n){const t=e.oxw().$implicit;e.Q6J("clrPosition","left"),e.xp6(2),e.Oqu(t.status_message)}}function F(n,l){if(1&n&&(e.TgZ(0,"a",54),e._UZ(1,"clr-icon",55),e.qZA()),2&n){const t=e.oxw().$implicit,i=e.oxw();e.Q6J("href",i.viewLog(t.id),e.LSH)}}function Q(n,l){if(1&n&&(e.TgZ(0,"clr-dg-row",48)(1,"clr-dg-cell"),e._uU(2),e.qZA(),e.TgZ(3,"clr-dg-cell"),e._uU(4),e.qZA(),e.TgZ(5,"clr-dg-cell"),e._uU(6),e.TgZ(7,"clr-tooltip"),e.YNc(8,V,1,0,"clr-icon",49),e.YNc(9,Y,3,2,"clr-tooltip-content",50),e.qZA()(),e.TgZ(10,"clr-dg-cell")(11,"span"),e._uU(12),e.qZA()(),e.TgZ(13,"clr-dg-cell")(14,"span"),e._uU(15),e.qZA()(),e.TgZ(16,"clr-dg-cell")(17,"span"),e._uU(18),e.qZA()(),e.TgZ(19,"clr-dg-cell"),e._uU(20),e.ALo(21,"harborDatetime"),e.qZA(),e.TgZ(22,"clr-dg-cell"),e._uU(23),e.qZA(),e.TgZ(24,"clr-dg-cell"),e.YNc(25,F,2,1,"a",51),e.qZA()()),2&n){const t=l.$implicit,i=e.oxw();e.Q6J("clrDgItem",t),e.xp6(2),e.Oqu(t.id),e.xp6(2),e.Oqu(t.execution_id),e.xp6(2),e.hij("",t.status," "),e.xp6(2),e.Q6J("ngIf",t.status_message),e.xp6(4),e.Oqu(null==t.extra_attrs?null:t.extra_attrs.artifact),e.xp6(3),e.Oqu(null==t.extra_attrs?null:t.extra_attrs.digest),e.xp6(3),e.Oqu(null==t.extra_attrs?null:t.extra_attrs.kind),e.xp6(2),e.Oqu(e.xi3(21,11,t.start_time,"short")),e.xp6(3),e.Oqu(i.getDuration(t)),e.xp6(2),e.Q6J("ngIf","Initialized"!==t.status)}}function z(n,l){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){e.oxw();const t=e.MAs(129);e.xp6(1),e.lnq("",t.firstItem+1," - ",t.lastItem+1," ",e.lcZ(2,3,"REPLICATION.OF"),"")}}const G=function(){return[15,25,50]};let H=(()=>{class n{constructor(t,i,o,r,p,h,L){this.translate=t,this.router=i,this.route=o,this.messageHandlerService=r,this.preheatService=p,this.p2pProviderService=h,this.userPermissionService=L,this.inProgress=!1,this.currentPage=1,this.pageSize=(0,g.tb)(g.V2.P2P_TASKS_COMPONENT),this.loading=!0,this.hasUpdatePermission=!1,this.btnState=s.xp5.DEFAULT,this._searchSubject=new Z.x,this.filterKey="id"}ngOnInit(){this.projectId=+this.route.snapshot.parent.parent.params.id;const t=this.route.snapshot.parent.parent.data;t&&(this.projectName=t.projectResolver.name),this.executionId=this.route.snapshot.params.executionId,this.preheatPolicyName=this.route.snapshot.params.preheatPolicyName,this.executionId&&this.preheatPolicyName&&this.projectName&&this.getExecutionDetail(!0),this.getPermissions(),this.subscribeSearch()}subscribeSearch(){this._searchSubscription||(this._searchSubscription=this._searchSubject.pipe((0,A.b)(500),(0,C.w)(t=>{let i;return this.loading=!0,this.searchString&&(i=encodeURIComponent(`${this.filterKey}=~${t}`)),this.preheatService.ListTasksResponse({projectName:this.projectName,preheatPolicyName:this.preheatPolicyName,executionId:+this.executionId,page:this.currentPage,pageSize:this.pageSize,q:i}).pipe((0,P.x)(()=>this.loading=!1))})).subscribe(t=>{if(t.headers){let i=t.headers.get("x-total-count");i&&(this.totalCount=parseInt(i,0))}this.tasks=t.body,this.setLoop()}))}ngOnDestroy(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.timeoutForTaskList&&(clearTimeout(this.timeoutForTaskList),this.timeoutForTaskList=null),this._searchSubscription&&(this._searchSubscription.unsubscribe(),this._searchSubscription=null)}getPermissions(){const t=[];t.push(this.userPermissionService.getPermission(this.projectId,m._W.P2P_PROVIDER.KEY,m._W.P2P_PROVIDER.VALUE.UPDATE)),this.btnState=s.xp5.LOADING,(0,f.D)(...t).subscribe(i=>{[this.hasUpdatePermission]=i,this.btnState=s.xp5.SUCCESS},i=>{this.messageHandlerService.error(i),this.btnState=s.xp5.ERROR})}getExecutionDetail(t){t&&(this.inProgress=!0),this.executionId&&this.preheatService.GetExecution({projectName:this.projectName,preheatPolicyName:this.preheatPolicyName,executionId:+this.executionId}).pipe((0,P.x)(()=>this.inProgress=!1)).subscribe(i=>{this.execution=i,(!this.execution||this.p2pProviderService.willChangStatus(this.execution.status))&&(this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.timeout||(this.timeout=setTimeout(()=>{this.getExecutionDetail(!1)},c.X8)))},i=>{this.messageHandlerService.error(i)})}trigger(){return this.execution&&this.execution.trigger?this.execution.trigger:""}startTime(){return this.execution&&this.execution.start_time?this.execution.start_time:null}successNum(){return this.execution&&this.execution.metrics&&this.execution.metrics.success_task_count?this.execution.metrics.success_task_count:0}failedNum(){return this.execution&&this.execution.metrics&&this.execution.metrics.error_task_count?this.execution.metrics.error_task_count:0}progressNum(){return this.execution&&this.execution.metrics&&(this.execution.metrics.pending_task_count?this.execution.metrics.pending_task_count:0)+(this.execution.metrics.running_task_count?this.execution.metrics.running_task_count:0)+(this.execution.metrics.scheduled_task_count?this.execution.metrics.scheduled_task_count:0)||0}stoppedNum(){return this.execution&&this.execution.metrics&&this.execution.metrics.stopped_task_count?this.execution.metrics.stopped_task_count:0}stopJob(){this.stopOnGoing=!0;const t=(0,g.d9)(this.execution);t.status=c.r9.STOPPED,this.preheatService.StopExecution({projectName:this.projectName,preheatPolicyName:this.preheatPolicyName,executionId:+this.executionId,execution:t}).subscribe(i=>{this.stopOnGoing=!1,this.getExecutionDetail(!0),this.translate.get("REPLICATION.STOP_SUCCESS",{param:this.executionId}).subscribe(o=>{this.messageHandlerService.showSuccess(o)})},i=>{this.messageHandlerService.error(i)})}viewLog(t){return this.preheatService.rootUrl+`/projects/${this.projectName}/preheat/policies/${this.preheatPolicyName}/executions/${this.executionId}/tasks/${t}/logs`}clrLoadTasks(t,i){let o;t&&(this.loading=!0),i&&i.page&&(this.pageSize=i.page.size,(0,g.Pe)(g.V2.P2P_TASKS_COMPONENT,this.pageSize)),this.searchString&&(o=encodeURIComponent(`${this.filterKey}=~${this.searchString}`)),this.preheatService.ListTasksResponse({projectName:this.projectName,preheatPolicyName:this.preheatPolicyName,executionId:+this.executionId,page:this.currentPage,pageSize:this.pageSize,q:o}).pipe((0,P.x)(()=>{this.loading=!1})).subscribe(r=>{if(r.headers){let p=r.headers.get("x-total-count");p&&(this.totalCount=parseInt(p,0))}this.tasks=r.body,this.setLoop()},r=>{this.messageHandlerService.error(r)})}onBack(){this.router.navigate(["harbor","projects",`${this.projectId}`,"p2p-provider","policies"])}refreshTasks(){this.currentPage=1,this.totalCount=0,this.clrLoadTasks(!0)}getDuration(t){return this.p2pProviderService.getDuration(t.start_time,t.end_time)}isInProgress(){return this.execution&&this.p2pProviderService.willChangStatus(this.execution.status)}isSuccess(){return this.execution&&this.execution.status===c.r9.SUCCESS}isFailed(){return this.execution&&(this.execution.status===c.r9.ERROR||this.execution.status===c.r9.STOPPED)}canStop(){return this.execution&&this.p2pProviderService.willChangStatus(this.execution.status)}setLoop(){if(this.timeoutForTaskList&&(clearTimeout(this.timeoutForTaskList),this.timeoutForTaskList=null),this.tasks&&this.tasks.length)for(let t=0;t<this.tasks.length;t++)this.p2pProviderService.willChangStatus(this.tasks[t].status)&&(this.timeoutForTaskList||(this.timeoutForTaskList=setTimeout(()=>{this.clrLoadTasks(!1)},c.X8)))}selectFilterKey(t){this.filterKey=t.target.value}doFilter(t){this.searchString=t,t.trim()?this._searchSubject.next(t.trim()):this.clrLoadTasks(!0)}openFilter(t){this.isOpenFilterTag=t}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(_.sK),e.Y36(d.F0),e.Y36(d.gz),e.Y36(x.d),e.Y36(E.L),e.Y36(c.YQ),e.Y36(m.Hx))},n.\u0275cmp=e.Xpm({type:n,selectors:[["task-list"]],decls:136,vars:114,consts:[[1,"replication-tasks","mt-1"],[1,"overview-section"],[1,"title-wrapper"],[1,"onBack",3,"click"],[1,"title-block"],[1,"custom-h2","h2-style"],[1,"id-divider"],[1,"margin-top-16px"],["class","status-progress",4,"ngIf"],["class","status-success",4,"ngIf"],["class","status-failed",4,"ngIf"],[1,"button-stop"],[1,"btn","btn-primary",3,"disabled","click"],[1,"spinner","spinner-inline",3,"hidden"],[1,"execution-block"],[1,"executions-detail"],[1,"flex-block"],[1,"execution-detail-label"],[1,"detail-row"],[1,"num-success","common-style"],[1,"detail-span"],[1,"execution-details"],[1,"num-failed","common-style"],[1,"num-progress","common-style"],[1,"num-stopped","common-style"],[1,"tasks-detail"],[1,"modal-title"],[3,"clrDgLoading","clrDgRefresh"],[1,"row","flex-end"],[1,"select","filter-tag","clr-select-wrapper",3,"hidden"],["id","selectKey",3,"change"],["value","id"],["value","execution_id"],["value","status"],["id","filter-executions",3,"currentValue","withDivider","filterPlaceholder","filterEvt","openFlag"],[1,"refresh-btn"],["shape","refresh",3,"hidden","click"],[3,"clrDgItem",4,"ngFor","ngForOf"],[3,"clrDgPage","clrDgPageSize","clrDgTotalItems","clrDgPageChange"],["pagination",""],[3,"clrPageSizeOptions"],[4,"ngIf"],[1,"status-progress"],[1,"spinner","spinner-inline"],[1,"status-success"],["size","18","shape","success-standard",1,"color-green"],[1,"status-failed"],["size","18","shape","error-standard",1,"color-red"],[3,"clrDgItem"],["clrTooltipTrigger","","shape","info-circle","size","20",4,"ngIf"],["clrSize","md",3,"clrPosition",4,"clrIfOpen"],["rel","noopener noreferrer","target","_blank",3,"href",4,"ngIf"],["clrTooltipTrigger","","shape","info-circle","size","20"],["clrSize","md",3,"clrPosition"],["rel","noopener noreferrer","target","_blank",3,"href"],["shape","list"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"section",1)(2,"div",2)(3,"div")(4,"div")(5,"a",3),e.NdJ("click",function(){return i.onBack()}),e._uU(6),e.ALo(7,"translate"),e.qZA()(),e.TgZ(8,"div",4)(9,"div")(10,"h2",5),e._uU(11),e.ALo(12,"translate"),e.qZA(),e._UZ(13,"span",6),e.TgZ(14,"h2",5),e._uU(15),e.qZA()(),e.TgZ(16,"div",7),e.YNc(17,k,5,3,"div",8),e.YNc(18,J,5,3,"div",9),e.YNc(19,j,5,3,"div",10),e.qZA(),e.TgZ(20,"div",11)(21,"button",12),e.NdJ("click",function(){return i.stopJob()}),e._uU(22),e.ALo(23,"translate"),e.qZA(),e._UZ(24,"span",13),e.qZA()()()(),e.TgZ(25,"div",14)(26,"div",15)(27,"div")(28,"label"),e._uU(29),e.ALo(30,"translate"),e.qZA(),e.TgZ(31,"span"),e._uU(32),e.ALo(33,"translate"),e.qZA()(),e.TgZ(34,"div")(35,"label"),e._uU(36),e.ALo(37,"translate"),e.qZA(),e.TgZ(38,"span"),e._uU(39),e.ALo(40,"harborDatetime"),e.qZA()()(),e.TgZ(41,"div",16)(42,"section",17)(43,"section",18),e._UZ(44,"div",19),e.TgZ(45,"label",20),e._uU(46),e.ALo(47,"translate"),e.qZA(),e.TgZ(48,"div",21),e._uU(49),e.qZA()(),e.TgZ(50,"section",18),e._UZ(51,"div",22),e.TgZ(52,"label",20),e._uU(53),e.ALo(54,"translate"),e.qZA(),e.TgZ(55,"div",21),e._uU(56),e.qZA()(),e.TgZ(57,"section",18),e._UZ(58,"div",23),e.TgZ(59,"label",20),e._uU(60),e.ALo(61,"translate"),e.qZA(),e.TgZ(62,"div",21),e._uU(63),e.qZA()(),e.TgZ(64,"section",18),e._UZ(65,"div",24),e.TgZ(66,"label",20),e._uU(67),e.ALo(68,"translate"),e.qZA(),e.TgZ(69,"div",21),e._uU(70),e.qZA()()()()()(),e.TgZ(71,"div",25)(72,"h3",26),e._uU(73),e.ALo(74,"translate"),e.qZA(),e.TgZ(75,"clr-datagrid",27),e.NdJ("clrDgRefresh",function(r){return i.clrLoadTasks(!0,r)}),e.TgZ(76,"clr-dg-action-bar")(77,"div",28)(78,"div",29)(79,"select",30),e.NdJ("change",function(r){return i.selectFilterKey(r)}),e.TgZ(80,"option",31),e._uU(81),e.ALo(82,"lowercase"),e.ALo(83,"translate"),e.qZA(),e.TgZ(84,"option",32),e._uU(85),e.ALo(86,"lowercase"),e.ALo(87,"translate"),e.qZA(),e.TgZ(88,"option",33),e._uU(89),e.ALo(90,"lowercase"),e.ALo(91,"translate"),e.qZA()()(),e.TgZ(92,"hbr-filter",34),e.NdJ("filterEvt",function(r){return i.doFilter(r)})("openFlag",function(r){return i.openFilter(r)}),e.ALo(93,"translate"),e.qZA(),e.TgZ(94,"span",35)(95,"clr-icon",36),e.NdJ("click",function(){return i.refreshTasks()}),e.qZA()()()(),e.TgZ(96,"clr-dg-column"),e._uU(97),e.ALo(98,"translate"),e.qZA(),e.TgZ(99,"clr-dg-column"),e._uU(100),e.ALo(101,"translate"),e.qZA(),e.TgZ(102,"clr-dg-column"),e._uU(103),e.ALo(104,"translate"),e.qZA(),e.TgZ(105,"clr-dg-column"),e._uU(106),e.ALo(107,"translate"),e.qZA(),e.TgZ(108,"clr-dg-column"),e._uU(109),e.ALo(110,"translate"),e.qZA(),e.TgZ(111,"clr-dg-column"),e._uU(112),e.ALo(113,"translate"),e.qZA(),e.TgZ(114,"clr-dg-column"),e._uU(115),e.ALo(116,"translate"),e.qZA(),e.TgZ(117,"clr-dg-column"),e._uU(118),e.ALo(119,"translate"),e.qZA(),e.TgZ(120,"clr-dg-column"),e._uU(121),e.ALo(122,"translate"),e.qZA(),e.TgZ(123,"clr-dg-placeholder"),e._uU(124),e.ALo(125,"translate"),e.qZA(),e.YNc(126,Q,26,14,"clr-dg-row",37),e.TgZ(127,"clr-dg-footer")(128,"clr-dg-pagination",38,39),e.NdJ("clrDgPageChange",function(r){return i.currentPage=r}),e.TgZ(130,"clr-dg-page-size",40),e._uU(131),e.ALo(132,"translate"),e.qZA(),e.YNc(133,z,3,5,"span",41),e._uU(134),e.ALo(135,"translate"),e.qZA()()()()()),2&t&&(e.xp6(6),e.hij("<",e.lcZ(7,50,"P2P_PROVIDER.P2P_PROVIDER"),""),e.xp6(5),e.hij(" ",e.lcZ(12,52,"P2P_PROVIDER.EXECUTIONS")," "),e.xp6(4),e.Oqu(i.executionId),e.xp6(2),e.Q6J("ngIf",i.execution&&i.isInProgress()),e.xp6(1),e.Q6J("ngIf",i.execution&&i.isSuccess()),e.xp6(1),e.Q6J("ngIf",i.execution&&i.isFailed()),e.xp6(2),e.Q6J("disabled",!i.hasUpdatePermission||i.stopOnGoing||!i.canStop()),e.xp6(1),e.hij(" ",e.lcZ(23,54,"REPLICATION.STOPJOB")," "),e.xp6(2),e.Q6J("hidden",!1===i.inProgress),e.xp6(5),e.hij("",e.lcZ(30,56,"REPLICATION.TRIGGER_MODE")," :"),e.xp6(3),e.Oqu(e.lcZ(33,58,i.trigger())),e.xp6(4),e.hij("",e.lcZ(37,60,"REPLICATION.CREATION_TIME")," :"),e.xp6(3),e.Oqu(e.xi3(40,62,i.startTime(),"short")),e.xp6(7),e.Oqu(e.lcZ(47,65,"REPLICATION.SUCCESS")),e.xp6(3),e.Oqu(i.successNum()),e.xp6(4),e.Oqu(e.lcZ(54,67,"REPLICATION.FAILURE")),e.xp6(3),e.Oqu(i.failedNum()),e.xp6(4),e.Oqu(e.lcZ(61,69,"REPLICATION.IN_PROGRESS")),e.xp6(3),e.Oqu(i.progressNum()),e.xp6(4),e.Oqu(e.lcZ(68,71,"REPLICATION.STOPPED")),e.xp6(3),e.Oqu(i.stoppedNum()),e.xp6(3),e.Oqu(e.lcZ(74,73,"P2P_PROVIDER.TASKS")),e.xp6(2),e.Q6J("clrDgLoading",i.loading),e.xp6(3),e.Q6J("hidden",!i.isOpenFilterTag),e.xp6(3),e.hij(" ",e.lcZ(82,75,e.lcZ(83,77,"REPLICATION.TASK_ID"))," "),e.xp6(4),e.hij(" ",e.lcZ(86,79,e.lcZ(87,81,"P2P_PROVIDER.ID"))," "),e.xp6(4),e.hij(" ",e.lcZ(90,83,e.lcZ(91,85,"REPLICATION.STATUS"))," "),e.xp6(3),e.s9C("filterPlaceholder",e.lcZ(93,87,"REPLICATION.FILTER_PLACEHOLDER")),e.Q6J("currentValue",i.searchString)("withDivider",!0),e.xp6(3),e.Q6J("hidden",i.loading),e.xp6(2),e.Oqu(e.lcZ(98,89,"REPLICATION.TASK_ID")),e.xp6(3),e.Oqu(e.lcZ(101,91,"P2P_PROVIDER.ID")),e.xp6(3),e.Oqu(e.lcZ(104,93,"REPLICATION.STATUS")),e.xp6(3),e.Oqu(e.lcZ(107,95,"P2P_PROVIDER.ARTIFACT")),e.xp6(3),e.Oqu(e.lcZ(110,97,"P2P_PROVIDER.DIGEST")),e.xp6(3),e.Oqu(e.lcZ(113,99,"P2P_PROVIDER.TYPE")),e.xp6(3),e.Oqu(e.lcZ(116,101,"REPLICATION.CREATION_TIME")),e.xp6(3),e.Oqu(e.lcZ(119,103,"REPLICATION.DURATION")),e.xp6(3),e.Oqu(e.lcZ(122,105,"REPLICATION.LOGS")),e.xp6(3),e.Oqu(e.lcZ(125,107,"P2P_PROVIDER.TASKS_PLACEHOLDER")),e.xp6(2),e.Q6J("ngForOf",i.tasks),e.xp6(2),e.Q6J("clrDgPage",i.currentPage)("clrDgPageSize",i.pageSize)("clrDgTotalItems",i.totalCount),e.xp6(2),e.Q6J("clrPageSizeOptions",e.DdM(113,G)),e.xp6(1),e.Oqu(e.lcZ(132,109,"PAGINATION.PAGE_SIZE")),e.xp6(2),e.Q6J("ngIf",i.totalCount),e.xp6(1),e.AsE(" ",i.totalCount," ",e.lcZ(135,111,"REPLICATION.ITEMS")," "))},dependencies:[u.YN,u.Kr,s.C9t,s.Gwl,s.m4W,s.Z4N,s.fv_,s.dRQ,s.Ltv,s.YYR,s.F7K,s.PDs,s.KHL,s.Gcc,s.jND,s.Nh1,s.dml,s.K8c,s.qvL,s.nqY,s.MgK,s.Jmj,s.bMv,s.zDF,T.sg,T.O5,R.z,_.X$,T.i8,b.Z],styles:[".replication-tasks[_ngcontent-%COMP%]   .overview-section[_ngcontent-%COMP%]   .title-wrapper[_ngcontent-%COMP%]   .onBack[_ngcontent-%COMP%]{color:#007cbb;font-size:14px;cursor:pointer}.replication-tasks[_ngcontent-%COMP%]   .overview-section[_ngcontent-%COMP%]   .title-wrapper[_ngcontent-%COMP%]   .title-block[_ngcontent-%COMP%]{display:flex;align-items:center}.replication-tasks[_ngcontent-%COMP%]   .overview-section[_ngcontent-%COMP%]   .title-wrapper[_ngcontent-%COMP%]   .title-block[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{min-width:250px;margin-right:5px}.replication-tasks[_ngcontent-%COMP%]   .overview-section[_ngcontent-%COMP%]   .title-wrapper[_ngcontent-%COMP%]   .title-block[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:nth-child(2){width:140px}.replication-tasks[_ngcontent-%COMP%]   .overview-section[_ngcontent-%COMP%]   .title-wrapper[_ngcontent-%COMP%]   .title-block[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:nth-child(2)   span[_ngcontent-%COMP%]{color:#007cbb;font-size:12px;margin-left:10px}.replication-tasks[_ngcontent-%COMP%]   .overview-section[_ngcontent-%COMP%]   .title-wrapper[_ngcontent-%COMP%]   .title-block[_ngcontent-%COMP%]   .id-divider[_ngcontent-%COMP%]{display:inline-block;height:25px;width:2px;background-color:#ccc;margin:0 20px}.replication-tasks[_ngcontent-%COMP%]   .overview-section[_ngcontent-%COMP%]   .title-wrapper[_ngcontent-%COMP%]   .title-block[_ngcontent-%COMP%]   .h2-style[_ngcontent-%COMP%]{display:inline-block}.replication-tasks[_ngcontent-%COMP%]   .overview-section[_ngcontent-%COMP%]   .execution-block[_ngcontent-%COMP%]{margin-top:24px;display:flex;flex-wrap:wrap}.replication-tasks[_ngcontent-%COMP%]   .overview-section[_ngcontent-%COMP%]   .execution-block[_ngcontent-%COMP%]   .execution-detail-label[_ngcontent-%COMP%]{margin-right:10px;text-align:left}.replication-tasks[_ngcontent-%COMP%]   .overview-section[_ngcontent-%COMP%]   .execution-block[_ngcontent-%COMP%]   .execution-detail-label[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]{display:flex;height:27px}.replication-tasks[_ngcontent-%COMP%]   .overview-section[_ngcontent-%COMP%]   .execution-block[_ngcontent-%COMP%]   .execution-detail-label[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]   .common-style[_ngcontent-%COMP%]{width:12px;height:12px;margin-top:16px}.replication-tasks[_ngcontent-%COMP%]   .overview-section[_ngcontent-%COMP%]   .execution-block[_ngcontent-%COMP%]   .execution-detail-label[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]   .num-success[_ngcontent-%COMP%]{background-color:#308700}.replication-tasks[_ngcontent-%COMP%]   .overview-section[_ngcontent-%COMP%]   .execution-block[_ngcontent-%COMP%]   .execution-detail-label[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]   .num-failed[_ngcontent-%COMP%]{background-color:#c92101}.replication-tasks[_ngcontent-%COMP%]   .overview-section[_ngcontent-%COMP%]   .execution-block[_ngcontent-%COMP%]   .execution-detail-label[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]   .num-progress[_ngcontent-%COMP%]{background-color:#1c5898}.replication-tasks[_ngcontent-%COMP%]   .overview-section[_ngcontent-%COMP%]   .execution-block[_ngcontent-%COMP%]   .execution-detail-label[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]   .num-stopped[_ngcontent-%COMP%]{background-color:#a1a1a1}.replication-tasks[_ngcontent-%COMP%]   .overview-section[_ngcontent-%COMP%]   .execution-block[_ngcontent-%COMP%]   .execution-detail-label[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]   .detail-span[_ngcontent-%COMP%]{flex:0 0 100px;margin:10px 0 0 10px}.replication-tasks[_ngcontent-%COMP%]   .overview-section[_ngcontent-%COMP%]   .execution-block[_ngcontent-%COMP%]   .execution-detail-label[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]   .execution-details[_ngcontent-%COMP%]{width:200px;margin:8px 35px}.replication-tasks[_ngcontent-%COMP%]   .overview-section[_ngcontent-%COMP%]   .execution-block[_ngcontent-%COMP%]   .executions-detail[_ngcontent-%COMP%]{width:391px}.replication-tasks[_ngcontent-%COMP%]   .overview-section[_ngcontent-%COMP%]   .execution-block[_ngcontent-%COMP%]   .executions-detail[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:inline-block;width:120px}.replication-tasks[_ngcontent-%COMP%]   .overview-section[_ngcontent-%COMP%]   .execution-block[_ngcontent-%COMP%]   .executions-detail[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-top:10px}.replication-tasks[_ngcontent-%COMP%]   .tasks-detail[_ngcontent-%COMP%]{margin-top:65px}.replication-tasks[_ngcontent-%COMP%]   .tasks-detail[_ngcontent-%COMP%]   .action-select[_ngcontent-%COMP%]{padding-right:18px;height:24px;display:flex;justify-content:flex-end}.replication-tasks[_ngcontent-%COMP%]   .tasks-detail[_ngcontent-%COMP%]   .action-select[_ngcontent-%COMP%]   .filter-tag[_ngcontent-%COMP%]{float:left;margin-top:8px}.replication-tasks[_ngcontent-%COMP%]   .tasks-detail[_ngcontent-%COMP%]   .action-select[_ngcontent-%COMP%]   .refresh-btn[_ngcontent-%COMP%]{cursor:pointer;margin-top:7px}.replication-tasks[_ngcontent-%COMP%]   .tasks-detail[_ngcontent-%COMP%]   .action-select[_ngcontent-%COMP%]   .refresh-btn[_ngcontent-%COMP%]:hover{color:#007cbb}.replication-tasks[_ngcontent-%COMP%]   .tasks-detail[_ngcontent-%COMP%]   clr-datagrid[_ngcontent-%COMP%]   .resource-width[_ngcontent-%COMP%]{width:150px}.margin-top-16px[_ngcontent-%COMP%]{margin-top:16px}.flex-end[_ngcontent-%COMP%]{align-items:center;display:flex;justify-content:flex-end;padding-right:1.5rem}.refresh-btn[_ngcontent-%COMP%]{margin-top:6px;cursor:pointer}.filter-tag[_ngcontent-%COMP%]{margin-top:7px}.button-stop[_ngcontent-%COMP%]{margin-top:16px;margin-left:-5px}"]}),n})();var B=a(1884),K=a(9300),N=a(2421),$=a(1992),X=a(8025),W=a(668);const ee=["policyForm"],te=["cronScheduleComponent"];function ie(n,l){1&n&&(e.TgZ(0,"h3",4),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"P2P_PROVIDER.EDIT_POLICY")," "))}function ne(n,l){1&n&&(e.TgZ(0,"h3",4),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"P2P_PROVIDER.ADD_POLICY")," "))}function oe(n,l){if(1&n&&(e.TgZ(0,"option",45),e._uU(1),e.qZA()),2&n){const t=l.$implicit,i=e.oxw();e.s9C("value",t.id),e.Q6J("selected",i.policy.provider_id===t.id),e.xp6(1),e.hij(" ",t.provider," ")}}function re(n,l){1&n&&(e.TgZ(0,"clr-control-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"P2P_PROVIDER.PROVIDER_REQUIRED")," "))}function se(n,l){1&n&&(e.TgZ(0,"span",51),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"P2P_PROVIDER.NO_PROVIDER")))}function le(n,l){1&n&&(e.TgZ(0,"span",51),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"P2P_PROVIDER.NEED_HELP")))}function ce(n,l){1&n&&(e.TgZ(0,"a",52),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"P2P_PROVIDER.PROVIDER")))}function ae(n,l){if(1&n&&(e.TgZ(0,"div",46),e._UZ(1,"label",41),e.TgZ(2,"div",47)(3,"div",48),e.YNc(4,se,3,3,"span",49),e.YNc(5,le,3,3,"span",49),e.YNc(6,ce,3,3,"a",50),e.qZA()()()),2&n){const t=e.oxw();e.xp6(4),e.Q6J("ngIf",t.isSystemAdmin()),e.xp6(1),e.Q6J("ngIf",!t.isSystemAdmin()),e.xp6(1),e.Q6J("ngIf",t.isSystemAdmin())}}function pe(n,l){1&n&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"SCANNER.NAME_EXISTS")))}function de(n,l){1&n&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"P2P_PROVIDER.NAME_TOOLTIP")))}function ge(n,l){if(1&n&&(e.TgZ(0,"clr-control-error"),e.YNc(1,pe,3,3,"span",13),e.YNc(2,de,3,3,"span",13),e.qZA()),2&n){const t=e.oxw(),i=e.MAs(26);e.xp6(1),e.Q6J("ngIf",!((i.dirty||i.touched)&&i.invalid)&&t.isNameExisting),e.xp6(1),e.Q6J("ngIf",(i.dirty||i.touched)&&i.invalid)}}function _e(n,l){1&n&&(e.TgZ(0,"clr-control-error",53),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"P2P_PROVIDER.REPO_REQUIRED")," "))}function ue(n,l){1&n&&(e.TgZ(0,"clr-control-error",53),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"P2P_PROVIDER.TAG_REQUIRED")," "))}function he(n,l){1&n&&(e.TgZ(0,"clr-tooltip-content",60),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"P2P_PROVIDER.CRITERIA_EXPLAIN")," "))}function Pe(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",32)(1,"label",41)(2,"span"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"clr-tooltip"),e._UZ(6,"clr-icon",54),e.YNc(7,he,3,3,"clr-tooltip-content",55),e.qZA()(),e.TgZ(8,"div",56)(9,"div",57)(10,"input",58),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.onlySignedImages=o)}),e.qZA(),e.TgZ(11,"label",59),e._uU(12),e.ALo(13,"translate"),e.qZA()()()()}if(2&n){const t=e.oxw();e.xp6(3),e.Oqu(e.lcZ(4,3,"P2P_PROVIDER.CRITERIA")),e.xp6(7),e.Q6J("ngModel",t.onlySignedImages),e.xp6(2),e.Oqu(e.lcZ(13,5,"P2P_PROVIDER.ONLY_SIGNED"))}}function me(n,l){1&n&&(e.TgZ(0,"clr-tooltip-content",60),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"P2P_PROVIDER.CRITERIA_EXPLAIN")," "))}function fe(n,l){1&n&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"clr-tooltip"),e._UZ(5,"clr-icon",67),e.YNc(6,me,3,3,"clr-tooltip-content",55),e.qZA(),e.BQk()),2&n&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"P2P_PROVIDER.CRITERIA")))}function Te(n,l){if(1&n&&(e.TgZ(0,"option",45),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=l.$implicit,i=e.oxw(2);e.s9C("value",t.severity),e.Q6J("selected",i.severity===t.severity),e.xp6(1),e.hij(" ",e.lcZ(2,3,t.severityLevel)," ")}}const xe=function(n){return{"mt-1":n}};function Ce(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",61)(1,"label",26),e.YNc(2,fe,7,3,"ng-container",13),e.qZA(),e.TgZ(3,"div",62)(4,"label",63),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"div",64)(8,"select",65,66),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.severity=o)}),e.TgZ(10,"option"),e._uU(11,"--"),e.qZA(),e.YNc(12,Te,3,5,"option",12),e.qZA()(),e.TgZ(13,"label",63),e._uU(14),e.ALo(15,"translate"),e.qZA()()()}if(2&n){const t=e.oxw();e.Q6J("ngClass",e.VKq(10,xe,!t.withNotary())),e.xp6(2),e.Q6J("ngIf",!(t.withNotary()&&t.enableContentTrust)),e.xp6(3),e.hij("",e.lcZ(6,6,"P2P_PROVIDER.START_TEXT"),"\xa0"),e.xp6(3),e.Q6J("ngModel",t.severity),e.xp6(4),e.Q6J("ngForOf",t.severityOptions),e.xp6(2),e.hij("\xa0",e.lcZ(15,8,"P2P_PROVIDER.EDN_TEXT"),"")}}function Oe(n,l){if(1&n&&(e.TgZ(0,"option",45),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){const t=l.$implicit,i=e.oxw();e.s9C("value",t),e.Q6J("selected",i.triggerType===t),e.xp6(1),e.hij(" ",e.lcZ(2,3,i.getTriggerTypeI18n(t))," ")}}function Ae(n,l){1&n&&(e.TgZ(0,"clr-tooltip-content",70)(1,"div"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"div"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"div"),e._uU(11),e.ALo(12,"translate"),e.qZA()()),2&n&&(e.xp6(2),e.hij(" ",e.lcZ(3,4,"P2P_PROVIDER.EVENT_BASED_EXPLAIN_LINE1")," "),e.xp6(3),e.hij(" ",e.lcZ(6,6,"P2P_PROVIDER.EVENT_BASED_EXPLAIN_LINE2")," "),e.xp6(3),e.hij(" ",e.lcZ(9,8,"P2P_PROVIDER.EVENT_BASED_EXPLAIN_LINE3")," "),e.xp6(3),e.hij(" ",e.lcZ(12,10,"P2P_PROVIDER.EVENT_BASED_EXPLAIN_LINE4")," "))}function Ze(n,l){1&n&&(e.TgZ(0,"clr-tooltip"),e._UZ(1,"clr-icon",68),e.YNc(2,Ae,13,12,"clr-tooltip-content",69),e.qZA())}function Ee(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",32),e._UZ(1,"label",26),e.TgZ(2,"div",17)(3,"cron-selection",71,72),e.NdJ("inputvalue",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.setCron(o))}),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(3),e.Q6J("isInlineModel",!0)("originCron",t.getCron())}}function ve(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",73)(1,"button",74),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.onCancel())}),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"button",75),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.addOrSave(!0))}),e._uU(5),e.ALo(6,"translate"),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(2),e.hij(" ",e.lcZ(3,4,"BUTTON.CANCEL")," "),e.xp6(2),e.Q6J("clrLoading",t.buttonStatus)("disabled",t.isNameExisting||t.checkNameOnGoing||t.loading||!t.valid()),e.xp6(1),e.hij(" ",e.lcZ(6,6,"BUTTON.ADD")," ")}}function ye(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",73)(1,"button",76),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.onCancel())}),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"button",77),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.addOrSave(!1))}),e._uU(5),e.ALo(6,"translate"),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(2),e.hij(" ",e.lcZ(3,4,"BUTTON.CANCEL")," "),e.xp6(2),e.Q6J("clrLoading",t.buttonStatus)("disabled",t.isNameExisting||t.checkNameOnGoing||t.loading||!t.valid()||!t.hasChange()),e.xp6(1),e.hij(" ",e.lcZ(6,6,"BUTTON.SAVE")," ")}}const M="true";let D=(()=>{class n{constructor(t,i,o,r,p){this.preheatService=t,this.session=i,this.route=o,this.appConfigService=r,this.projectService=p,this.severityOptions=[{severity:5,severityLevel:"VULNERABILITY.SEVERITY.CRITICAL"},{severity:4,severityLevel:"VULNERABILITY.SEVERITY.HIGH"},{severity:3,severityLevel:"VULNERABILITY.SEVERITY.MEDIUM"},{severity:2,severityLevel:"VULNERABILITY.SEVERITY.LOW"},{severity:0,severityLevel:"VULNERABILITY.SEVERITY.NONE"}],this.isOpen=!1,this.closable=!1,this.staticBackdrop=!0,this.notify=new e.vpe,this.policy={},this.onlySignedImages=!1,this.triggerType=c.pA.MANUAL,this.loading=!1,this.buttonStatus=s.xp5.DEFAULT,this.providers=[],this.preventVul=!1,this.triggers=[c.pA.MANUAL,c.pA.SCHEDULED,c.pA.EVENT_BASED],this.enableContentTrust=!1,this._nameSubject=new Z.x,this.isNameExisting=!1,this.checkNameOnGoing=!1,this.hasInit=new e.vpe}ngOnInit(){const t=this.route.snapshot.parent.parent.data;if(t){const i=t.projectResolver;this.projectName=i.name,this.projectId=i.project_id,this.getProject()}this.subscribeName()}ngOnDestroy(){this._nameSubscription&&(this._nameSubscription.unsubscribe(),this._nameSubscription=null)}subscribeName(){this._nameSubscription||(this._nameSubscription=this._nameSubject.pipe((0,A.b)(500),(0,B.x)(),(0,K.h)(t=>(!this.isEdit||!this.originPolicyForEdit||this.originPolicyForEdit.name!==t)&&t.length>0),(0,C.w)(t=>(this.isNameExisting=!1,this.checkNameOnGoing=!0,this.preheatService.ListPolicies({projectName:this.projectName,q:encodeURIComponent(`name=${t}`)}).pipe((0,P.x)(()=>this.checkNameOnGoing=!1))))).subscribe(t=>{t&&t.length>0&&(this.isNameExisting=!0)}))}inputName(){this._nameSubject.next(this.policy.name)}getProject(){this.projectService.getProject(this.projectId).subscribe(t=>{t&&t.metadata&&(this.preventVul=t.metadata.prevent_vul===M,this.projectSeverity=t.metadata.severity,this.enableContentTrust=t.metadata.enable_content_trust===M,this.severity=c.Yt[this.projectSeverity]),this.hasInit.emit(!0)})}resetForAdd(){this.inlineAlert.close(),this.policy={},this.repos=null,this.tags=null,this.labels=null,this.cron=null,this.isNameExisting=!1,this.providers&&this.providers.length&&this.providers.forEach(t=>{t.default&&(this.policy.provider_id=t.id)}),this.currentForm.reset({triggerType:"manual",severity:c.Yt[this.projectSeverity],onlySignedImages:this.enableContentTrust,provider:this.policy.provider_id})}setCron(t){this.cron=t,this.cronScheduleComponent.resetSchedule()}getCron(){const t={type:"None",cron:""};return t.cron=this.cron,t.type=""===t.cron||null==t.cron?"None":"0 0 * * * *"===t.cron?"Hourly":"0 0 0 * * *"===t.cron?"Daily":"0 0 0 * * 0"===t.cron?"Weekly":"Custom",t}onCancel(){this.isOpen=!1}closeModal(){this.isOpen=!1}addOrSave(t){const i={};Object.assign(i,this.policy),i.provider_id=+i.provider_id;const o=[];this.repos&&(-1!==this.repos.indexOf(",")&&-1===this.repos.indexOf("{")&&-1===this.repos.indexOf("}")?o.push({type:c.kQ.REPOS,value:`{${this.repos}}`}):o.push({type:c.kQ.REPOS,value:this.repos})),this.tags&&(-1!==this.tags.indexOf(",")&&-1===this.tags.indexOf("{")&&-1===this.tags.indexOf("}")?o.push({type:c.kQ.TAG,value:`{${this.tags}}`}):o.push({type:c.kQ.TAG,value:this.tags})),this.labels&&(-1!==this.labels.indexOf(",")&&-1===this.labels.indexOf("{")&&-1===this.labels.indexOf("}")?o.push({type:c.kQ.LABEL,value:`{${this.labels}}`}):o.push({type:c.kQ.LABEL,value:this.labels})),i.filters=JSON.stringify(o),i.trigger=JSON.stringify({type:this.triggerType?this.triggerType:c.pA.MANUAL,trigger_setting:{cron:this.triggerType&&this.triggerType!==c.pA.MANUAL&&this.triggerType!==c.pA.EVENT_BASED?this.cron:""}}),this.loading=!0,this.buttonStatus=s.xp5.LOADING,(0,g.Xl)(i),t?(i.project_id=this.projectId,i.enabled=!0,this.preheatService.CreatePolicy({projectName:this.projectName,policy:i}).pipe((0,P.x)(()=>this.loading=!1)).subscribe(p=>{this.buttonStatus=s.xp5.SUCCESS,this.closeModal(),this.notify.emit(t)},p=>{this.inlineAlert.showInlineError(p),this.buttonStatus=s.xp5.ERROR})):(i.id=this.originPolicyForEdit.id,this.preheatService.UpdatePolicy({projectName:this.projectName,preheatPolicyName:this.originPolicyForEdit.name,policy:i}).pipe((0,P.x)(()=>this.loading=!1)).subscribe(p=>{this.buttonStatus=s.xp5.SUCCESS,this.closeModal(),this.notify.emit(t)},p=>{this.inlineAlert.showInlineError(p),this.buttonStatus=s.xp5.ERROR}))}valid(){return!(this.triggerType===c.pA.SCHEDULED&&!this.cron)&&this.currentForm.valid}compare(){return!!(this.projectSeverity&&this.preventVul&&c.Yt[this.projectSeverity]>(this.severity?this.severity:0))}hasChange(){return!(this.policy.provider_id==this.originPolicyForEdit.provider_id&&this.policy.name==this.originPolicyForEdit.name&&(!this.policy.description&&!this.originPolicyForEdit.description||this.policy.description==this.originPolicyForEdit.description)&&this.originReposForEdit==this.repos&&this.originTagsForEdit==this.tags&&this.originOnlySignedImagesForEdit==this.onlySignedImages&&this.originLabelsForEdit==this.labels&&this.originSeverityForEdit==this.severity&&this.originTriggerTypeForEdit==this.triggerType)||this.originCronForEdit!=this.cron}isSystemAdmin(){const t=this.session.getCurrentUser();return null!=t&&t.has_admin_role}getTriggerTypeI18n(t){return t?c.E3[t]:""}showCron(){return!!this.triggerType&&this.triggerType===c.pA.SCHEDULED}withNotary(){return this.appConfigService.getConfig().with_notary}showExplainForEventBased(){return this.triggerType===c.pA.EVENT_BASED}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(E.L),e.Y36($.m),e.Y36(d.gz),e.Y36(X._),e.Y36(m.Y4))},n.\u0275cmp=e.Xpm({type:n,selectors:[["add-p2p-policy"]],viewQuery:function(t,i){if(1&t&&(e.Gf(N.l,5),e.Gf(ee,7),e.Gf(te,5)),2&t){let o;e.iGM(o=e.CRH())&&(i.inlineAlert=o.first),e.iGM(o=e.CRH())&&(i.currentForm=o.first),e.iGM(o=e.CRH())&&(i.cronScheduleComponent=o.first)}},inputs:{providers:"providers"},outputs:{notify:"notify",hasInit:"hasInit"},decls:91,vars:71,consts:[[3,"clrModalOpen","clrModalStaticBackdrop","clrModalClosable","clrModalOpenChange"],["class","modal-title",4,"ngIf"],[1,"modal-body"],[1,"align-center"],[1,"modal-title"],[1,"clr-form","clr-form-horizontal"],["policyForm","ngForm"],[1,"form-block"],[1,"clr-control-label","required","width-6rem"],["clrSelect","","name","provider","id","provider","required","",1,"width-380",3,"disabled","ngModel","ngModelChange"],["provider","ngModel"],["value","",1,"display-none"],[3,"selected","value",4,"ngFor","ngForOf"],[4,"ngIf"],["class","clr-form-control mt-0",4,"ngIf"],[1,"clr-form-control"],["for","name",1,"clr-control-label","required","width-6rem"],[1,"clr-control-container"],[1,"clr-input-wrapper"],["pattern","^[a-z0-9]+(?:[._-][a-z0-9]+)*$","autocomplete","off","type","text","id","name","size","30","name","name","required","",1,"clr-input","width-380",3,"disabled","ngModel","ngModelChange","input"],["name","ngModel"],["shape","exclamation-circle",1,"clr-validate-icon"],[1,"spinner","spinner-inline",3,"hidden"],["for","description",1,"clr-control-label","width-6rem"],["autocomplete","off","type","text","id","description","name","description",1,"clr-textarea","width-380",3,"disabled","ngModel","ngModelChange"],["description","ngModel"],["for","repo",1,"clr-control-label","width-6rem"],[1,"sub-label","required"],["placeholder","**","autocomplete","off","type","text","id","repo","size","30","name","repo","required","",1,"clr-input","width-290",3,"disabled","ngModel","ngModelChange"],["repo","ngModel"],[1,"margin-left-90px","opacity-08"],["class","margin-left-90px",4,"ngIf"],[1,"clr-form-control","margin-top-06"],["for","repo",1,"width-6rem"],["placeholder","**","autocomplete","off","type","text","id","tag","size","30","name","tag","required","",1,"clr-input","width-290",3,"disabled","ngModel","ngModelChange"],["tag","ngModel"],[1,"sub-label"],["autocomplete","off","type","text","id","labels","size","30","name","label",1,"clr-input","width-290",3,"disabled","ngModel","ngModelChange"],["class","clr-form-control margin-top-06",4,"ngIf"],["class","clr-form-control margin-top-06",3,"ngClass",4,"ngIf"],[1,"flex","baseline"],[1,"clr-control-label","width-6rem"],["clrSelect","","name","triggerType","id","trigger-type",1,"width-380",3,"disabled","ngModel","ngModelChange"],["ngTriggerType","ngModel"],["class","mt-1 bottom-btn",4,"ngIf"],[3,"selected","value"],[1,"clr-form-control","mt-0"],[1,"clr-control-container","width-380"],[1,"space-between"],["class","alert-label",4,"ngIf"],["class","go-link","routerLink","/harbor/distribution/instances",4,"ngIf"],[1,"alert-label"],["routerLink","/harbor/distribution/instances",1,"go-link"],[1,"margin-left-90px"],["clrTooltipTrigger","","shape","info-circle","size","24",1,"cri-tooltip"],["clrPosition","top-left","clrSize","lg",4,"clrIfOpen"],[1,"clr-control-container","opacity-054"],[1,"clr-checkbox-wrapper"],["disabled","","type","checkbox","id","onlySignedImages","name","onlySignedImages",1,"clr-checkbox",3,"ngModel","ngModelChange"],["for","onlySignedImages",1,"font-size-12"],["clrPosition","top-left","clrSize","lg"],[1,"clr-form-control","margin-top-06",3,"ngClass"],[1,"clr-control-container","flex"],[1,"sub-text","opacity-054"],[1,"clr-select-wrapper"],["disabled","","id","severity","name","severity",1,"clr-select",3,"ngModel","ngModelChange"],["ngSeverity","ngModel"],["clrTooltipTrigger","","shape","info-circle","size","24",1,"tooltip"],["clrTooltipTrigger","","shape","info-circle","size","24"],["clrPosition","top-right","clrSize","lg",4,"clrIfOpen"],["clrPosition","top-right","clrSize","lg"],[3,"isInlineModel","originCron","inputvalue"],["cronScheduleComponent",""],[1,"mt-1","bottom-btn"],["type","button","id","add-policy-cancel",1,"btn","btn-outline",3,"click"],["type","button","id","new-policy",1,"btn","btn-primary",3,"clrLoading","disabled","click"],["type","button","id","edit-policy-cancel",1,"btn","btn-outline",3,"click"],["type","button","id","edit-policy-save",1,"btn","btn-primary",3,"clrLoading","disabled","click"]],template:function(t,i){if(1&t&&(e.TgZ(0,"clr-modal",0),e.NdJ("clrModalOpenChange",function(r){return i.isOpen=r}),e.YNc(1,ie,3,3,"h3",1),e.YNc(2,ne,3,3,"h3",1),e.TgZ(3,"div",2)(4,"div",3),e._UZ(5,"inline-alert",4),e.TgZ(6,"form",5,6)(8,"section",7)(9,"clr-select-container")(10,"label",8),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"select",9,10),e.NdJ("ngModelChange",function(r){return i.policy.provider_id=r}),e._UZ(15,"option",11),e.YNc(16,oe,2,3,"option",12),e.qZA(),e.YNc(17,re,3,3,"clr-control-error",13),e.qZA(),e.YNc(18,ae,7,3,"div",14),e.TgZ(19,"div",15)(20,"label",16),e._uU(21),e.ALo(22,"translate"),e.qZA(),e.TgZ(23,"div",17)(24,"div",18)(25,"input",19,20),e.NdJ("ngModelChange",function(r){return i.policy.name=r})("input",function(){return i.inputName()}),e.qZA(),e._UZ(27,"clr-icon",21)(28,"span",22),e.qZA(),e.YNc(29,ge,3,2,"clr-control-error",13),e.qZA()(),e.TgZ(30,"div",15)(31,"label",23),e._uU(32),e.ALo(33,"translate"),e.qZA(),e.TgZ(34,"div",17)(35,"textarea",24,25),e.NdJ("ngModelChange",function(r){return i.policy.description=r}),e.qZA()()(),e.TgZ(37,"div",15)(38,"label",26),e._uU(39),e.ALo(40,"translate"),e.qZA(),e.TgZ(41,"div",17)(42,"div",18)(43,"label",27),e._uU(44),e.ALo(45,"translate"),e.qZA(),e.TgZ(46,"input",28,29),e.NdJ("ngModelChange",function(r){return i.repos=r}),e.qZA(),e._UZ(48,"clr-icon",21),e.qZA(),e.TgZ(49,"clr-control-helper",30),e._uU(50),e.ALo(51,"translate"),e.qZA(),e.YNc(52,_e,3,3,"clr-control-error",31),e.qZA()(),e.TgZ(53,"div",32),e._UZ(54,"label",33),e.TgZ(55,"div",17)(56,"div",18)(57,"label",27),e._uU(58),e.ALo(59,"translate"),e.qZA(),e.TgZ(60,"input",34,35),e.NdJ("ngModelChange",function(r){return i.tags=r}),e.qZA(),e._UZ(62,"clr-icon",21),e.qZA(),e.TgZ(63,"clr-control-helper",30),e._uU(64),e.ALo(65,"translate"),e.qZA(),e.YNc(66,ue,3,3,"clr-control-error",31),e.qZA()(),e.TgZ(67,"div",32),e._UZ(68,"label",26),e.TgZ(69,"div",17)(70,"div",18)(71,"label",36),e._uU(72),e.ALo(73,"translate"),e.qZA(),e.TgZ(74,"input",37),e.NdJ("ngModelChange",function(r){return i.labels=r}),e.qZA(),e._UZ(75,"clr-icon",21),e.qZA()()(),e.YNc(76,Pe,14,7,"div",38),e.YNc(77,Ce,16,12,"div",39),e.TgZ(78,"div",40)(79,"clr-select-container")(80,"label",41),e._uU(81),e.ALo(82,"translate"),e.qZA(),e.TgZ(83,"select",42,43),e.NdJ("ngModelChange",function(r){return i.triggerType=r}),e._UZ(85,"option",11),e.YNc(86,Oe,3,5,"option",12),e.qZA()(),e.YNc(87,Ze,3,0,"clr-tooltip",13),e.qZA(),e.YNc(88,Ee,5,2,"div",38),e.qZA()(),e.YNc(89,ve,7,8,"div",44),e.YNc(90,ye,7,8,"div",44),e.qZA()()()),2&t){const o=e.MAs(14),r=e.MAs(26),p=e.MAs(47),h=e.MAs(61);e.Q6J("clrModalOpen",i.isOpen)("clrModalStaticBackdrop",i.staticBackdrop)("clrModalClosable",i.closable),e.xp6(1),e.Q6J("ngIf",i.isEdit),e.xp6(1),e.Q6J("ngIf",!i.isEdit),e.xp6(9),e.Oqu(e.lcZ(12,51,"P2P_PROVIDER.PROVIDER")),e.xp6(2),e.ekj("clr-error",o.errors&&o.errors.required&&(o.dirty||o.touched)),e.Q6J("disabled",i.loading)("ngModel",i.policy.provider_id),e.xp6(3),e.Q6J("ngForOf",i.providers),e.xp6(1),e.Q6J("ngIf",o.errors&&o.errors.required&&(o.dirty||o.touched)),e.xp6(1),e.Q6J("ngIf",!(i.providers&&i.providers.length)),e.xp6(3),e.Oqu(e.lcZ(22,53,"P2P_PROVIDER.NAME")),e.xp6(2),e.ekj("clr-error",(r.dirty||r.touched)&&r.invalid||i.isNameExisting),e.xp6(2),e.Q6J("disabled",i.loading)("ngModel",i.policy.name),e.xp6(3),e.Q6J("hidden",!i.checkNameOnGoing),e.xp6(1),e.Q6J("ngIf",(r.dirty||r.touched)&&r.invalid||i.isNameExisting),e.xp6(3),e.Oqu(e.lcZ(33,55,"P2P_PROVIDER.DESCRIPTION")),e.xp6(3),e.Q6J("disabled",i.loading)("ngModel",i.policy.description),e.xp6(4),e.Oqu(e.lcZ(40,57,"P2P_PROVIDER.FILTERS")),e.xp6(2),e.ekj("clr-error",p.errors&&p.errors.required&&(p.dirty||p.touched)),e.xp6(3),e.Oqu(e.lcZ(45,59,"P2P_PROVIDER.REPOS")),e.xp6(2),e.Q6J("disabled",i.loading)("ngModel",i.repos),e.xp6(4),e.Oqu(e.lcZ(51,61,"TAG_RETENTION.REP_SEPARATOR")),e.xp6(2),e.Q6J("ngIf",p.errors&&p.errors.required&&(p.dirty||p.touched)),e.xp6(3),e.ekj("clr-error",h.errors&&h.errors.required&&(h.dirty||h.touched)),e.xp6(3),e.Oqu(e.lcZ(59,63,"P2P_PROVIDER.TAGS")),e.xp6(2),e.Q6J("disabled",i.loading)("ngModel",i.tags),e.xp6(4),e.Oqu(e.lcZ(65,65,"P2P_PROVIDER.TAG_SEPARATOR")),e.xp6(2),e.Q6J("ngIf",h.errors&&h.errors.required&&(h.dirty||h.touched)),e.xp6(6),e.Oqu(e.lcZ(73,67,"P2P_PROVIDER.LABELS")),e.xp6(2),e.Q6J("disabled",i.loading)("ngModel",i.labels),e.xp6(2),e.Q6J("ngIf",i.withNotary()&&i.enableContentTrust),e.xp6(1),e.Q6J("ngIf",i.preventVul),e.xp6(4),e.Oqu(e.lcZ(82,69,"P2P_PROVIDER.TRIGGER")),e.xp6(2),e.Q6J("disabled",i.loading)("ngModel",i.triggerType),e.xp6(3),e.Q6J("ngForOf",i.triggers),e.xp6(1),e.Q6J("ngIf",i.showExplainForEventBased()),e.xp6(1),e.Q6J("ngIf",i.showCron()),e.xp6(1),e.Q6J("ngIf",!i.isEdit),e.xp6(1),e.Q6J("ngIf",i.isEdit)}},dependencies:[d.yS,u._Y,u.YN,u.Kr,u.Fj,u.Wl,u.EJ,u.JJ,u.JL,u.Q7,u.c5,u.On,u.F,s.qvL,s.qAN,s.VLi,s.cCV,s.nqY,s.MPb,s.MgK,s.VqA,s.CM6,s.otW,s.dTv,s.Jmj,s.bMv,s.zDF,T.mk,T.sg,T.O5,N.l,W.x,_.X$],styles:["[_nghost-%COMP%]  .modal-dialog{width:30rem}.display-none[_ngcontent-%COMP%]{display:none}.icon-tooltip[_ngcontent-%COMP%]{margin-top:4px}.padding-top-3[_ngcontent-%COMP%]{padding-top:3px}.bottom-btn[_ngcontent-%COMP%]{text-align:right}.width-380[_ngcontent-%COMP%]{width:380px}.width-290[_ngcontent-%COMP%]{width:290px}.width-6rem[_ngcontent-%COMP%]{width:6rem!important}.clr-control-label[_ngcontent-%COMP%]{width:8rem}.sub-label[_ngcontent-%COMP%]{display:inline-block;width:90px;font-size:.5417rem;font-weight:400}.sub-text[_ngcontent-%COMP%]{font-size:.5417rem;font-weight:400}.flex[_ngcontent-%COMP%]{display:flex}.margin-top-06[_ngcontent-%COMP%]{margin-top:.6rem}.margin-left-90px[_ngcontent-%COMP%]{margin-left:90px}.opacity-08[_ngcontent-%COMP%]{opacity:.8}.space-between[_ngcontent-%COMP%]{display:flex;font-size:12px;justify-content:space-between}.go-link[_ngcontent-%COMP%]{line-height:1rem;cursor:pointer}.alert-label[_ngcontent-%COMP%]{color:#f9392e}.warning[_ngcontent-%COMP%]{width:320px;line-height:.5rem;white-space:normal;height:auto}.cri-tooltip[_ngcontent-%COMP%]{margin-top:-2px}.cri-tooltip[_ngcontent-%COMP%]:focus{outline:none}.baseline[_ngcontent-%COMP%]{align-items:baseline}.opacity-054[_ngcontent-%COMP%]{opacity:.54}.font-size-12[_ngcontent-%COMP%]{font-size:12px}"]}),n})();var y=a(8726),I=a(38),Ie=a(6344),Se=a(7677),Le=a(4241);const Re=["confirmationDialogComponent"];function be(n,l){1&n&&(e.TgZ(0,"clr-tooltip-content",28),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"P2P_PROVIDER.PREHEAT_EXPLAIN")," "))}function Ne(n,l){1&n&&(e.TgZ(0,"span"),e._UZ(1,"clr-icon",38),e.TgZ(2,"span",39),e._uU(3),e.ALo(4,"translate"),e.qZA()()),2&n&&(e.xp6(3),e.Oqu(e.lcZ(4,1,"WEBHOOK.ENABLED_BUTTON")))}function Me(n,l){1&n&&(e.TgZ(0,"span"),e._UZ(1,"clr-icon",40),e.TgZ(2,"span",39),e._uU(3),e.ALo(4,"translate"),e.qZA()()),2&n&&(e.xp6(3),e.Oqu(e.lcZ(4,1,"WEBHOOK.DISABLED_BUTTON")))}function De(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"clr-dropdown-menu")(1,"button",29),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.executePolicy())}),e.TgZ(2,"span"),e._UZ(3,"clr-icon",30),e.TgZ(4,"span",31),e._uU(5),e.ALo(6,"translate"),e.qZA()()(),e.TgZ(7,"button",29),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.editPolicy())}),e.TgZ(8,"span"),e._UZ(9,"clr-icon",32),e.TgZ(10,"span",33),e._uU(11),e.ALo(12,"translate"),e.qZA()()(),e.TgZ(13,"button",29),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.switchStatus())}),e.TgZ(14,"span",34),e.YNc(15,Ne,5,3,"span",23),e.YNc(16,Me,5,3,"span",23),e.qZA()(),e._UZ(17,"div",35),e.TgZ(18,"button",29),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.deletePolicy())}),e.TgZ(19,"span"),e._UZ(20,"clr-icon",36),e.TgZ(21,"span",37),e._uU(22),e.ALo(23,"translate"),e.qZA()()()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("disabled",!(t.selectedRow&&t.selectedRow.enabled)||!t.hasUpdatePermission||t.executing),e.xp6(4),e.Oqu(e.lcZ(6,9,"P2P_PROVIDER.EXECUTE")),e.xp6(2),e.Q6J("disabled",!t.selectedRow||!t.hasUpdatePermission),e.xp6(4),e.Oqu(e.lcZ(12,11,"BUTTON.EDIT")),e.xp6(2),e.Q6J("disabled",!t.selectedRow||!t.hasUpdatePermission),e.xp6(2),e.Q6J("ngIf",t.selectedRow&&!t.selectedRow.enabled),e.xp6(1),e.Q6J("ngIf",!(t.selectedRow&&!t.selectedRow.enabled)),e.xp6(2),e.Q6J("disabled",!t.selectedRow||!t.hasDeletePermission),e.xp6(4),e.Oqu(e.lcZ(23,13,"BUTTON.DELETE"))}}function Ue(n,l){1&n&&(e.TgZ(0,"div",46),e._UZ(1,"clr-icon",47),e.TgZ(2,"span",39),e._uU(3),e.ALo(4,"translate"),e.qZA()()),2&n&&(e.xp6(3),e.Oqu(e.lcZ(4,1,"WEBHOOK.ENABLED")))}function qe(n,l){1&n&&(e.TgZ(0,"div",46),e._UZ(1,"clr-icon",48),e.TgZ(2,"span",39),e._uU(3),e.ALo(4,"translate"),e.qZA()()),2&n&&(e.xp6(3),e.Oqu(e.lcZ(4,1,"WEBHOOK.DISABLED")))}function we(n,l){if(1&n&&(e.TgZ(0,"span")(1,"span",49),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"span",50),e._uU(5),e.qZA()()),2&n){const t=e.oxw().$implicit,i=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,2,"P2P_PROVIDER.REPOS")),e.xp6(3),e.hij(": ",i.getValue(t.filters,"repository"),"")}}function ke(n,l){if(1&n&&(e.TgZ(0,"span",51)(1,"span",49),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"span",50),e._uU(5),e.qZA()()),2&n){const t=e.oxw().$implicit,i=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,2,"P2P_PROVIDER.TAGS")),e.xp6(3),e.hij(": ",i.getValue(t.filters,"tag"),"")}}function Je(n,l){if(1&n&&(e.TgZ(0,"span",51)(1,"span",49),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"span",50),e._uU(5),e.qZA()()),2&n){const t=e.oxw().$implicit,i=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,2,"P2P_PROVIDER.LABELS")),e.xp6(3),e.hij(": ",i.getValue(t.filters,"label"),"")}}function je(n,l){1&n&&(e.TgZ(0,"div",52)(1,"span",49),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&n&&(e.xp6(2),e.Oqu(e.lcZ(3,1,"P2P_PROVIDER.ONLY_SIGNED")))}function Ve(n,l){if(1&n&&(e.TgZ(0,"div",52)(1,"span"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"span",50),e._uU(5),e.qZA(),e.TgZ(6,"span"),e._uU(7),e.ALo(8,"translate"),e.qZA()()),2&n){const t=e.oxw().$implicit,i=e.oxw();e.xp6(2),e.hij("",e.lcZ(3,3,"P2P_PROVIDER.START_TEXT"),"\xa0"),e.xp6(3),e.Oqu(i.severity_map[i.getValue(t.filters,"vulnerability")]),e.xp6(2),e.hij("\xa0",e.lcZ(8,5,"P2P_PROVIDER.EDN_TEXT"),"")}}function Ye(n,l){if(1&n&&(e.TgZ(0,"clr-signpost-content"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit,i=e.oxw();e.xp6(1),e.hij(" ",i.getScheduledCron(t.trigger)," ")}}function Fe(n,l){1&n&&(e.TgZ(0,"clr-signpost"),e.YNc(1,Ye,2,1,"clr-signpost-content",12),e.qZA())}function Qe(n,l){1&n&&(e.TgZ(0,"clr-signpost-content")(1,"div"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"div"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"div"),e._uU(11),e.ALo(12,"translate"),e.qZA()()),2&n&&(e.xp6(2),e.hij(" ",e.lcZ(3,4,"P2P_PROVIDER.EVENT_BASED_EXPLAIN_LINE1")," "),e.xp6(3),e.hij(" ",e.lcZ(6,6,"P2P_PROVIDER.EVENT_BASED_EXPLAIN_LINE2")," "),e.xp6(3),e.hij(" ",e.lcZ(9,8,"P2P_PROVIDER.EVENT_BASED_EXPLAIN_LINE3")," "),e.xp6(3),e.hij(" ",e.lcZ(12,10,"P2P_PROVIDER.EVENT_BASED_EXPLAIN_LINE4")," "))}function ze(n,l){1&n&&(e.TgZ(0,"clr-signpost"),e.YNc(1,Qe,13,12,"clr-signpost-content",12),e.qZA())}function Ge(n,l){if(1&n&&(e.TgZ(0,"clr-dg-row",41)(1,"clr-dg-cell"),e._uU(2),e.qZA(),e.TgZ(3,"clr-dg-cell"),e.YNc(4,Ue,5,3,"div",42),e.YNc(5,qe,5,3,"div",42),e.qZA(),e.TgZ(6,"clr-dg-cell"),e._uU(7),e.qZA(),e.TgZ(8,"clr-dg-cell")(9,"div"),e.YNc(10,we,6,4,"span",23),e.YNc(11,ke,6,4,"span",43),e.YNc(12,Je,6,4,"span",43),e.qZA(),e.YNc(13,je,4,3,"div",44),e.YNc(14,Ve,9,7,"div",44),e.qZA(),e.TgZ(15,"clr-dg-cell",45),e._uU(16),e.ALo(17,"translate"),e.YNc(18,Fe,2,0,"clr-signpost",23),e.YNc(19,ze,2,0,"clr-signpost",23),e.qZA(),e.TgZ(20,"clr-dg-cell"),e._uU(21),e.ALo(22,"harborDatetime"),e.qZA(),e.TgZ(23,"clr-dg-cell"),e._uU(24),e.qZA()()),2&n){const t=l.$implicit,i=e.oxw();e.Q6J("clrDgItem",t),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Q6J("ngIf",t.enabled),e.xp6(1),e.Q6J("ngIf",!t.enabled),e.xp6(2),e.Oqu(t.provider_name),e.xp6(3),e.Q6J("ngIf",i.getValue(t.filters,"repository")),e.xp6(1),e.Q6J("ngIf",i.getValue(t.filters,"tag")),e.xp6(1),e.Q6J("ngIf",i.getValue(t.filters,"label")),e.xp6(1),e.Q6J("ngIf",i.getValue(t.filters,"signature")),e.xp6(1),e.Q6J("ngIf",i.getValue(t.filters,"vulnerability")),e.xp6(2),e.hij(" ",e.lcZ(17,15,i.getTriggerTypeI18n(t.trigger))," "),e.xp6(2),e.Q6J("ngIf",i.isScheduled(t.trigger)),e.xp6(1),e.Q6J("ngIf",i.isEventBased(t.trigger)),e.xp6(2),e.Oqu(e.xi3(22,17,t.creation_time,"short")),e.xp6(3),e.Oqu(t.description)}}function He(n,l){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){e.oxw();const t=e.MAs(53);e.xp6(1),e.lnq("",t.firstItem+1," - ",t.lastItem+1," ",e.lcZ(2,3,"DESTINATION.OF"),"")}}function Be(n,l){1&n&&e._UZ(0,"clr-icon",67)}function Ke(n,l){if(1&n&&(e.TgZ(0,"clr-tooltip-content",68)(1,"span"),e._uU(2),e.qZA()()),2&n){const t=e.oxw().$implicit;e.Q6J("clrPosition","left"),e.xp6(2),e.Oqu(t.status_message)}}function $e(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"clr-dg-row",41)(1,"clr-dg-cell")(2,"a",64),e.NdJ("click",function(){const r=e.CHM(t).$implicit,p=e.oxw(2);return e.KtG(p.goToLink(r.id))}),e._uU(3),e.qZA()(),e.TgZ(4,"clr-dg-cell"),e._uU(5),e.TgZ(6,"clr-tooltip"),e.YNc(7,Be,1,0,"clr-icon",65),e.YNc(8,Ke,3,2,"clr-tooltip-content",66),e.qZA()(),e.TgZ(9,"clr-dg-cell"),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"clr-dg-cell"),e._uU(13),e.ALo(14,"harborDatetime"),e.qZA(),e.TgZ(15,"clr-dg-cell"),e._uU(16),e.qZA(),e.TgZ(17,"clr-dg-cell"),e._uU(18),e.ALo(19,"percent"),e.qZA(),e.TgZ(20,"clr-dg-cell"),e._uU(21),e.qZA()()}if(2&n){const t=l.$implicit,i=e.oxw(2);e.Q6J("clrDgItem",t),e.xp6(3),e.Oqu(t.id),e.xp6(2),e.hij(" ",t.status," "),e.xp6(2),e.Q6J("ngIf",t.status_message),e.xp6(3),e.Oqu(e.lcZ(11,9,i.getTriggerTypeI18nForExecution(t.trigger))),e.xp6(3),e.Oqu(e.xi3(14,11,t.start_time,"short")),e.xp6(3),e.Oqu(i.getDuration(t)),e.xp6(2),e.Oqu(e.lcZ(19,14,i.getSuccessRate(t.metrics))),e.xp6(3),e.Oqu(t.vendor_type)}}function Xe(n,l){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n){e.oxw();const t=e.MAs(53);e.xp6(1),e.lnq("",t.firstItem+1," - ",t.lastItem+1," ",e.lcZ(2,3,"REPLICATION.OF"),"")}}const We=function(){return[15,25,50]};function et(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",53)(1,"h4",54),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"clr-datagrid",55),e.NdJ("clrDgSingleSelectedChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.selectedExecutionRow=o)})("clrDgRefresh",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.clrLoadJobs(null,!0,o))}),e.TgZ(5,"clr-dg-action-bar")(6,"div",5)(7,"div",6)(8,"button",56),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.openStopExecutionsDialog())}),e._uU(9),e.ALo(10,"translate"),e.qZA()(),e.TgZ(11,"div",57)(12,"div",58)(13,"select",59),e.NdJ("change",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.selectFilterKey(o))}),e.TgZ(14,"option",60),e._uU(15),e.ALo(16,"lowercase"),e.ALo(17,"translate"),e.qZA(),e.TgZ(18,"option",61),e._uU(19),e.ALo(20,"lowercase"),e.ALo(21,"translate"),e.qZA()()(),e.TgZ(22,"hbr-filter",62),e.NdJ("filterEvt",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.doFilter(o))})("openFlag",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.openFilter(o))}),e.ALo(23,"translate"),e.qZA(),e.TgZ(24,"span",15)(25,"clr-icon",16),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.refreshJobs())}),e.qZA()()()()(),e.TgZ(26,"clr-dg-column"),e._uU(27),e.ALo(28,"translate"),e.qZA(),e.TgZ(29,"clr-dg-column"),e._uU(30),e.ALo(31,"translate"),e.qZA(),e.TgZ(32,"clr-dg-column"),e._uU(33),e.ALo(34,"translate"),e.qZA(),e.TgZ(35,"clr-dg-column"),e._uU(36),e.ALo(37,"translate"),e.qZA(),e.TgZ(38,"clr-dg-column"),e._uU(39),e.ALo(40,"translate"),e.qZA(),e.TgZ(41,"clr-dg-column"),e._uU(42),e.ALo(43,"translate"),e.qZA(),e.TgZ(44,"clr-dg-column"),e._uU(45),e.ALo(46,"translate"),e.qZA(),e.TgZ(47,"clr-dg-placeholder"),e._uU(48),e.ALo(49,"translate"),e.qZA(),e.YNc(50,$e,22,16,"clr-dg-row",19),e.TgZ(51,"clr-dg-footer")(52,"clr-dg-pagination",63,21),e.NdJ("clrDgPageChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.currentExecutionPage=o)}),e.TgZ(54,"clr-dg-page-size",22),e._uU(55),e.ALo(56,"translate"),e.qZA(),e.YNc(57,Xe,3,5,"span",23),e._uU(58),e.ALo(59,"translate"),e.qZA()()()()}if(2&n){const t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,29,"P2P_PROVIDER.EXECUTIONS")),e.xp6(2),e.Q6J("clrDgSingleSelected",t.selectedExecutionRow)("clrDgLoading",t.jobsLoading),e.xp6(4),e.Q6J("disabled",!t.hasUpdatePermission||!t.selectedExecutionRow||t.jobsLoading||t.stopLoading||!t.canStop()),e.xp6(1),e.hij(" ",e.lcZ(10,31,"REPLICATION.STOPJOB")," "),e.xp6(3),e.Q6J("hidden",!t.isOpenFilterTag),e.xp6(3),e.hij(" ",e.lcZ(16,33,e.lcZ(17,35,"P2P_PROVIDER.ID"))," "),e.xp6(4),e.hij(" ",e.lcZ(20,37,e.lcZ(21,39,"REPLICATION.STATUS"))," "),e.xp6(3),e.s9C("filterPlaceholder",e.lcZ(23,41,"REPLICATION.FILTER_EXECUTIONS_PLACEHOLDER")),e.Q6J("currentValue",t.searchString)("withDivider",!0),e.xp6(3),e.Q6J("hidden",t.loading),e.xp6(2),e.Oqu(e.lcZ(28,43,"REPLICATION.ID")),e.xp6(3),e.Oqu(e.lcZ(31,45,"REPLICATION.STATUS")),e.xp6(3),e.Oqu(e.lcZ(34,47,"P2P_PROVIDER.TRIGGER")),e.xp6(3),e.Oqu(e.lcZ(37,49,"REPLICATION.CREATION_TIME")),e.xp6(3),e.Oqu(e.lcZ(40,51,"REPLICATION.DURATION")),e.xp6(3),e.Oqu(e.lcZ(43,53,"REPLICATION.SUCCESS_RATE")),e.xp6(3),e.Oqu(e.lcZ(46,55,"P2P_PROVIDER.PROVIDER_TYPE")),e.xp6(3),e.Oqu(e.lcZ(49,57,"P2P_PROVIDER.JOB_PLACEHOLDER")),e.xp6(2),e.Q6J("ngForOf",t.executionList),e.xp6(2),e.Q6J("clrDgPage",t.currentExecutionPage)("clrDgPageSize",t.pageSize)("clrDgTotalItems",t.totalExecutionCount),e.xp6(2),e.Q6J("clrPageSizeOptions",e.DdM(63,We)),e.xp6(1),e.Oqu(e.lcZ(56,59,"PAGINATION.PAGE_SIZE")),e.xp6(2),e.Q6J("ngIf",t.totalExecutionCount),e.xp6(1),e.AsE(" ",t.totalExecutionCount," ",e.lcZ(59,61,"REPLICATION.ITEMS")," ")}}const tt=function(){return[10,25,50]},U=/\/harbor\/projects\/(\d+)\/p2p-provider\/policies/;let it=(()=>{class n{constructor(t,i,o,r,p,h,L,rt,st){this.route=t,this.router=i,this.translate=o,this.p2pProviderService=r,this.messageHandlerService=p,this.userPermissionService=h,this.preheatService=L,this.event=rt,this.scheduleService=st,this.policyList=[],this.providers=[],this.loading=!0,this.hasCreatPermission=!1,this.hasUpdatePermission=!1,this.hasDeletePermission=!1,this.addBtnState=s.xp5.DEFAULT,this.executing=!1,this.isOpenFilterTag=!1,this.jobsLoading=!1,this.stopLoading=!1,this.executionList=[],this.currentExecutionPage=1,this.pageSize=(0,g.tb)(g.V2.P2P_POLICY_COMPONENT_EXECUTIONS),this.totalExecutionCount=0,this.filterKey="id",this._searchSubject=new Z.x,this.severity_map=c.Yp,this.hasAddModalInit=!1,this.policyPageSize=(0,g.tb)(g.V2.P2P_POLICY_COMPONENT,10),this.policyPage=1,this.totalPolicy=0,this.paused=!1}ngOnInit(){this.scheduleService.getSchedulePaused({jobType:Ie.O4.ALL}).subscribe(i=>{this.paused=i?.paused}),this.scrollSub||(this.scrollSub=this.event.subscribe(I.n.SCROLL,i=>{i&&U.test(i.url)&&(this.scrollTop=i.scrollTop)})),this.routerSub||(this.routerSub=this.router.events.subscribe(i=>{i instanceof d.m2&&(i&&U.test(i.url)?this.event.publish(I.n.SCROLL_TO_POSITION,this.scrollTop):this.event.publish(I.n.SCROLL_TO_POSITION,0))})),this.subscribeSearch(),this.projectId=+this.route.snapshot.parent.parent.params.id;const t=this.route.snapshot.parent.parent.data;t&&(this.projectName=t.projectResolver.name),this.getPermissions()}ngOnDestroy(){this.routerSub&&(this.routerSub.unsubscribe(),this.routerSub=null),this.scrollSub&&(this.scrollSub.unsubscribe(),this.scrollSub=null),this._searchSubscription&&(this._searchSubscription.unsubscribe(),this._searchSubscription=null),this.clearLoop()}addModalInit(){this.hasAddModalInit=!0}getPermissions(){const t=[];t.push(this.userPermissionService.getPermission(this.projectId,m._W.P2P_PROVIDER.KEY,m._W.P2P_PROVIDER.VALUE.CREATE)),t.push(this.userPermissionService.getPermission(this.projectId,m._W.P2P_PROVIDER.KEY,m._W.P2P_PROVIDER.VALUE.UPDATE)),t.push(this.userPermissionService.getPermission(this.projectId,m._W.P2P_PROVIDER.KEY,m._W.P2P_PROVIDER.VALUE.DELETE)),this.addBtnState=s.xp5.LOADING,(0,f.D)(...t).subscribe(i=>{[this.hasCreatPermission,this.hasUpdatePermission,this.hasDeletePermission]=i,this.addBtnState=s.xp5.SUCCESS,this.hasCreatPermission&&this.getProviders()},i=>{this.messageHandlerService.error(i),this.addBtnState=s.xp5.ERROR})}getProviders(){this.preheatService.ListProvidersUnderProject({projectName:this.projectName}).subscribe(t=>{t&&t.length&&(this.providers=t.filter(i=>i.enabled))})}refresh(){this.selectedRow=null,this.policyPage=1,this.totalPolicy=0,this.getPolicies(this.state)}getPolicies(t){let i,o;t&&(this.state=t),t&&t.page&&(this.policyPageSize=t.page.size,(0,g.Pe)(g.V2.P2P_POLICY_COMPONENT,this.policyPageSize)),t&&t.filters&&t.filters.length&&(i=encodeURIComponent(`${t.filters[0].property}=~${t.filters[0].value}`)),o=t&&t.sort&&t.sort.by?(0,g.td)(t):"-creation_time",this.loading=!0,this.preheatService.ListPoliciesResponse({projectName:this.projectName,sort:o,q:i,page:this.policyPage,pageSize:this.policyPageSize}).pipe((0,P.x)(()=>this.loading=!1)).subscribe(r=>{if(r.headers){let p=r.headers.get("X-Total-Count");p&&(this.totalPolicy=parseInt(p,0))}this.policyList=r.body||[]},r=>{this.messageHandlerService.handleError(r)})}switchStatus(){let t="";this.translate.get(this.selectedRow.enabled?"P2P_PROVIDER.DISABLED_POLICY_SUMMARY":"P2P_PROVIDER.ENABLED_POLICY_SUMMARY",{name:this.selectedRow.name}).subscribe(i=>{t=i;let o=new y.c(this.selectedRow.enabled?"P2P_PROVIDER.DISABLED_POLICY_TITLE":"P2P_PROVIDER.ENABLED_POLICY_TITLE",t,"",{},20,this.selectedRow.enabled?5:4);this.confirmationDialogComponent.open(o)})}confirmSwitch(t){if(t&&21===t.source&&1===t.state){this.stopLoading=!0;const i=(0,g.d9)(this.selectedExecutionRow);i.status=c.r9.STOPPED,this.preheatService.StopExecution({projectName:this.projectName,preheatPolicyName:this.selectedRow.name,executionId:this.selectedExecutionRow.id,execution:i}).pipe((0,P.x)(()=>this.executing=!1)).subscribe(o=>{this.messageHandlerService.showSuccess("P2P_PROVIDER.STOP_SUCCESSFULLY")},o=>{this.messageHandlerService.error(o)})}if(t&&22===t.source&&1===t.state&&(this.executing=!0,this.preheatService.ManualPreheat({projectName:this.projectName,preheatPolicyName:this.selectedRow.name,policy:this.selectedRow}).pipe((0,P.x)(()=>this.executing=!1)).subscribe(i=>{this.messageHandlerService.showSuccess("P2P_PROVIDER.EXECUTE_SUCCESSFULLY"),this.selectedRow&&this.refreshJobs()},i=>{this.messageHandlerService.error(i)})),t&&20===t.source&&1===t.state&&"{}"===JSON.stringify(t.data)&&this.preheatService.UpdatePolicy({projectName:this.projectName,preheatPolicyName:this.selectedRow.name,policy:Object.assign({},this.selectedRow,{enabled:!this.selectedRow.enabled})}).subscribe(i=>{this.messageHandlerService.showSuccess("P2P_PROVIDER.UPDATED_SUCCESSFULLY"),this.refresh()},i=>{this.messageHandlerService.handleError(i)}),t&&23===t.source&&1===t.state){const i=[];i.push(this.preheatService.DeletePolicy({projectName:this.projectName,preheatPolicyName:this.selectedRow.name})),(0,f.D)(...i).subscribe(o=>{this.messageHandlerService.showSuccess("P2P_PROVIDER.DELETE_SUCCESSFULLY"),this.refresh()},o=>{this.messageHandlerService.handleError(o)})}}newPolicy(){this.addP2pPolicyComponent.isOpen=!0,this.addP2pPolicyComponent.isEdit=!1,this.addP2pPolicyComponent.resetForAdd()}editPolicy(){if(this.selectedRow){this.addP2pPolicyComponent.repos=null,this.addP2pPolicyComponent.tags=null,this.addP2pPolicyComponent.labels=null,this.addP2pPolicyComponent.isOpen=!0,this.addP2pPolicyComponent.isEdit=!0,this.addP2pPolicyComponent.isNameExisting=!1,this.addP2pPolicyComponent.inlineAlert.close(),this.addP2pPolicyComponent.policy=(0,g.d9)(this.selectedRow);const t=JSON.parse(this.selectedRow.filters);t&&t.length&&t.forEach(o=>{if(o.type===c.kQ.REPOS&&o.value){let r=o.value;if(/^{\S+}$/.test(r))return r.slice(1,r.length-1);this.addP2pPolicyComponent.repos=r}if(o.type===c.kQ.TAG&&o.value){let r=o.value;if(/^{\S+}$/.test(r))return r.slice(1,r.length-1);this.addP2pPolicyComponent.tags=r}if(o.type===c.kQ.LABEL&&o.value){let r=o.value;if(/^{\S+}$/.test(r))return r.slice(1,r.length-1);this.addP2pPolicyComponent.labels=r}});const i=JSON.parse(this.selectedRow.trigger);i&&(this.addP2pPolicyComponent.triggerType=i.type,this.addP2pPolicyComponent.cron=i.trigger_setting.cron),this.addP2pPolicyComponent.currentForm.reset({provider:this.addP2pPolicyComponent.policy.provider_id,name:this.addP2pPolicyComponent.policy.name,description:this.addP2pPolicyComponent.policy.description,repo:this.addP2pPolicyComponent.repos,tag:this.addP2pPolicyComponent.tags,onlySignedImages:this.addP2pPolicyComponent.enableContentTrust,severity:this.addP2pPolicyComponent.severity,label:this.addP2pPolicyComponent.labels,triggerType:this.addP2pPolicyComponent.triggerType}),this.addP2pPolicyComponent.originPolicyForEdit=(0,g.d9)(this.selectedRow),this.addP2pPolicyComponent.originReposForEdit=this.addP2pPolicyComponent.repos,this.addP2pPolicyComponent.originTagsForEdit=this.addP2pPolicyComponent.tags,this.addP2pPolicyComponent.originOnlySignedImagesForEdit=this.addP2pPolicyComponent.onlySignedImages,this.addP2pPolicyComponent.originSeverityForEdit=this.addP2pPolicyComponent.severity,this.addP2pPolicyComponent.originLabelsForEdit=this.addP2pPolicyComponent.labels,this.addP2pPolicyComponent.originTriggerTypeForEdit=this.addP2pPolicyComponent.triggerType,this.addP2pPolicyComponent.originCronForEdit=this.addP2pPolicyComponent.cron}}deletePolicy(){const t=[];t.push(this.selectedRow.name);let i="";this.translate.get("P2P_PROVIDER.DELETE_POLICY_SUMMARY",{names:t.join(",")}).subscribe(r=>i=r);const o=new y.c("SCANNER.CONFIRM_DELETION",i,t.join(","),this.selectedRow,23,2);this.confirmationDialogComponent.open(o)}executePolicy(){if(this.selectedRow&&this.selectedRow.enabled){const t=new y.c("P2P_PROVIDER.EXECUTE_TITLE","P2P_PROVIDER.EXECUTE_SUMMARY",this.selectedRow.name,this.selectedRow,22,0);this.confirmationDialogComponent.open(t)}}success(t){let i;i=t?"P2P_PROVIDER.ADDED_SUCCESS":"P2P_PROVIDER.UPDATED_SUCCESS",this.messageHandlerService.showSuccess(i),this.refresh()}clrLoadJobs(t,i,o){if(this.selectedRow){let r;o&&o.page&&(this.pageSize=o.page.size,(0,g.Pe)(g.V2.P2P_POLICY_COMPONENT_EXECUTIONS,this.pageSize)),i&&setTimeout(()=>{this.jobsLoading=!0}),this.searchString&&(r=encodeURIComponent(`${this.filterKey}=~${this.searchString}`)),this.preheatService.ListExecutionsResponse({projectName:this.projectName,preheatPolicyName:t?t.name:this.selectedRow.name,page:this.currentExecutionPage,pageSize:this.pageSize,q:r}).pipe((0,P.x)(()=>this.jobsLoading=!1)).subscribe(p=>{if(p.headers){let h=p.headers.get("X-Total-Count");h&&(this.totalExecutionCount=parseInt(h,0))}this.executionList=p.body,this.setLoop()},p=>{this.messageHandlerService.handleError(p)})}}refreshJobs(t){this.executionList=[],this.currentExecutionPage=1,this.totalExecutionCount=0,this.filterKey="id",this.searchString=null,this.clrLoadJobs(t,!0)}openStopExecutionsDialog(){if(this.selectedExecutionRow){const t=new y.c("P2P_PROVIDER.STOP_TITLE","P2P_PROVIDER.STOP_SUMMARY",this.selectedExecutionRow.id+"",this.selectedExecutionRow,21,0);this.confirmationDialogComponent.open(t)}}goToLink(t){this.router.navigate(["harbor","projects",`${this.projectId}`,"p2p-provider",`${this.selectedRow.name}`,"executions",`${t}`,"tasks"])}getTriggerTypeI18n(t){return JSON.parse(t).type?this.paused&&JSON.parse(t).type===c.pA.SCHEDULED?c.E3[c.pA.SCHEDULED_PAUSED]:c.E3[JSON.parse(t).type]:c.E3[c.pA.MANUAL]}getTriggerTypeI18nForExecution(t){return t&&c.E3[t]?c.E3[t]:t}isScheduled(t){return JSON.parse(t).type===c.pA.SCHEDULED}isEventBased(t){return JSON.parse(t).type===c.pA.EVENT_BASED}getScheduledCron(t){return JSON.parse(t).trigger_setting.cron}getDuration(t){return this.p2pProviderService.getDuration(t.start_time,t.end_time)}getValue(t,i){const o=JSON.parse(t);if(o&&o.length)for(let r=0;r<o.length;r++)if(o[r].type===i&&o[r].value){let p=o[r].value;return/^{\S+}$/.test(p)?p.slice(1,p.length-1):p}return""}getSuccessRate(t){return t&&t.task_count&&t.success_task_count?t.success_task_count/t.task_count:0}selectFilterKey(t){this.filterKey=t.target.value}openFilter(t){this.isOpenFilterTag=t}doFilter(t){this.searchString=t,t.trim()?this._searchSubject.next(t.trim()):this.clrLoadJobs(null,!0)}subscribeSearch(){this._searchSubscription||(this._searchSubscription=this._searchSubject.pipe((0,A.b)(500),(0,C.w)(t=>{let i;return this.jobsLoading=!0,this.searchString&&(i=encodeURIComponent(`${this.filterKey}=~${t}`)),this.preheatService.ListExecutionsResponse({projectName:this.projectName,preheatPolicyName:this.selectedRow.name,page:1,pageSize:this.pageSize,q:i}).pipe((0,P.x)(()=>this.jobsLoading=!1))})).subscribe(t=>{if(t.headers){let i=t.headers.get("x-total-count");i&&(this.totalExecutionCount=parseInt(i,0))}this.executionList=t.body,this.setLoop()}))}canStop(){return this.selectedExecutionRow&&this.p2pProviderService.willChangStatus(this.selectedExecutionRow.status)}clearLoop(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}setLoop(){if(this.clearLoop(),this.executionList&&this.executionList.length)for(let t=0;t<this.executionList.length;t++)this.p2pProviderService.willChangStatus(this.executionList[t].status)&&(this.timeout||(this.timeout=setTimeout(()=>{this.clrLoadJobs(null,!1)},c.X8)))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(d.gz),e.Y36(d.F0),e.Y36(_.sK),e.Y36(c.YQ),e.Y36(x.d),e.Y36(m.Hx),e.Y36(E.L),e.Y36(I.P),e.Y36(Se.u))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ng-component"]],viewQuery:function(t,i){if(1&t&&(e.Gf(D,5),e.Gf(Re,5)),2&t){let o;e.iGM(o=e.CRH())&&(i.addP2pPolicyComponent=o.first),e.iGM(o=e.CRH())&&(i.confirmationDialogComponent=o.first)}},decls:64,vars:57,consts:[[1,"row"],[1,"mt-1"],["clrTooltipTrigger","","shape","info-circle","size","24",1,"color-57"],["clrPosition","top-right","clrSize","lg",4,"clrIfOpen"],[3,"clrDgLoading","clrDgSingleSelected","clrDgRefresh","clrDgSingleSelectedChange"],[1,"clr-row"],[1,"clr-col-7"],["id","new-policy","type","button",1,"btn","btn-secondary",3,"disabled","clrLoading","click"],["shape","plus","size","16"],["clrDropdownTrigger","",1,"btn","btn-link",3,"clrCloseMenuOnItemClick"],["id","action-policy"],["shape","caret down",1,"clr-icon"],[4,"clrIfOpen"],[1,"clr-col-5"],[1,"action-head-pos"],[1,"refresh-btn"],["shape","refresh",3,"hidden","click"],[3,"clrDgField"],[3,"clrDgSortBy"],[3,"clrDgItem",4,"ngFor","ngForOf"],[3,"clrDgPageSize","clrDgPage","clrDgTotalItems","clrDgPageChange"],["pagination",""],[3,"clrPageSizeOptions"],[4,"ngIf"],["class","col-lg-12 col-md-12 col-sm-12 col-xs-12",4,"ngIf"],[3,"providers","hasInit","notify"],[3,"confirmAction"],["confirmationDialogComponent",""],["clrPosition","top-right","clrSize","lg"],["clrDropdownItem","",1,"btn","btn-secondary",3,"disabled","click"],["size","16","shape","play",1,"margin-top-0"],["id","execute-policy",1,"margin-left-5px"],["size","16","shape","pencil",1,"margin-top-0"],["id","edit-policy",1,"margin-left-5px"],["id","toggle-policy"],[1,"dropdown-divider"],["size","16","shape","times",1,"margin-top-0"],["id","delete-policy",1,"margin-left-5px"],["size","16","shape","success-standard",1,"margin-top-2"],[1,"margin-left-5px"],["size","16","shape","ban",1,"margin-top-2"],[3,"clrDgItem"],["class","icon-wrap",4,"ngIf"],["class","margin-left-10px",4,"ngIf"],["class","margin-top-5px",4,"ngIf"],[1,"no-wrapper"],[1,"icon-wrap"],["shape","check-circle","size","20",1,"is-success","enabled-icon"],["shape","exclamation-triangle","size","20",1,"is-warning"],[1,"filter-title"],[1,"opacity08"],[1,"margin-left-10px"],[1,"margin-top-5px"],[1,"col-lg-12","col-md-12","col-sm-12","col-xs-12"],[1,"mt-2"],[3,"clrDgSingleSelected","clrDgLoading","clrDgSingleSelectedChange","clrDgRefresh"],["type","button",1,"btn","btn-secondary",3,"disabled","click"],[1,"clr-col-5","flex-end"],[1,"select","filter-tag","clr-select-wrapper",3,"hidden"],["id","selectKey",3,"change"],["value","id"],["value","status"],["id","filter-executions",3,"currentValue","withDivider","filterPlaceholder","filterEvt","openFlag"],[3,"clrDgPage","clrDgPageSize","clrDgTotalItems","clrDgPageChange"],["href","javascript:void(0)",3,"click"],["clrTooltipTrigger","","shape","info-circle","size","20",4,"ngIf"],["clrSize","md",3,"clrPosition",4,"clrIfOpen"],["clrTooltipTrigger","","shape","info-circle","size","20"],["clrSize","md",3,"clrPosition"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"h4",1)(2,"span"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"clr-tooltip"),e._UZ(6,"clr-icon",2),e.YNc(7,be,3,3,"clr-tooltip-content",3),e.qZA()(),e.TgZ(8,"clr-datagrid",4),e.NdJ("clrDgRefresh",function(r){return i.getPolicies(r)})("clrDgSingleSelectedChange",function(r){return i.refreshJobs(r)})("clrDgSingleSelectedChange",function(r){return i.selectedRow=r}),e.TgZ(9,"clr-dg-action-bar")(10,"div",5)(11,"div",6)(12,"button",7),e.NdJ("click",function(){return i.newPolicy()}),e._UZ(13,"clr-icon",8),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"clr-dropdown",9)(17,"span",10),e._uU(18),e.ALo(19,"translate"),e._UZ(20,"clr-icon",11),e.qZA(),e.YNc(21,De,24,15,"clr-dropdown-menu",12),e.qZA()(),e.TgZ(22,"div",13)(23,"div",14)(24,"span",15)(25,"clr-icon",16),e.NdJ("click",function(){return i.refresh()}),e.qZA()()()()()(),e.TgZ(26,"clr-dg-column",17),e._uU(27),e.ALo(28,"translate"),e.qZA(),e.TgZ(29,"clr-dg-column"),e._uU(30),e.ALo(31,"translate"),e.qZA(),e.TgZ(32,"clr-dg-column"),e._uU(33),e.ALo(34,"translate"),e.qZA(),e.TgZ(35,"clr-dg-column"),e._uU(36),e.ALo(37,"translate"),e.qZA(),e.TgZ(38,"clr-dg-column"),e._uU(39),e.ALo(40,"translate"),e.qZA(),e.TgZ(41,"clr-dg-column",18),e._uU(42),e.ALo(43,"translate"),e.qZA(),e.TgZ(44,"clr-dg-column"),e._uU(45),e.ALo(46,"translate"),e.qZA(),e.TgZ(47,"clr-dg-placeholder"),e._uU(48),e.ALo(49,"translate"),e.qZA(),e.YNc(50,Ge,25,20,"clr-dg-row",19),e.TgZ(51,"clr-dg-footer")(52,"clr-dg-pagination",20,21),e.NdJ("clrDgPageChange",function(r){return i.policyPage=r}),e.TgZ(54,"clr-dg-page-size",22),e._uU(55),e.ALo(56,"translate"),e.qZA(),e.YNc(57,He,3,5,"span",23),e._uU(58),e.ALo(59,"translate"),e.qZA()()()(),e.YNc(60,et,60,64,"div",24),e.TgZ(61,"add-p2p-policy",25),e.NdJ("hasInit",function(){return i.addModalInit()})("notify",function(r){return i.success(r)}),e.qZA(),e.TgZ(62,"confirmation-dialog",26,27),e.NdJ("confirmAction",function(r){return i.confirmSwitch(r)}),e.qZA()),2&t&&(e.xp6(3),e.Oqu(e.lcZ(4,30,"P2P_PROVIDER.POLICIES")),e.xp6(5),e.Q6J("clrDgLoading",i.loading)("clrDgSingleSelected",i.selectedRow),e.xp6(4),e.Q6J("disabled",!i.hasCreatPermission||!i.hasAddModalInit)("clrLoading",i.addBtnState),e.xp6(2),e.hij(" ",e.lcZ(15,32,"P2P_PROVIDER.NEW_POLICY")," "),e.xp6(2),e.Q6J("clrCloseMenuOnItemClick",!1),e.xp6(2),e.hij("",e.lcZ(19,34,"MEMBER.ACTION")," "),e.xp6(7),e.Q6J("hidden",i.loading),e.xp6(1),e.Q6J("clrDgField","name"),e.xp6(1),e.Oqu(e.lcZ(28,36,"P2P_PROVIDER.NAME")),e.xp6(3),e.Oqu(e.lcZ(31,38,"P2P_PROVIDER.ENABLED")),e.xp6(3),e.Oqu(e.lcZ(34,40,"P2P_PROVIDER.PROVIDER")),e.xp6(3),e.Oqu(e.lcZ(37,42,"P2P_PROVIDER.FILTERS")),e.xp6(3),e.Oqu(e.lcZ(40,44,"P2P_PROVIDER.TRIGGER")),e.xp6(2),e.Q6J("clrDgSortBy","creation_time"),e.xp6(1),e.Oqu(e.lcZ(43,46,"P2P_PROVIDER.CREATED")),e.xp6(3),e.Oqu(e.lcZ(46,48,"P2P_PROVIDER.DESCRIPTION")),e.xp6(3),e.hij(" ",e.lcZ(49,50,"P2P_PROVIDER.NO_POLICY")," "),e.xp6(2),e.Q6J("ngForOf",i.policyList),e.xp6(2),e.Q6J("clrDgPageSize",i.policyPageSize)("clrDgPage",i.policyPage)("clrDgTotalItems",i.totalPolicy),e.xp6(2),e.Q6J("clrPageSizeOptions",e.DdM(56,tt)),e.xp6(1),e.Oqu(e.lcZ(56,52,"PAGINATION.PAGE_SIZE")),e.xp6(2),e.Q6J("ngIf",i.totalPolicy),e.xp6(1),e.AsE(" ",i.totalPolicy," ",e.lcZ(59,54,"DESTINATION.ITEMS")," "),e.xp6(2),e.Q6J("ngIf",i.selectedRow),e.xp6(1),e.Q6J("providers",i.providers))},dependencies:[u.YN,u.Kr,s.C9t,s.Gwl,s.m4W,s.Z4N,s.fv_,s.dRQ,s.Ltv,s.YYR,s.F7K,s.PDs,s.KHL,s.Gcc,s.jND,s.Nh1,s.dml,s.K8c,s.qvL,s.cCV,s.nqY,s.MPb,s.f_W,s.zwp,s.ZUS,s.lU3,s.EuU,s.hQ,s.Jmj,s.bMv,s.zDF,T.sg,T.O5,R.z,Le.z,D,_.X$,T.i8,T.Zx,b.Z],styles:[".action-head-pos[_ngcontent-%COMP%]{padding-right:18px;height:100%;display:flex;justify-content:flex-end;align-items:center}.icon-wrap[_ngcontent-%COMP%]{display:flex;align-items:center;height:20px}.cell[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;height:100%}.margin-left-5px[_ngcontent-%COMP%]{margin-left:5px}.margin-left-10px[_ngcontent-%COMP%]{margin-left:10px}.flex-end[_ngcontent-%COMP%]{align-items:center;display:flex;justify-content:flex-end;padding-right:1.5rem}.refresh-btn[_ngcontent-%COMP%]{margin-top:6px;cursor:pointer}.filter-tag[_ngcontent-%COMP%]{margin-top:7px}.filter-title[_ngcontent-%COMP%]{font-weight:400}.margin-top-5px[_ngcontent-%COMP%]{margin-top:5px}.opacity08[_ngcontent-%COMP%]{opacity:.8}.no-wrapper[_ngcontent-%COMP%]{white-space:nowrap}"]}),n})();var q=a(2554);const nt=[{path:"policies",component:it,data:{reuse:!0,routeConfigId:q.j.P2P_POLICIES_PAGE}},{path:":preheatPolicyName/executions/:executionId/tasks",component:H,data:{routeConfigId:q.j.P2P_TASKS_PAGE}},{path:"",redirectTo:"policies",pathMatch:"full"}];let ot=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({providers:[c.YQ],imports:[d.Bz.forChild(nt),S.m]}),n})()},8348:(w,v,a)=>{a.d(v,{z:()=>Z});var d=a(4650),S=a(7579),A=a(8372),C=a(4006),P=a(6895),g=a(9375);const m=["inputElement"];function c(f,s){1&f&&d._UZ(0,"span",4)}let Z=(()=>{class f{constructor(e){this.cd=e,this.placeHolder="",this.filterTerms=new S.x,this.isExpanded=!1,this.filterEvt=new d.vpe,this.openFlag=new d.vpe,this.readonly=null,this.expandMode=!1,this.withDivider=!1}set filterPlaceholder(e){this.placeHolder=e}ngOnInit(){this.filterTerms.pipe((0,A.b)(500)).subscribe(e=>{this.filterEvt.emit(e)})}valueChange(){this.filterTerms.next(this.currentValue&&this.currentValue.trim())}inputFocus(){this.openFlag.emit(this.isExpanded)}onClick(){this.expandMode||(this.isExpanded=!this.isExpanded,this.isExpanded&&(this.cd.detectChanges(),this.inputElement.nativeElement.focus()),this.openFlag.emit(this.isExpanded))}get isShowSearchBox(){return this.expandMode||!this.expandMode&&this.isExpanded}}return f.\u0275fac=function(e){return new(e||f)(d.Y36(d.sBO))},f.\u0275cmp=d.Xpm({type:f,selectors:[["hbr-filter"]],viewQuery:function(e,_){if(1&e&&d.Gf(m,5),2&e){let x;d.iGM(x=d.CRH())&&(_.inputElement=x.first)}},inputs:{readonly:"readonly",currentValue:"currentValue",filterPlaceholder:"filterPlaceholder",expandMode:"expandMode",withDivider:"withDivider",width:"width"},outputs:{filterEvt:"filterEvt",openFlag:"openFlag"},decls:5,vars:9,consts:[["shape","search","size","20",1,"search-btn",3,"click"],["type","text","autofocus","",1,"filter-input","clr-input",3,"hidden","placeholder","ngModel","keyup","focus","ngModelChange"],["inputElement",""],["class","filter-divider",4,"ngIf"],[1,"filter-divider"]],template:function(e,_){1&e&&(d.TgZ(0,"span")(1,"clr-icon",0),d.NdJ("click",function(){return _.onClick()}),d.qZA(),d.TgZ(2,"input",1,2),d.NdJ("keyup",function(){return _.valueChange()})("focus",function(){return _.inputFocus()})("ngModelChange",function(E){return _.currentValue=E}),d.qZA(),d.YNc(4,c,1,0,"span",3),d.qZA()),2&e&&(d.xp6(1),d.ekj("filter-icon",_.isShowSearchBox),d.xp6(1),d.Udp("width",_.width,"px"),d.s9C("placeholder",_.placeHolder),d.Q6J("hidden",!_.isShowSearchBox)("ngModel",_.currentValue),d.uIk("readOnly",_.readonly),d.xp6(2),d.Q6J("ngIf",_.withDivider))},dependencies:[C.Fj,C.JJ,C.On,P.O5,g.qvL],styles:[".filter-icon[_ngcontent-%COMP%]{position:relative;right:-20px}.filter-divider[_ngcontent-%COMP%]{display:inline-block;height:16px;width:1px;padding-top:12px;padding-bottom:12px;position:relative;top:9px;margin-right:6px;margin-left:6px}.search-btn[_ngcontent-%COMP%]{cursor:pointer}.search-btn[_ngcontent-%COMP%]:hover{color:#007cbb}.filter-input[_ngcontent-%COMP%]{padding-left:24px}"]}),f})()}}]);