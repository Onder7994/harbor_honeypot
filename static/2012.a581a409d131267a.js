"use strict";(self.webpackChunkharbor_portal=self.webpackChunkharbor_portal||[]).push([[2012],{2012:(y,O,s)=>{s.r(O),s.d(O,{AuditLogModule:()=>N});var o=s(858),A=s(6296),v=s(8746),m=s(3526),e=s(4650),C=s(5266),D=s(9151),c=s(9375),_=s(6895),u=s(8348),h=s(4006);let d=(()=>{class i{constructor(){this.valFn=h.kI.nullValidator}ngOnChanges(t){this.valFn=t.dateValidator?i=>{let a=i.value,t=!0;if(a){const r=/^(0[1-9]|[12][0-9]|3[01])[- /.](0[1-9]|1[012])[- /.](19|20)\d\d$/g;t=/^(19|20)\d\d([- /.])(0[1-9]|1[012])\2(0[1-9]|[12][0-9]|3[01])$/g.test(a)||r.test(a)}return t?null:{dateValidator:{value:a}}}:h.kI.nullValidator}validate(t){return this.valFn(t)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275dir=e.lG2({type:i,selectors:[["","dateValidator",""]],inputs:{dateValidator:"dateValidator"},features:[e._Bn([{provide:h.Cf,useExisting:i,multi:!0}]),e.TTD]}),i})();var g=s(2466);const L=["searchTime"];function E(i,a){1&i&&(e.TgZ(0,"span",4),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"AUDIT_LOG.INVALID_DATE")," "))}let P=(()=>{class i{constructor(){this.search=new e.vpe}ngOnChanges(){this.dateInput=this.dateInput.trim()}get dateInvalid(){return this.searchTime.errors&&this.searchTime.errors.dateValidator&&(this.searchTime.dirty||this.searchTime.touched)||!1}doSearch(){let t="";this.searchTime.valid&&this.dateInput&&(t=this.searchTime.value),this.search.emit(t)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["hbr-datetime"]],viewQuery:function(t,n){if(1&t&&e.Gf(L,7),2&t){let r;e.iGM(r=e.CRH())&&(n.searchTime=r.first)}},inputs:{dateInput:"dateInput",oneDayOffset:"oneDayOffset"},outputs:{search:"search"},features:[e.TTD],decls:4,vars:4,consts:[["aria-haspopup","true","role","tooltip",1,"tooltip","tooltip-validation","tooltip-sm"],["clrDate","","type","date","name","searchTime","placeholder","mm/dd/yyyy","dateValidator","",3,"ngModel","ngModelChange"],["searchTime","ngModel"],["class","tooltip-content",4,"ngIf"],[1,"tooltip-content"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"input",1,2),e.NdJ("ngModelChange",function(l){return n.dateInput=l})("ngModelChange",function(){return n.doSearch()}),e.qZA(),e.YNc(3,E,3,3,"span",3),e.qZA()),2&t&&(e.ekj("invalid",n.dateInvalid),e.xp6(1),e.Q6J("ngModel",n.dateInput),e.xp6(2),e.Q6J("ngIf",n.dateInvalid))},dependencies:[h.Fj,h.JJ,h.On,_.O5,c.Tsp,d,g.X$],styles:[".tooltip.tooltip-validation.invalid[_ngcontent-%COMP%]:before{top:.7em;right:3em}.tooltip[_ngcontent-%COMP%] > .tooltip-content[_ngcontent-%COMP%]{opacity:1;visibility:visible;left:75%;background-color:#c92100}"]}),i})();var Z=s(3046);function I(i,a){1&i&&e._UZ(0,"span",26)}function x(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"a",23),e.NdJ("click",function(){const l=e.CHM(t).$implicit,f=e.oxw(2);return e.KtG(f.toggleFilterOption(l.key))}),e._UZ(1,"clr-icon",24),e.YNc(2,I,1,0,"ng-template",25),e._uU(3),e.ALo(4,"translate"),e.qZA()}if(2&i){const t=a.$implicit;e.xp6(1),e.Q6J("hidden",!t.checked),e.xp6(1),e.Q6J("ngIf",!t.checked),e.xp6(1),e.hij(" ",e.lcZ(4,3,t.description)," ")}}function M(i,a){if(1&i&&(e.TgZ(0,"clr-dropdown-menu",21),e.YNc(1,x,5,5,"a",22),e.qZA()),2&i){const t=e.oxw();e.Q6J("clrPosition","bottom-left"),e.xp6(1),e.Q6J("ngForOf",t.filterOptions)}}function U(i,a){if(1&i&&(e.TgZ(0,"clr-dg-row")(1,"clr-dg-cell"),e._uU(2),e.qZA(),e.TgZ(3,"clr-dg-cell"),e._uU(4),e.qZA(),e.TgZ(5,"clr-dg-cell"),e._uU(6),e.qZA(),e.TgZ(7,"clr-dg-cell"),e._uU(8),e.qZA(),e.TgZ(9,"clr-dg-cell"),e._uU(10),e.ALo(11,"harborDatetime"),e.qZA()()),2&i){const t=a.$implicit;e.xp6(2),e.Oqu(t.username),e.xp6(2),e.Oqu(t.resource),e.xp6(2),e.Oqu(t.resource_type),e.xp6(2),e.Oqu(t.operation),e.xp6(2),e.Oqu(e.xi3(11,5,t.op_time,"short"))}}function S(i,a){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){e.oxw();const t=e.MAs(41);e.xp6(1),e.lnq("",t.firstItem+1," - ",t.lastItem+1," ",e.lcZ(2,3,"AUDIT_LOG.OF")," ")}}const k=function(){return[15,25,50]},w={0:"AUDIT_LOG.ADVANCED",1:"AUDIT_LOG.SIMPLE"};class T{constructor(a,t,n){this.iKey=a,this.iDescription=t,this.iChecked=n,this.key=a,this.description=t,this.checked=n}toString(){return"key:"+this.key+", description:"+this.description+", checked:"+this.checked+"\n"}}class q{constructor(){this.startTime="",this.endTime=""}}const F=[{path:"",component:(()=>{class i{constructor(t,n,r,l){this.route=t,this.router=n,this.auditLogService=r,this.messageHandlerService=l,this.search=new q,this.queryOperation=[],this.loading=!0,this.toggleName=w,this.currentOption=0,this.filterOptions=[new T("all","AUDIT_LOG.ALL_OPERATIONS",!0),new T("pull","AUDIT_LOG.PULL",!0),new T("create","AUDIT_LOG.CREATE",!0),new T("delete","AUDIT_LOG.DELETE",!0),new T("others","AUDIT_LOG.OTHERS",!0)],this.pageOffset=1,this.pageSize=(0,m.tb)(m.V2.PROJECT_AUDIT_LOG_COMPONENT),this.totalRecordCount=0,this.currentPage=1,this.totalPage=0,this.route.data.subscribe(f=>this.currentUser=f.auditLogResolver)}get showPaginationIndex(){return this.totalRecordCount>0}ngOnInit(){const t=this.route.parent.parent.snapshot.data;t&&(this.projectName=t.projectResolver.name)}retrieve(t){t&&t.page&&(this.pageSize=t.page.size,(0,m.Pe)(m.V2.PROJECT_AUDIT_LOG_COMPONENT,this.pageSize));const n=[];this.queryUsername&&n.push(`username=~${this.queryUsername}`),this.queryStartTime&&this.queryEndTime?n.push(`op_time=[${this.queryStartTime}~${this.queryEndTime}]`):(this.queryStartTime&&n.push(`op_time=[${this.queryStartTime}~]`),this.queryEndTime&&n.push(`op_time=[~${this.queryEndTime}]`)),this.queryOperation&&this.queryOperation.length>0&&n.push(`operation={${this.queryOperation.join(" ")}}`);const r={projectName:this.projectName,pageSize:this.pageSize,page:this.currentPage};n&&n.length>0&&(r.q=encodeURIComponent(n.join(","))),this.loading=!0,this.auditLogService.getLogsResponse(r).pipe((0,v.x)(()=>this.loading=!1)).subscribe(l=>{if(l.headers){let f=l.headers.get("x-total-count");f&&(this.totalRecordCount=Number.parseInt(f,10))}this.auditLogs=l.body},l=>{this.messageHandlerService.handleError(l)})}doSearchAuditLogs(t){this.queryUsername=t,this.retrieve()}doSearchByStartTime(t){this.queryStartTime=t,this.retrieve()}doSearchByEndTime(t){this.queryEndTime=t,this.retrieve()}doSearchByOptions(){let t=!0,n=[];for(let r of this.filterOptions)r.checked?n.push(r.key):t=!1;t&&(n=[]),this.queryOperation=n,this.retrieve()}toggleOptionalName(t){this.currentOption=1===t?0:1}toggleFilterOption(t){let n=this.filterOptions.find(r=>r.key===t);if(n.checked=!n.checked,"all"===n.key)this.filterOptions.filter(r=>r.key!==n.key).forEach(r=>r.checked=n.checked);else{n.checked||(this.filterOptions.find(l=>"all"===l.key).checked=!1);let r=!0;this.filterOptions.filter(l=>"all"!==l.key).forEach(l=>{l.checked||(r=!1)}),this.filterOptions.find(l=>"all"===l.key).checked=r}this.doSearchByOptions()}refresh(){this.retrieve()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(o.gz),e.Y36(o.F0),e.Y36(C.Y),e.Y36(D.d))},i.\u0275cmp=e.Xpm({type:i,selectors:[["audit-log"]],decls:48,vars:44,consts:[[1,"row"],[1,"col-lg-12","col-md-12","col-sm-12","col-xs-12","reverse-row","log-top"],[1,"row","flex-items-xs-right","option-right","display-f"],[1,"flex-xs-middle"],[1,"btn","btn-link",3,"click"],[3,"withDivider","filterPlaceholder","filterEvt"],[1,"refresh-btn",3,"click"],["shape","refresh"],[1,"row","flex-items-xs-right","row-right",3,"hidden"],["clrDropdownToggle","",1,"btn","btn-link"],["shape","caret down"],[3,"clrPosition",4,"clrIfOpen"],[3,"dateInput","search"],[3,"dateInput","oneDayOffset","search"],[1,"col-lg-12","col-md-12","col-sm-12","col-xs-12","datagrid-margin-top"],[3,"clrDgLoading","clrDgRefresh"],[4,"ngFor","ngForOf"],[3,"clrDgPageSize","clrDgPage","clrDgTotalItems","clrDgPageChange"],["pagination",""],[3,"clrPageSizeOptions"],[4,"ngIf"],[3,"clrPosition"],["href","javascript:void(0)","clrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["href","javascript:void(0)","clrDropdownItem","",3,"click"],["shape","check",3,"hidden"],[3,"ngIf"],[1,"check-span"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),e.NdJ("click",function(){return n.toggleOptionalName(n.currentOption)}),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"hbr-filter",5),e.NdJ("filterEvt",function(l){return n.doSearchAuditLogs(l)}),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"span",6),e.NdJ("click",function(){return n.refresh()}),e._UZ(10,"clr-icon",7),e.qZA()()(),e.TgZ(11,"div",8)(12,"clr-dropdown")(13,"button",9),e._uU(14),e.ALo(15,"translate"),e._UZ(16,"clr-icon",10),e.qZA(),e.YNc(17,M,2,2,"clr-dropdown-menu",11),e.qZA(),e.TgZ(18,"div",3)(19,"hbr-datetime",12),e.NdJ("search",function(l){return n.doSearchByStartTime(l)}),e.qZA(),e.TgZ(20,"hbr-datetime",13),e.NdJ("search",function(l){return n.doSearchByEndTime(l)}),e.qZA()()()(),e.TgZ(21,"div",14)(22,"clr-datagrid",15),e.NdJ("clrDgRefresh",function(l){return n.retrieve(l)}),e.TgZ(23,"clr-dg-column"),e._uU(24),e.ALo(25,"translate"),e.qZA(),e.TgZ(26,"clr-dg-column"),e._uU(27),e.ALo(28,"translate"),e.qZA(),e.TgZ(29,"clr-dg-column"),e._uU(30),e.ALo(31,"translate"),e.qZA(),e.TgZ(32,"clr-dg-column"),e._uU(33),e.ALo(34,"translate"),e.qZA(),e.TgZ(35,"clr-dg-column"),e._uU(36),e.ALo(37,"translate"),e.qZA(),e.YNc(38,U,12,8,"clr-dg-row",16),e.TgZ(39,"clr-dg-footer")(40,"clr-dg-pagination",17,18),e.NdJ("clrDgPageChange",function(l){return n.currentPage=l}),e.TgZ(42,"clr-dg-page-size",19),e._uU(43),e.ALo(44,"translate"),e.qZA(),e.YNc(45,S,3,5,"span",20),e._uU(46),e.ALo(47,"translate"),e.qZA()()()()()),2&t&&(e.xp6(5),e.hij(" ",e.lcZ(6,23,n.toggleName[n.currentOption])," "),e.xp6(2),e.s9C("filterPlaceholder",e.lcZ(8,25,"AUDIT_LOG.FILTER_PLACEHOLDER")),e.Q6J("withDivider",!0),e.xp6(4),e.Q6J("hidden",0===n.currentOption),e.xp6(3),e.hij(" ",e.lcZ(15,27,"AUDIT_LOG.OPERATIONS")," "),e.xp6(5),e.Q6J("dateInput",n.search.startTime),e.xp6(1),e.Q6J("dateInput",n.search.endTime)("oneDayOffset",!0),e.xp6(2),e.Q6J("clrDgLoading",n.loading),e.xp6(2),e.Oqu(e.lcZ(25,29,"AUDIT_LOG.USERNAME")),e.xp6(3),e.Oqu(e.lcZ(28,31,"AUDIT_LOG.RESOURCE")),e.xp6(3),e.Oqu(e.lcZ(31,33,"AUDIT_LOG.RESOURCE_TYPE")),e.xp6(3),e.Oqu(e.lcZ(34,35,"AUDIT_LOG.OPERATION")),e.xp6(3),e.Oqu(e.lcZ(37,37,"AUDIT_LOG.TIMESTAMP")),e.xp6(2),e.Q6J("ngForOf",n.auditLogs),e.xp6(2),e.Q6J("clrDgPageSize",n.pageSize)("clrDgPage",n.currentPage)("clrDgTotalItems",n.totalRecordCount),e.xp6(2),e.Q6J("clrPageSizeOptions",e.DdM(43,k)),e.xp6(1),e.Oqu(e.lcZ(44,39,"PAGINATION.PAGE_SIZE")),e.xp6(2),e.Q6J("ngIf",n.showPaginationIndex),e.xp6(1),e.AsE(" ",n.totalRecordCount," ",e.lcZ(47,41,"AUDIT_LOG.ITEMS")," "))},dependencies:[c.C9t,c.m4W,c.Z4N,c.fv_,c.dRQ,c.Ltv,c.YYR,c.PDs,c.KHL,c.Gcc,c.jND,c.Nh1,c.dml,c.K8c,c.qvL,c.nqY,c.f_W,c.zwp,c.ZUS,c.lU3,_.sg,_.O5,u.z,P,g.X$,Z.Z],styles:[".option-right[_ngcontent-%COMP%]{padding-right:16px}.refresh-btn[_ngcontent-%COMP%]{cursor:pointer}.refresh-btn[_ngcontent-%COMP%]:hover{color:#007cbb}.row-right[_ngcontent-%COMP%]{padding-right:60px}.log-top[_ngcontent-%COMP%]{top:12px}.check-span[_ngcontent-%COMP%]{display:inline-block;width:16px}.display-f[_ngcontent-%COMP%]{display:flex}.reverse-row[_ngcontent-%COMP%]{display:flex;flex-direction:row-reverse;align-items:baseline}.flex-items-xs-right[_ngcontent-%COMP%]{display:flex;align-items:baseline}.flex-items-xs-right[_ngcontent-%COMP%]     clr-date-container{margin-top:0}"]}),i})()}];let N=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[o.Bz.forChild(F),A.m]}),i})()},8348:(y,O,s)=>{s.d(O,{z:()=>_});var o=s(4650),A=s(7579),v=s(8372),m=s(4006),e=s(6895),C=s(9375);const D=["inputElement"];function c(u,h){1&u&&o._UZ(0,"span",4)}let _=(()=>{class u{constructor(d){this.cd=d,this.placeHolder="",this.filterTerms=new A.x,this.isExpanded=!1,this.filterEvt=new o.vpe,this.openFlag=new o.vpe,this.readonly=null,this.expandMode=!1,this.withDivider=!1}set filterPlaceholder(d){this.placeHolder=d}ngOnInit(){this.filterTerms.pipe((0,v.b)(500)).subscribe(d=>{this.filterEvt.emit(d)})}valueChange(){this.filterTerms.next(this.currentValue&&this.currentValue.trim())}inputFocus(){this.openFlag.emit(this.isExpanded)}onClick(){this.expandMode||(this.isExpanded=!this.isExpanded,this.isExpanded&&(this.cd.detectChanges(),this.inputElement.nativeElement.focus()),this.openFlag.emit(this.isExpanded))}get isShowSearchBox(){return this.expandMode||!this.expandMode&&this.isExpanded}}return u.\u0275fac=function(d){return new(d||u)(o.Y36(o.sBO))},u.\u0275cmp=o.Xpm({type:u,selectors:[["hbr-filter"]],viewQuery:function(d,p){if(1&d&&o.Gf(D,5),2&d){let g;o.iGM(g=o.CRH())&&(p.inputElement=g.first)}},inputs:{readonly:"readonly",currentValue:"currentValue",filterPlaceholder:"filterPlaceholder",expandMode:"expandMode",withDivider:"withDivider",width:"width"},outputs:{filterEvt:"filterEvt",openFlag:"openFlag"},decls:5,vars:9,consts:[["shape","search","size","20",1,"search-btn",3,"click"],["type","text","autofocus","",1,"filter-input","clr-input",3,"hidden","placeholder","ngModel","keyup","focus","ngModelChange"],["inputElement",""],["class","filter-divider",4,"ngIf"],[1,"filter-divider"]],template:function(d,p){1&d&&(o.TgZ(0,"span")(1,"clr-icon",0),o.NdJ("click",function(){return p.onClick()}),o.qZA(),o.TgZ(2,"input",1,2),o.NdJ("keyup",function(){return p.valueChange()})("focus",function(){return p.inputFocus()})("ngModelChange",function(L){return p.currentValue=L}),o.qZA(),o.YNc(4,c,1,0,"span",3),o.qZA()),2&d&&(o.xp6(1),o.ekj("filter-icon",p.isShowSearchBox),o.xp6(1),o.Udp("width",p.width,"px"),o.s9C("placeholder",p.placeHolder),o.Q6J("hidden",!p.isShowSearchBox)("ngModel",p.currentValue),o.uIk("readOnly",p.readonly),o.xp6(2),o.Q6J("ngIf",p.withDivider))},dependencies:[m.Fj,m.JJ,m.On,e.O5,C.qvL],styles:[".filter-icon[_ngcontent-%COMP%]{position:relative;right:-20px}.filter-divider[_ngcontent-%COMP%]{display:inline-block;height:16px;width:1px;padding-top:12px;padding-bottom:12px;position:relative;top:9px;margin-right:6px;margin-left:6px}.search-btn[_ngcontent-%COMP%]{cursor:pointer}.search-btn[_ngcontent-%COMP%]:hover{color:#007cbb}.filter-input[_ngcontent-%COMP%]{padding-left:24px}"]}),u})()}}]);