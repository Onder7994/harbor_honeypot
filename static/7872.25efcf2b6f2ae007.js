"use strict";(self.webpackChunkharbor_portal=self.webpackChunkharbor_portal||[]).push([[7872],{7872:(Se,Z,c)=>{c.r(Z),c.d(Z,{JobServiceDashboardModule:()=>pe});var E=c(858),x=c(6296),e=c(4650),n=c(9375),d=c(8746),g=c(6344),l=c(3819),S=c(5832),b=c(5681),C=c(8540),A=c(9151),D=c(312),T=c(4004),u=c(3526),v=c(7677);let O=(()=>{class i{constructor(t,r){this.jobServiceService=t,this.scheduleService=r,this._jobQueues=[],this._allWorkers=[],this._scheduleListParam={page:1,pageSize:1}}getJobQueues(){return this._jobQueues}getAllWorkers(){return this._allWorkers}getScheduleListResponse(){return this._scheduleListResponse}retrieveJobQueues(t){return this.jobServiceService.listJobQueues().pipe((0,T.U)(r=>(t&&this._jobQueues?.length&&r?.length?this._jobQueues.forEach(o=>{r.forEach(a=>{a.job_type===o.job_type&&(o.count=a.count,o.latency=a.latency,o.paused=a.paused)})}):this._jobQueues=r,this._jobQueues.forEach(o=>{o.count||(o.count=0),o.latency||(o.latency=0)}),this._jobQueues)))}retrieveScheduleListResponse(t,r){return t&&(this._scheduleListParam=t),r&&(this._state=r),this.scheduleService.listSchedulesResponse(this._scheduleListParam).pipe((0,T.U)(o=>{const a={pageSize:1|this._scheduleListParam?.pageSize,currentPage:1|this._scheduleListParam?.page,scheduleList:o.body,total:Number.parseInt(o.headers.get("x-total-count"),10)};return this._scheduleListResponse=a,this._state&&this._scheduleListResponse?.scheduleList?.length&&(this._scheduleListResponse.scheduleList=(0,u.Pq)(this._scheduleListResponse?.scheduleList,this._state)),this._scheduleListResponse}))}retrieveAllWorkers(t){return this.jobServiceService.getWorkers({poolId:g.oT.ALL_WORKERS.toString()}).pipe((0,T.U)(r=>(t&&this._allWorkers?.length&&r?.length?this._allWorkers.forEach(o=>{r.forEach(a=>{a.id===o.id&&(o.job_id=a.job_id,o.job_name=a.job_name,o.check_in=a.check_in,o.checkin_at=a.checkin_at,o.start_at=a.start_at)})}):this._allWorkers=r,this._allWorkers)))}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(C.a),e.LFG(v.u))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),i})();var f=c(6895),m=c(2466);function J(i,s){if(1&i&&(e.TgZ(0,"div",9)(1,"div",10)(2,"label",11),e._uU(3),e.qZA()(),e.TgZ(4,"div",12),e._uU(5),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(3),e.hij(" ",null==t.jobQueue[0]?null:t.jobQueue[0].job_type," "),e.xp6(2),e.Oqu((null==t.jobQueue[0]?null:t.jobQueue[0].count)||0)}}function U(i,s){if(1&i&&(e.TgZ(0,"div",9)(1,"div",10)(2,"label",11),e._uU(3),e.qZA()(),e.TgZ(4,"div",12),e._uU(5),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(3),e.hij(" ",null==t.jobQueue[1]?null:t.jobQueue[1].job_type," "),e.xp6(2),e.Oqu((null==t.jobQueue[1]?null:t.jobQueue[1].count)||0)}}function N(i,s){if(1&i&&(e.TgZ(0,"div",9)(1,"div",10)(2,"label",11),e._uU(3),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"div",12),e._uU(6),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(3),e.Oqu(e.lcZ(4,2,"JOB_SERVICE_DASHBOARD.OTHERS")),e.xp6(3),e.Oqu(t.otherCount())}}function j(i,s){if(1&i&&(e.ynx(0),e.YNc(1,J,6,2,"div",8),e.YNc(2,U,6,2,"div",8),e.YNc(3,N,7,4,"div",8),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",null==t.jobQueue?null:t.jobQueue.length),e.xp6(1),e.Q6J("ngIf",(null==t.jobQueue?null:t.jobQueue.length)>1),e.xp6(1),e.Q6J("ngIf",(null==t.jobQueue?null:t.jobQueue.length)>2)}}function q(i,s){1&i&&(e.TgZ(0,"div",13),e._UZ(1,"span",14),e.qZA())}let k=(()=>{class i{constructor(t,r,o,a,p){this.operateDialogService=t,this.jobServiceService=r,this.messageHandlerService=o,this.operationService=a,this.jobServiceDashboardSharedDataService=p,this.loading=!1,this.loadingStopAll=!1}ngOnInit(){this.loopGetPendingJobs(!0),this.initSub()}ngOnDestroy(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.confirmSub&&(this.confirmSub.unsubscribe(),this.confirmSub=null)}get jobQueue(){return this.jobServiceDashboardSharedDataService.getJobQueues().sort((t,r)=>(0|r?.count)-(0|t?.count))}initSub(){this.confirmSub||(this.confirmSub=this.operateDialogService.confirmationConfirm$.subscribe(t=>{t&&1===t.state&&34===t.source&&this.executeStopAll()}))}loopGetPendingJobs(t){t&&(this.loading=!0),this.jobServiceDashboardSharedDataService.retrieveJobQueues(!0).pipe((0,d.x)(()=>this.loading=!1)).subscribe(r=>{this.timeout=setTimeout(()=>{this.loopGetPendingJobs()},g.zk)})}total(){if(this.jobQueue?.length){let t=0;return this.jobQueue.forEach((r,o)=>{t+=0|r?.count}),t}return 0}otherCount(){if(this.jobQueue?.length){let t=0;return this.jobQueue.forEach((r,o)=>{o>1&&(t+=0|r?.count)}),t}return 0}stopAll(){this.operateDialogService.openComfirmDialog({data:void 0,param:null,title:"JOB_SERVICE_DASHBOARD.CONFIRM_STOP_ALL",message:"JOB_SERVICE_DASHBOARD.CONFIRM_STOP_ALL_CONTENT",targetId:34,buttons:0})}executeStopAll(){this.loadingStopAll=!0;const t=new l.gB;t.name="JOB_SERVICE_DASHBOARD.OPERATION_STOP_ALL_QUEUES",t.state=l.yb.progressing,this.operationService.publishInfo(t),this.jobServiceService.actionPendingJobs({jobType:g.O4.ALL,actionRequest:{action:g.$D.STOP}}).pipe((0,d.x)(()=>this.loadingStopAll=!1)).subscribe({next:r=>{this.messageHandlerService.info("JOB_SERVICE_DASHBOARD.STOP_ALL_SUCCESS"),this.refreshNow(),(0,l.hm)(t,l.yb.success)},error:r=>{this.messageHandlerService.error(r),(0,l.hm)(t,l.yb.failure,(0,S.Po)(r))}})}refreshNow(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.loopGetPendingJobs(!0)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(b.O),e.Y36(C.a),e.Y36(A.d),e.Y36(D.f9),e.Y36(O))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-pending-job-card"]],decls:14,vars:14,consts:[[1,"card"],[1,"card-header","text-truncate"],[1,"card-block"],[1,"duration","text-truncate"],[4,"ngIf"],["class","loading",4,"ngIf"],[1,"card-footer"],["type","button",1,"btn","btn-link",3,"disabled","clrLoading","click"],["class","clr-row",4,"ngIf"],[1,"clr-row"],[1,"clr-col","center"],[1,"clr-control-label","text-truncate"],[1,"clr-col"],[1,"loading"],[1,"spinner","spinner-inline"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",2)(5,"div",3),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.YNc(8,j,4,3,"ng-container",4),e.YNc(9,q,2,0,"div",5),e.qZA(),e.TgZ(10,"div",6)(11,"button",7),e.NdJ("click",function(){return r.stopAll()}),e._uU(12),e.ALo(13,"translate"),e.qZA()()()),2&t&&(e.xp6(2),e.hij(" ",e.lcZ(3,8,"JOB_SERVICE_DASHBOARD.PENDING_JOBS")," "),e.xp6(4),e.AsE(" ",e.lcZ(7,10,"REPLICATION.TOTAL"),": ",r.total()," "),e.xp6(2),e.Q6J("ngIf",!r.loading),e.xp6(1),e.Q6J("ngIf",r.loading),e.xp6(2),e.Q6J("disabled",r.loadingStopAll||r.total()<=0)("clrLoading",r.loadingStopAll),e.xp6(1),e.hij(" ",e.lcZ(13,12,"JOB_SERVICE_DASHBOARD.STOP_ALL")," "))},dependencies:[n.cCV,n.MPb,n.MgK,f.O5,m.X$],styles:[".duration[_ngcontent-%COMP%]{width:100%;text-align:center;font-size:50px;margin:1rem 0;line-height:50px;height:50px}.card-block[_ngcontent-%COMP%]{height:9rem}.center[_ngcontent-%COMP%]{display:flex;align-items:center}.loading[_ngcontent-%COMP%]{display:flex;height:4rem;align-items:center;justify-content:center}"]}),i})();var y=c(38);function H(i,s){if(1&i&&(e.TgZ(0,"span",14),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,1,t.statusStr()))}}function M(i,s){1&i&&e._UZ(0,"span",15)}function Q(i,s){1&i&&(e.TgZ(0,"clr-tooltip-content",16)(1,"div"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div"),e._uU(5),e.ALo(6,"translate"),e.qZA()()),2&i&&(e.xp6(2),e.hij(" ",e.lcZ(3,2,"JOB_SERVICE_DASHBOARD.SCHEDULE_PAUSE_BTN_INFO")," "),e.xp6(3),e.hij(" ",e.lcZ(6,4,"JOB_SERVICE_DASHBOARD.SCHEDULE_RESUME_BTN_INFO")," "))}let w=(()=>{class i{constructor(t,r,o,a,p,_e,he){this.operateDialogService=t,this.jobServiceService=r,this.messageHandlerService=o,this.eventService=a,this.operationService=p,this.scheduleService=_e,this.jobServiceDashboardSharedDataService=he,this.isPaused=!1,this.loadingStatus=!1,this.clickOnGoing=!1}ngOnInit(){this.initSub(),this.loopGetStatus(!0),this.getScheduleCount()}ngOnDestroy(){this.statusTimeout&&(clearTimeout(this.statusTimeout),this.statusTimeout=null),this.confirmSub&&(this.confirmSub.unsubscribe(),this.confirmSub=null)}get scheduleCount(){return 0|this.jobServiceDashboardSharedDataService.getScheduleListResponse()?.total}initSub(){this.confirmSub||(this.confirmSub=this.operateDialogService.confirmationConfirm$.subscribe(t=>{t&&1===t.state&&(32===t.source&&this.execute(g.$D.RESUME),33===t.source&&this.execute(g.$D.PAUSE))}))}loopGetStatus(t){t&&(this.loadingStatus=!0),this.scheduleService.getSchedulePaused({jobType:g.O4.ALL}).pipe((0,d.x)(()=>this.loadingStatus=!1)).subscribe(r=>{this.isPaused=r?.paused,this.statusTimeout=setTimeout(()=>{this.loopGetStatus(),this.getScheduleCount()},g.zk)})}getScheduleCount(){this.jobServiceDashboardSharedDataService.retrieveScheduleListResponse().subscribe({next:t=>{},error:t=>{this.messageHandlerService.error(t)}})}btnText(){return this.isPaused?g.eA.RESUME_ALL:g.eA.PAUSE_ALL}statusStr(){return this.isPaused?g.Cw.PAUSED:g.Cw.RUNNING}pauseOrResume(){this.operateDialogService.openComfirmDialog(this.isPaused?{data:void 0,param:null,title:"JOB_SERVICE_DASHBOARD.CONFIRM_RESUMING_ALL",message:"JOB_SERVICE_DASHBOARD.CONFIRM_RESUMING_ALL_CONTENT",targetId:32,buttons:0}:{data:void 0,param:null,title:"JOB_SERVICE_DASHBOARD.CONFIRM_PAUSING_ALL",message:"JOB_SERVICE_DASHBOARD.CONFIRM_PAUSING_ALL_CONTENT",targetId:33,buttons:0})}execute(t){this.clickOnGoing=!0;const r=new l.gB;r.name=this.isPaused?"JOB_SERVICE_DASHBOARD.OPERATION_RESUME_SCHEDULE":"JOB_SERVICE_DASHBOARD.OPERATION_PAUSE_SCHEDULE",r.state=l.yb.progressing,this.operationService.publishInfo(r),this.jobServiceService.actionPendingJobs({jobType:g.O4.SCHEDULER,actionRequest:{action:t}}).pipe((0,d.x)(()=>this.clickOnGoing=!1)).subscribe({next:o=>{this.messageHandlerService.info(this.isPaused?"JOB_SERVICE_DASHBOARD.RESUME_ALL_SUCCESS":"JOB_SERVICE_DASHBOARD.PAUSE_ALL_SUCCESS"),this.refreshNow(),this.jobServiceDashboardSharedDataService.retrieveJobQueues().subscribe(),(0,l.hm)(r,l.yb.success)},error:o=>{this.messageHandlerService.error(o),(0,l.hm)(r,l.yb.failure,(0,S.Po)(o))}})}refreshNow(){this.statusTimeout&&(clearTimeout(this.statusTimeout),this.statusTimeout=null),this.loopGetStatus(!0)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(b.O),e.Y36(C.a),e.Y36(A.d),e.Y36(y.P),e.Y36(D.f9),e.Y36(v.u),e.Y36(O))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-schedule-card"]],decls:23,vars:17,consts:[[1,"card"],[1,"card-header","text-truncate"],[1,"card-block"],[1,"duration","text-truncate"],[1,"clr-row"],[1,"clr-col-5","center"],[1,"clr-control-label","text-truncate"],[1,"clr-col-7"],["class","status",4,"ngIf"],["class","spinner spinner-inline",4,"ngIf"],[1,"card-footer"],["type","button",1,"btn","btn-link",3,"disabled","clrLoading","click"],["clrTooltipTrigger","","shape","info-circle","size","24"],["clrPosition","top-right","clrSize","lg",4,"clrIfOpen"],[1,"status"],[1,"spinner","spinner-inline"],["clrPosition","top-right","clrSize","lg"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",2)(5,"div",3),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"div",4)(9,"div",5)(10,"label",6),e._uU(11),e.ALo(12,"translate"),e.qZA()(),e.TgZ(13,"div",7),e.YNc(14,H,3,3,"span",8),e.YNc(15,M,1,0,"span",9),e.qZA()()(),e.TgZ(16,"div",10)(17,"button",11),e.NdJ("click",function(){return r.pauseOrResume()}),e._uU(18),e.ALo(19,"translate"),e.qZA(),e.TgZ(20,"clr-tooltip"),e._UZ(21,"clr-icon",12),e.YNc(22,Q,7,6,"clr-tooltip-content",13),e.qZA()()()),2&t&&(e.xp6(2),e.hij(" ",e.lcZ(3,9,"JOB_SERVICE_DASHBOARD.SCHEDULES")," "),e.xp6(4),e.AsE(" ",e.lcZ(7,11,"REPLICATION.TOTAL"),": ",r.scheduleCount," "),e.xp6(5),e.Oqu(e.lcZ(12,13,"WEBHOOK.STATUS")),e.xp6(3),e.Q6J("ngIf",!r.loadingStatus),e.xp6(1),e.Q6J("ngIf",r.loadingStatus),e.xp6(2),e.Q6J("disabled",r.loadingStatus||r.clickOnGoing)("clrLoading",r.clickOnGoing),e.xp6(1),e.hij(" ",e.lcZ(19,15,r.btnText())," "))},dependencies:[n.qvL,n.cCV,n.nqY,n.MPb,n.MgK,n.Jmj,n.bMv,n.zDF,f.O5,m.X$],styles:[".duration[_ngcontent-%COMP%]{width:100%;text-align:center;font-size:50px;margin:1rem 0;line-height:50px;height:50px}.card-block[_ngcontent-%COMP%]{height:9rem}.center[_ngcontent-%COMP%]{display:flex;align-items:center}"]}),i})();var L=c(9590),I=c(9739),_=(()=>{return(i=_||(_={})).CENTER_BG_COLOR="#21333b",i.DEN_COLOR="#405C6B",i.NUM_COLOR="#49aeda",_;var i})(),h=(()=>{return(i=h||(h={})).CENTER_BG_COLOR="#fff",i.DEN_COLOR="#ccc",i.NUM_COLOR="#0072a3",h;var i})();let F=(()=>{class i{isDarkTheme(){return localStorage?.getItem(I.BJ)===I.XO.DARK}getSmallBGColor(){return this.isDarkTheme()?_.CENTER_BG_COLOR:h.CENTER_BG_COLOR}getBigBGColor(){return this.isDarkTheme()?_.NUM_COLOR:h.NUM_COLOR}getLeftBGColor(){return this.isDarkTheme()?_.DEN_COLOR:h.DEN_COLOR}getRightBGColor(){return this.getDegree()>180?this.isDarkTheme()?_.NUM_COLOR:h.NUM_COLOR:this.isDarkTheme()?_.DEN_COLOR:h.DEN_COLOR}getDegree(){return this.numerator&&this.denominator?this.numerator/this.denominator*360:0}getRightRotate(){return this.getDegree()>0&&this.getDegree()<=180?`rotate(${this.getDegree()}deg)`:"rotate(0)"}getLeftRotate(){return this.getDegree()>180?`rotate(${this.getDegree()-180}deg)`:"rotate(0)"}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-donut-chart"]],inputs:{denominator:"denominator",numerator:"numerator"},decls:5,vars:16,consts:[[1,"loading"],[1,"left"],[1,"right"],[1,"center"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"div",1)(2,"div",2),e.TgZ(3,"div",3),e._uU(4),e.qZA()()),2&t&&(e.Udp("background-color",r.getBigBGColor()),e.xp6(1),e.Udp("background-color",r.getLeftBGColor())("transform",r.getLeftRotate()),e.xp6(1),e.Udp("background-color",r.getRightBGColor())("transform",r.getRightRotate()),e.xp6(1),e.Udp("color",r.getBigBGColor())("background-color",r.getSmallBGColor()),e.xp6(1),e.AsE(" ",r.numerator,"/",r.denominator," "))},styles:[".loading[_ngcontent-%COMP%]{display:flex;width:150px;height:150px;position:relative;border-radius:50%}.center[_ngcontent-%COMP%]{top:0;left:0;right:0;bottom:0;margin:auto;width:100px;height:100px;position:absolute;border-radius:50%;line-height:100px;text-align:center;font-size:30px}.left[_ngcontent-%COMP%], .right[_ngcontent-%COMP%]{flex:1}.left[_ngcontent-%COMP%]{border-radius:150px 0 0 150px;transform-origin:right center}.right[_ngcontent-%COMP%]{border-radius:0 150px 150px 0;transform-origin:left center}"]}),i})(),V=(()=>{class i{constructor(t,r,o,a,p){this.operateDialogService=t,this.jobServiceService=r,this.messageHandlerService=o,this.operationService=a,this.jobServiceDashboardSharedDataService=p,this.denominator=0,this.loadingFreeAll=!1,this.busyWorkers=[]}ngOnInit(){this.loopWorkerStatus(),this.initSub()}ngOnDestroy(){this.statusTimeout&&(clearTimeout(this.statusTimeout),this.statusTimeout=null),this.confirmSub&&(this.confirmSub.unsubscribe(),this.confirmSub=null)}initSub(){this.confirmSub||(this.confirmSub=this.operateDialogService.confirmationConfirm$.subscribe(t=>{t&&1===t.state&&31===t.source&&this.executeFreeAll()}))}loopWorkerStatus(t){this.jobServiceDashboardSharedDataService.retrieveAllWorkers(t).subscribe(r=>{r&&(this.denominator=r.length,this.busyWorkers=[],r.forEach(o=>{o.job_id&&this.busyWorkers.push(o)}),this.statusTimeout=setTimeout(()=>{this.loopWorkerStatus(!0)},g.zk))})}freeAll(){this.operateDialogService.openComfirmDialog({data:void 0,param:null,title:"JOB_SERVICE_DASHBOARD.CONFIRM_FREE_ALL",message:"JOB_SERVICE_DASHBOARD.CONFIRM_FREE_ALL_CONTENT",targetId:31,buttons:0})}executeFreeAll(){this.loadingFreeAll=!0;const t=new l.gB;t.name="JOB_SERVICE_DASHBOARD.OPERATION_FREE_ALL",t.state=l.yb.progressing,this.operationService.publishInfo(t),this.jobServiceService.stopRunningJob({jobId:g.oT.ALL_WORKERS}).pipe((0,d.x)(()=>this.loadingFreeAll=!1)).subscribe({next:r=>{this.messageHandlerService.info("JOB_SERVICE_DASHBOARD.FREE_ALL_SUCCESS"),this.refreshNow(),(0,l.hm)(t,l.yb.success)},error:r=>{this.messageHandlerService.error(r),(0,l.hm)(t,l.yb.failure,(0,S.Po)(r))}})}refreshNow(){this.statusTimeout&&(clearTimeout(this.statusTimeout),this.statusTimeout=null),this.loopWorkerStatus()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(b.O),e.Y36(L.af),e.Y36(A.d),e.Y36(D.f9),e.Y36(O))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-worker-card"]],decls:10,vars:10,consts:[[1,"card"],[1,"card-header","text-truncate"],[1,"card-block","donut-chart"],[3,"denominator","numerator"],[1,"card-footer"],["type","button",1,"btn","btn-link",3,"disabled","clrLoading","click"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",2),e._UZ(5,"app-donut-chart",3),e.qZA(),e.TgZ(6,"div",4)(7,"button",5),e.NdJ("click",function(){return r.freeAll()}),e._uU(8),e.ALo(9,"translate"),e.qZA()()()),2&t&&(e.xp6(2),e.hij(" ",e.lcZ(3,6,"JOB_SERVICE_DASHBOARD.WORKERS")," "),e.xp6(3),e.Q6J("denominator",r.denominator)("numerator",null==r.busyWorkers?null:r.busyWorkers.length),e.xp6(2),e.Q6J("disabled",r.loadingFreeAll||0===(null==r.busyWorkers?null:r.busyWorkers.length))("clrLoading",r.loadingFreeAll),e.xp6(1),e.hij(" ",e.lcZ(9,8,"JOB_SERVICE_DASHBOARD.FREE_ALL")," "))},dependencies:[n.cCV,n.MPb,F,m.X$],styles:[".donut-chart[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.card-block[_ngcontent-%COMP%]{height:9rem}"]}),i})(),W=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["job-service-dashboard"]],decls:26,vars:12,consts:[[1,"title"],["size","24","shape","dashboard",1,"dashboard"],[1,"clr-row","pr-10","mb-2"],[1,"clr-col"],["role","tablist",1,"nav"],["role","presentation",1,"nav-item"],["id","pending-jobs","type","button","routerLink","pending-jobs","routerLinkActive","active",1,"btn","btn-link","nav-link"],["id","schedules","type","button","routerLink","schedules","routerLinkActive","active",1,"btn","btn-link","nav-link"],["id","workers","type","button","routerLink","workers","routerLinkActive","active",1,"btn","btn-link","nav-link"]],template:function(t,r){1&t&&(e.TgZ(0,"h2",0),e._UZ(1,"clr-icon",1),e.TgZ(2,"span"),e._uU(3),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"div",2)(6,"div",3),e._UZ(7,"app-pending-job-card"),e.qZA(),e.TgZ(8,"div",3),e._UZ(9,"app-schedule-card"),e.qZA(),e.TgZ(10,"div",3),e._UZ(11,"app-worker-card"),e.qZA()(),e.TgZ(12,"ul",4)(13,"li",5)(14,"button",6),e._uU(15),e.ALo(16,"translate"),e.qZA()(),e.TgZ(17,"li",5)(18,"button",7),e._uU(19),e.ALo(20,"translate"),e.qZA()(),e.TgZ(21,"li",5)(22,"button",8),e._uU(23),e.ALo(24,"translate"),e.qZA()()(),e._UZ(25,"router-outlet")),2&t&&(e.xp6(3),e.Oqu(e.lcZ(4,4,"JOB_SERVICE_DASHBOARD.JOB_SERVICE_DASHBOARD")),e.xp6(12),e.hij(" ",e.lcZ(16,6,"JOB_SERVICE_DASHBOARD.JOB_QUEUE")," "),e.xp6(4),e.hij(" ",e.lcZ(20,8,"JOB_SERVICE_DASHBOARD.SCHEDULES")," "),e.xp6(4),e.hij(" ",e.lcZ(24,10,"JOB_SERVICE_DASHBOARD.WORKERS")," "))},dependencies:[n.qvL,E.lC,E.rH,E.Od,k,w,V,m.X$],styles:[".title[_ngcontent-%COMP%]{display:flex;align-items:center;margin-top:0}.dashboard[_ngcontent-%COMP%]{margin-right:.5rem}.pr-10[_ngcontent-%COMP%]{padding-right:2rem}.card-block[_ngcontent-%COMP%]{height:9rem}"]}),i})();var P=c(2614),R=c(4128);function G(i,s){1&i&&(e.TgZ(0,"clr-tooltip-content",15)(1,"div"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"div"),e._uU(8),e.ALo(9,"translate"),e.qZA()()),2&i&&(e.xp6(2),e.hij(" ",e.lcZ(3,3,"JOB_SERVICE_DASHBOARD.QUEUE_STOP_BTN_INFO")," "),e.xp6(3),e.hij(" ",e.lcZ(6,5,"JOB_SERVICE_DASHBOARD.QUEUE_PAUSE_BTN_INFO")," "),e.xp6(3),e.hij(" ",e.lcZ(9,7,"JOB_SERVICE_DASHBOARD.QUEUE_RESUME_BTN_INFO")," "))}function z(i,s){if(1&i&&(e.TgZ(0,"clr-dg-row",16)(1,"clr-dg-cell"),e._uU(2),e.qZA(),e.TgZ(3,"clr-dg-cell"),e._uU(4),e.qZA(),e.TgZ(5,"clr-dg-cell"),e._uU(6),e.qZA(),e.TgZ(7,"clr-dg-cell"),e._uU(8),e.ALo(9,"translate"),e.qZA()()),2&i){const t=s.$implicit,r=e.oxw();e.Q6J("clrDgItem",t),e.xp6(2),e.Oqu(t.job_type),e.xp6(2),e.Oqu(t.count||0),e.xp6(2),e.Oqu(r.getDuration(null==t?null:t.latency)||0),e.xp6(2),e.Oqu(e.lcZ(9,5,r.isPaused(null==t?null:t.paused)))}}function Y(i,s){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){e.oxw();const t=e.MAs(36);e.xp6(1),e.lnq(" ",t.firstItem+1," - ",t.lastItem+1," ",e.lcZ(2,3,"GROUP.OF")," ")}}const K=function(){return[15,25,50]};let $=(()=>{class i{constructor(t,r,o,a,p){this.jobServiceService=t,this.messageHandlerService=r,this.operateDialogService=o,this.operationService=a,this.jobServiceDashboardSharedDataService=p,this.loading=!1,this.selectedRows=[],this.pageSize=(0,u.tb)(u.V2.PENDING_LIST_COMPONENT),this.loadingStop=!1,this.loadingPause=!1,this.loadingResume=!1}ngOnInit(){this.getJobs(),this.initSub()}ngOnDestroy(){this.confirmSub&&(this.confirmSub.unsubscribe(),this.confirmSub=null)}get jobQueue(){return this.jobServiceDashboardSharedDataService.getJobQueues()}initSub(){this.confirmSub||(this.confirmSub=this.operateDialogService.confirmationConfirm$.subscribe(t=>{t&&1===t.state&&(36===t.source&&this.executeStop(),37===t.source&&this.executePause(),38===t.source&&this.executeResume())}))}getJobs(){this.selectedRows=[],this.loading=!0,this.jobServiceDashboardSharedDataService.retrieveJobQueues().pipe((0,d.x)(()=>this.loading=!1)).subscribe({next:t=>{},error:t=>{this.messageHandlerService.error(t)}})}clrLoad(t){t?.page?.size&&(this.pageSize=t.page.size,(0,u.Pe)(u.V2.PENDING_LIST_COMPONENT,this.pageSize))}isPaused(t){return t?P.gT:P.NO}getDuration(t){return t?(0,u.wi)(1e3*t):null}canPause(){return!!this.selectedRows?.length&&!this.selectedRows.some(t=>t.paused)}canResume(){return!!this.selectedRows?.length&&!this.selectedRows.some(t=>!t.paused)}stop(){const t=this.selectedRows.map(r=>r.job_type).join(",");this.operateDialogService.openComfirmDialog({data:void 0,param:t,title:"JOB_SERVICE_DASHBOARD.CONFIRM_STOPPING_JOBS",message:"JOB_SERVICE_DASHBOARD.CONFIRM_STOPPING_JOBS_CONTENT",targetId:36,buttons:0})}pause(){const t=this.selectedRows.map(r=>r.job_type).join(",");this.operateDialogService.openComfirmDialog({data:void 0,param:t,title:"JOB_SERVICE_DASHBOARD.CONFIRM_PAUSING_JOBS",message:"JOB_SERVICE_DASHBOARD.CONFIRM_PAUSING_JOBS_CONTENT",targetId:37,buttons:0})}resume(){const t=this.selectedRows.map(r=>r.job_type).join(",");this.operateDialogService.openComfirmDialog({data:void 0,param:t,title:"JOB_SERVICE_DASHBOARD.CONFIRM_RESUMING_JOBS",message:"JOB_SERVICE_DASHBOARD.CONFIRM_RESUMING_JOBS_CONTENT",targetId:38,buttons:0})}executeStop(){this.loadingStop=!0;const t=new l.gB;t.name="JOB_SERVICE_DASHBOARD.OPERATION_STOP_SPECIFIED_QUEUES",t.state=l.yb.progressing,t.data.name=this.selectedRows.map(r=>r.job_type).join(","),this.operationService.publishInfo(t),(0,R.D)(this.selectedRows.map(r=>this.jobServiceService.actionPendingJobs({jobType:r.job_type,actionRequest:{action:g.$D.STOP}}))).pipe((0,d.x)(()=>this.loadingStop=!1)).subscribe({next:r=>{this.messageHandlerService.info("JOB_SERVICE_DASHBOARD.STOP_SUCCESS"),this.getJobs(),(0,l.hm)(t,l.yb.success)},error:r=>{this.messageHandlerService.error(r),(0,l.hm)(t,l.yb.failure,(0,S.Po)(r))}})}executePause(){this.loadingPause=!0;const t=new l.gB;t.name="JOB_SERVICE_DASHBOARD.OPERATION_PAUSE_SPECIFIED_QUEUES",t.state=l.yb.progressing,t.data.name=this.selectedRows.map(r=>r.job_type).join(","),this.operationService.publishInfo(t),(0,R.D)(this.selectedRows.map(r=>this.jobServiceService.actionPendingJobs({jobType:r.job_type,actionRequest:{action:g.$D.PAUSE}}))).pipe((0,d.x)(()=>this.loadingPause=!1)).subscribe({next:r=>{(0,l.hm)(t,l.yb.success),this.messageHandlerService.info("JOB_SERVICE_DASHBOARD.PAUSE_SUCCESS"),this.getJobs()},error:r=>{this.messageHandlerService.error(r),(0,l.hm)(t,l.yb.failure,(0,S.Po)(r))}})}executeResume(){this.loadingResume=!0;const t=new l.gB;t.name="JOB_SERVICE_DASHBOARD.OPERATION_RESUME_SPECIFIED_QUEUES",t.state=l.yb.progressing,t.data.name=this.selectedRows.map(r=>r.job_type).join(","),this.operationService.publishInfo(t),(0,R.D)(this.selectedRows.map(r=>this.jobServiceService.actionPendingJobs({jobType:r.job_type,actionRequest:{action:g.$D.RESUME}}))).pipe((0,d.x)(()=>this.loadingResume=!1)).subscribe({next:r=>{(0,l.hm)(t,l.yb.success),this.messageHandlerService.info("JOB_SERVICE_DASHBOARD.RESUME_SUCCESS"),this.getJobs()},error:r=>{this.messageHandlerService.error(r),(0,l.hm)(t,l.yb.failure,(0,S.Po)(r))}})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(C.a),e.Y36(A.d),e.Y36(b.O),e.Y36(D.f9),e.Y36(O))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-pending-job-list"]],decls:43,vars:46,consts:[[3,"clrDgSelected","clrDgLoading","clrDgSelectedChange","clrDgRefresh"],[1,"action-bar","mt-0"],["type","button",1,"btn","btn-secondary",3,"clrLoading","disabled","click"],["type","button",1,"btn","btn-secondary",3,"disabled","click"],["clrTooltipTrigger","","shape","info-circle","size","24"],["clrPosition","top-right","clrSize","lg",4,"clrIfOpen"],[1,"refresh-btn"],["shape","refresh",3,"click"],[3,"clrDgField"],[3,"clrDgSortBy"],[3,"clrDgItem",4,"clrDgItems","clrDgItemsOf"],[3,"clrDgPageSize","clrDgTotalItems"],["pagination",""],[3,"clrPageSizeOptions"],[4,"ngIf"],["clrPosition","top-right","clrSize","lg"],[3,"clrDgItem"]],template:function(t,r){1&t&&(e.TgZ(0,"clr-datagrid",0),e.NdJ("clrDgSelectedChange",function(a){return r.selectedRows=a})("clrDgRefresh",function(a){return r.clrLoad(a)}),e.TgZ(1,"clr-dg-action-bar")(2,"clr-dg-action-bar",1)(3,"div")(4,"button",2),e.NdJ("click",function(){return r.stop()}),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"button",3),e.NdJ("click",function(){return r.pause()}),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"button",3),e.NdJ("click",function(){return r.resume()}),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"clr-tooltip"),e._UZ(14,"clr-icon",4),e.YNc(15,G,10,9,"clr-tooltip-content",5),e.qZA()(),e.TgZ(16,"span",6)(17,"clr-icon",7),e.NdJ("click",function(){return r.getJobs()}),e.qZA()()()(),e.TgZ(18,"clr-dg-column",8),e._uU(19),e.ALo(20,"translate"),e.qZA(),e.TgZ(21,"clr-dg-column",9),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.TgZ(24,"clr-dg-column",9),e._uU(25),e.ALo(26,"translate"),e.qZA(),e.TgZ(27,"clr-dg-column"),e._uU(28),e.ALo(29,"translate"),e.qZA(),e.TgZ(30,"clr-dg-placeholder"),e._uU(31),e.ALo(32,"translate"),e.qZA(),e.YNc(33,z,10,7,"clr-dg-row",10),e.TgZ(34,"clr-dg-footer")(35,"clr-dg-pagination",11,12)(37,"clr-dg-page-size",13),e._uU(38),e.ALo(39,"translate"),e.qZA(),e.YNc(40,Y,3,5,"span",14),e._uU(41),e.ALo(42,"translate"),e.qZA()()()),2&t&&(e.Q6J("clrDgSelected",r.selectedRows)("clrDgLoading",r.loading),e.xp6(4),e.Q6J("clrLoading",r.loadingStop)("disabled",r.loadingStop||!(null!=r.selectedRows&&r.selectedRows.length)),e.xp6(1),e.hij(" ",e.lcZ(6,25,"JOB_SERVICE_DASHBOARD.STOP_BTN")," "),e.xp6(2),e.Q6J("disabled",!r.canPause()),e.xp6(1),e.hij(" ",e.lcZ(9,27,"JOB_SERVICE_DASHBOARD.PAUSE_BTN")," "),e.xp6(2),e.Q6J("disabled",!r.canResume()),e.xp6(1),e.hij(" ",e.lcZ(12,29,"JOB_SERVICE_DASHBOARD.RESUME_BTN")," "),e.xp6(7),e.Q6J("clrDgField","job_type"),e.xp6(1),e.Oqu(e.lcZ(20,31,"JOB_SERVICE_DASHBOARD.JOB_TYPE")),e.xp6(2),e.Q6J("clrDgSortBy","count"),e.xp6(1),e.Oqu(e.lcZ(23,33,"JOB_SERVICE_DASHBOARD.PENDING_COUNT")),e.xp6(2),e.Q6J("clrDgSortBy","latency"),e.xp6(1),e.Oqu(e.lcZ(26,35,"JOB_SERVICE_DASHBOARD.LATENCY")),e.xp6(3),e.Oqu(e.lcZ(29,37,"JOB_SERVICE_DASHBOARD.PAUSED")),e.xp6(3),e.Oqu(e.lcZ(32,39,"JOB_SERVICE_DASHBOARD.NO_JOB_QUEUE")),e.xp6(2),e.Q6J("clrDgItemsOf",r.jobQueue),e.xp6(2),e.Q6J("clrDgPageSize",r.pageSize)("clrDgTotalItems",null==r.jobQueue?null:r.jobQueue.length),e.xp6(2),e.Q6J("clrPageSizeOptions",e.DdM(45,K)),e.xp6(1),e.Oqu(e.lcZ(39,41,"PAGINATION.PAGE_SIZE")),e.xp6(2),e.Q6J("ngIf",null==r.jobQueue?null:r.jobQueue.length),e.xp6(1),e.AsE(" ",null==r.jobQueue?null:r.jobQueue.length," ",e.lcZ(42,43,"GROUP.ITEMS")," "))},dependencies:[n.C9t,n.Gwl,n.m4W,n.f6,n.Z4N,n.fv_,n.dRQ,n.Ltv,n.YYR,n.F7K,n.PDs,n.KHL,n.Gcc,n.jND,n.Nh1,n.dml,n.K8c,n.qvL,n.cCV,n.nqY,n.MPb,n.Jmj,n.bMv,n.zDF,f.O5,m.X$],styles:[".action-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.refresh-btn[_ngcontent-%COMP%]{margin-right:1rem}"]}),i})();var B=c(3046);function X(i,s){if(1&i&&(e.TgZ(0,"clr-dg-row",11)(1,"clr-dg-cell"),e._uU(2),e.qZA(),e.TgZ(3,"clr-dg-cell"),e._uU(4),e.qZA(),e.TgZ(5,"clr-dg-cell"),e._uU(6),e.qZA(),e.TgZ(7,"clr-dg-cell"),e._uU(8),e.qZA(),e.TgZ(9,"clr-dg-cell"),e._uU(10),e.ALo(11,"harborDatetime"),e.qZA()()),2&i){const t=s.$implicit;e.Q6J("clrDgItem",t),e.xp6(2),e.Oqu(t.id),e.xp6(2),e.Oqu(t.vendor_type),e.xp6(2),e.Oqu(t.vendor_id),e.xp6(2),e.Oqu(t.cron),e.xp6(2),e.Oqu(e.lcZ(11,6,t.update_time))}}function ee(i,s){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){e.oxw();const t=e.MAs(25);e.xp6(1),e.lnq(" ",t.firstItem+1," - ",t.lastItem+1," ",e.lcZ(2,3,"GROUP.OF")," ")}}const te=function(){return[15,25,50]};let re=(()=>{class i{constructor(t,r){this.messageHandlerService=t,this.jobServiceDashboardSharedDataService=r,this.loadingSchedules=!0,this.total=0,this.page=1,this.pageSize=(0,u.tb)(u.V2.SCHEDULE_LIST_COMPONENT)}get schedules(){return this.jobServiceDashboardSharedDataService.getScheduleListResponse()?.scheduleList||[]}clrLoad(t){t?.page?.size&&(this.pageSize=t.page.size,(0,u.Pe)(u.V2.SCHEDULE_LIST_COMPONENT,this.pageSize)),this.loadingSchedules=!0,this.jobServiceDashboardSharedDataService.retrieveScheduleListResponse({page:this.page,pageSize:this.pageSize},t).pipe((0,d.x)(()=>this.loadingSchedules=!1)).subscribe({next:r=>{this.total=r.total,(0,u.Pq)(r.scheduleList,t)},error:r=>{this.messageHandlerService.error(r)}})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(A.d),e.Y36(O))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-schedule-list"]],decls:34,vars:36,consts:[[3,"clrDgLoading","clrDgRefresh"],[1,"action-bar"],[1,"refresh-btn",3,"click"],["shape","refresh"],[3,"clrDgSortBy"],[3,"clrDgItem",4,"ngFor","ngForOf"],[3,"clrDgPageSize","clrDgPage","clrDgTotalItems","clrDgPageChange"],["pagination",""],[3,"clrPageSizeOptions"],[4,"ngIf"],["id","total"],[3,"clrDgItem"]],template:function(t,r){1&t&&(e.TgZ(0,"clr-datagrid",0),e.NdJ("clrDgRefresh",function(a){return r.clrLoad(a)}),e.TgZ(1,"clr-dg-action-bar",1)(2,"span",2),e.NdJ("click",function(){return r.clrLoad()}),e._UZ(3,"clr-icon",3),e.qZA()(),e.TgZ(4,"clr-dg-column",4),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"clr-dg-column",4),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"clr-dg-column"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"clr-dg-column"),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"clr-dg-column",4),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.TgZ(19,"clr-dg-placeholder"),e._uU(20),e.ALo(21,"translate"),e.qZA(),e.YNc(22,X,12,8,"clr-dg-row",5),e.TgZ(23,"clr-dg-footer")(24,"clr-dg-pagination",6,7),e.NdJ("clrDgPageChange",function(a){return r.page=a}),e.TgZ(26,"clr-dg-page-size",8),e._uU(27),e.ALo(28,"translate"),e.qZA(),e.YNc(29,ee,3,5,"span",9),e.TgZ(30,"span",10),e._uU(31),e.qZA(),e._uU(32),e.ALo(33,"translate"),e.qZA()()()),2&t&&(e.Q6J("clrDgLoading",r.loadingSchedules),e.xp6(4),e.Q6J("clrDgSortBy","id"),e.xp6(1),e.Oqu(e.lcZ(6,19,"TAG_RETENTION.SERIAL")),e.xp6(2),e.Q6J("clrDgSortBy","vendor_type"),e.xp6(1),e.Oqu(e.lcZ(9,21,"JOB_SERVICE_DASHBOARD.VENDOR_TYPE")),e.xp6(3),e.Oqu(e.lcZ(12,23,"JOB_SERVICE_DASHBOARD.VENDOR_ID")),e.xp6(3),e.Oqu(e.lcZ(15,25,"JOB_SERVICE_DASHBOARD.CRON")),e.xp6(2),e.Q6J("clrDgSortBy","update_time"),e.xp6(1),e.Oqu(e.lcZ(18,27,"REPLICATION.UPDATE_TIME")),e.xp6(3),e.Oqu(e.lcZ(21,29,"JOB_SERVICE_DASHBOARD.NO_SCHEDULE")),e.xp6(2),e.Q6J("ngForOf",r.schedules),e.xp6(2),e.Q6J("clrDgPageSize",r.pageSize)("clrDgPage",r.page)("clrDgTotalItems",r.total),e.xp6(2),e.Q6J("clrPageSizeOptions",e.DdM(35,te)),e.xp6(1),e.Oqu(e.lcZ(28,31,"PAGINATION.PAGE_SIZE")),e.xp6(2),e.Q6J("ngIf",r.total),e.xp6(2),e.Oqu(r.total),e.xp6(1),e.hij(" ",e.lcZ(33,33,"GROUP.ITEMS")," "))},dependencies:[n.C9t,n.Gwl,n.m4W,n.Z4N,n.fv_,n.dRQ,n.Ltv,n.YYR,n.F7K,n.PDs,n.KHL,n.Gcc,n.jND,n.Nh1,n.dml,n.K8c,n.qvL,f.sg,f.O5,m.X$,B.Z],styles:[".action-bar[_ngcontent-%COMP%]{display:flex;justify-content:right}.refresh-btn[_ngcontent-%COMP%]{margin-right:1rem}.link-normal[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap;max-width:10rem;text-transform:unset}.flex[_ngcontent-%COMP%]{display:flex}.pre[_ngcontent-%COMP%]{min-width:25rem}"]}),i})();var ie=c(8726);function ne(i,s){if(1&i&&(e.TgZ(0,"clr-dg-row",11)(1,"clr-dg-cell"),e._uU(2),e.qZA(),e.TgZ(3,"clr-dg-cell"),e._uU(4),e.qZA(),e.TgZ(5,"clr-dg-cell"),e._uU(6),e.ALo(7,"harborDatetime"),e.qZA(),e.TgZ(8,"clr-dg-cell"),e._uU(9),e.ALo(10,"harborDatetime"),e.qZA(),e.TgZ(11,"clr-dg-cell"),e._uU(12),e.qZA()()),2&i){const t=s.$implicit;e.Q6J("clrDgItem",t),e.xp6(2),e.Oqu(t.worker_pool_id),e.xp6(2),e.Oqu(t.pid),e.xp6(2),e.Oqu(e.lcZ(7,6,t.start_at)),e.xp6(3),e.Oqu(e.lcZ(10,8,t.heartbeat_at)),e.xp6(3),e.Oqu(t.concurrency)}}function oe(i,s){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){e.oxw();const t=e.MAs(28);e.xp6(1),e.lnq(" ",t.firstItem+1," - ",t.lastItem+1," ",e.lcZ(2,3,"GROUP.OF")," ")}}function se(i,s){1&i&&(e.TgZ(0,"clr-tooltip-content",17)(1,"span"),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&i&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"JOB_SERVICE_DASHBOARD.WORKER_FREE_BTN_INFO")," "))}function le(i,s){if(1&i&&(e.TgZ(0,"clr-dg-row",11)(1,"clr-dg-cell"),e._uU(2),e.qZA(),e.TgZ(3,"clr-dg-cell"),e._uU(4),e.qZA(),e.TgZ(5,"clr-dg-cell"),e._uU(6),e.qZA(),e.TgZ(7,"clr-dg-cell"),e._uU(8),e.ALo(9,"harborDatetime"),e.qZA(),e.TgZ(10,"clr-dg-cell"),e._uU(11),e.ALo(12,"harborDatetime"),e.qZA()()),2&i){const t=s.$implicit;e.Q6J("clrDgItem",t),e.xp6(2),e.Oqu(t.id),e.xp6(2),e.Oqu(t.job_name),e.xp6(2),e.Oqu(t.job_id),e.xp6(2),e.Oqu(e.lcZ(9,6,t.start_at)),e.xp6(3),e.Oqu(e.lcZ(12,8,t.checkin_at))}}function ae(i,s){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){e.oxw();const t=e.MAs(36);e.xp6(1),e.lnq(" ",t.firstItem+1," - ",t.lastItem+1," ",e.lcZ(2,3,"GROUP.OF")," ")}}const ce=function(){return[15,25,50]};function ue(i,s){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"h2"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"clr-datagrid",12),e.NdJ("clrDgRefresh",function(o){e.CHM(t);const a=e.oxw();return e.KtG(a.clrLoadWorker(o))})("clrDgSelectedChange",function(o){e.CHM(t);const a=e.oxw();return e.KtG(a.selected=o)}),e.TgZ(5,"clr-dg-action-bar",13)(6,"div")(7,"button",14),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.freeWorker())}),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"clr-tooltip"),e._UZ(11,"clr-icon",15),e.YNc(12,se,4,3,"clr-tooltip-content",16),e.qZA()(),e.TgZ(13,"span",2),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.refreshWorkers())}),e._UZ(14,"clr-icon",3),e.qZA()(),e.TgZ(15,"clr-dg-column",4),e._uU(16),e.ALo(17,"translate"),e.qZA(),e.TgZ(18,"clr-dg-column",4),e._uU(19),e.ALo(20,"translate"),e.qZA(),e.TgZ(21,"clr-dg-column",4),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.TgZ(24,"clr-dg-column",4),e._uU(25),e.ALo(26,"translate"),e.qZA(),e.TgZ(27,"clr-dg-column",4),e._uU(28),e.ALo(29,"translate"),e.qZA(),e.TgZ(30,"clr-dg-placeholder"),e._uU(31),e.ALo(32,"translate"),e.qZA(),e.YNc(33,le,13,10,"clr-dg-row",6),e.TgZ(34,"clr-dg-footer")(35,"clr-dg-pagination",7,8)(37,"clr-dg-page-size",9),e._uU(38),e.ALo(39,"translate"),e.qZA(),e.YNc(40,ae,3,5,"span",10),e._uU(41),e.ALo(42,"translate"),e.qZA()()(),e.BQk()}if(2&i){const t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,25,"JOB_SERVICE_DASHBOARD.WORKERS")),e.xp6(2),e.Q6J("clrDgLoading",t.loadingWorkers)("clrDgSelected",t.selected),e.xp6(3),e.Q6J("clrLoading",t.loadingFree)("disabled",t.loadingFree||!t.canFree()),e.xp6(1),e.hij(" ",e.lcZ(9,27,"JOB_SERVICE_DASHBOARD.FREE")," "),e.xp6(7),e.Q6J("clrDgField","id"),e.xp6(1),e.Oqu(e.lcZ(17,29,"JOB_SERVICE_DASHBOARD.WORKER_ID")),e.xp6(2),e.Q6J("clrDgField","job_name"),e.xp6(1),e.Oqu(e.lcZ(20,31,"CVE_EXPORT.JOB_NAME")),e.xp6(2),e.Q6J("clrDgField","job_id"),e.xp6(1),e.Oqu(e.lcZ(23,33,"JOB_SERVICE_DASHBOARD.JOB_ID")),e.xp6(2),e.Q6J("clrDgField","start_at"),e.xp6(1),e.Oqu(e.lcZ(26,35,"JOB_SERVICE_DASHBOARD.START_AT")),e.xp6(2),e.Q6J("clrDgField","checkin_at"),e.xp6(1),e.Oqu(e.lcZ(29,37,"JOB_SERVICE_DASHBOARD.CHECK_IN_AT")),e.xp6(3),e.Oqu(e.lcZ(32,39,"JOB_SERVICE_DASHBOARD.NO_WORKER")),e.xp6(2),e.Q6J("clrDgItemsOf",t.workers),e.xp6(2),e.Q6J("clrDgPageSize",t.workerPageSize)("clrDgTotalItems",null==t.workers?null:t.workers.length),e.xp6(2),e.Q6J("clrPageSizeOptions",e.DdM(45,ce)),e.xp6(1),e.Oqu(e.lcZ(39,41,"PAGINATION.PAGE_SIZE")),e.xp6(2),e.Q6J("ngIf",null==t.workers?null:t.workers.length),e.xp6(1),e.AsE(" ",null==t.workers?null:t.workers.length," ",e.lcZ(42,43,"GROUP.ITEMS")," ")}}const ge=function(){return[5,15,30]},de=[{path:"",component:W,children:[{path:"pending-jobs",component:$},{path:"schedules",component:re},{path:"workers",component:(()=>{class i{constructor(t,r,o,a,p){this.jobServiceService=t,this.messageHandlerService=r,this.operateDialogService=o,this.operationService=a,this.jobServiceDashboardSharedDataService=p,this.loadingPools=!1,this.pools=[],this.loadingWorkers=!1,this.selected=[],this.poolPageSize=(0,u.tb)(u.V2.WORKER_LIST_COMPONENT_POOL,5),this.workerPageSize=(0,u.tb)(u.V2.WORKER_LIST_COMPONENT_WORKER),this.loadingFree=!1}ngOnInit(){this.getPools(),this.initSub()}ngOnDestroy(){this.confirmSub&&(this.confirmSub.unsubscribe(),this.confirmSub=null)}get workers(){return this.jobServiceDashboardSharedDataService.getAllWorkers().filter(t=>t.pool_id===this.selectedPool?.worker_pool_id)}initSub(){this.confirmSub||(this.confirmSub=this.operateDialogService.confirmationConfirm$.subscribe(t=>{t&&1===t.state&&35===t.source&&this.executeFreeWorkers()}))}getPools(){this.loadingPools=!0,this.jobServiceService.getWorkerPools().pipe((0,d.x)(()=>this.loadingPools=!1)).subscribe({next:t=>{this.pools=t,t?.length&&(this.selectedPool=t[0])},error:t=>{this.messageHandlerService.error(t)}})}string(t){return t?JSON.stringify(t):null}clrLoadPool(t){t?.page?.size&&(this.poolPageSize=t.page.size,(0,u.Pe)(u.V2.WORKER_LIST_COMPONENT_POOL,this.poolPageSize))}clrLoadWorker(t){t?.page?.size&&(this.workerPageSize=t.page.size,(0,u.Pe)(u.V2.WORKER_LIST_COMPONENT_POOL,this.workerPageSize))}canFree(){if(this.selected?.length){let t=!0;return this.selected.forEach(r=>{r.job_id||(t=!1)}),t}return!1}freeWorker(){const t=this.selected.map(o=>o.id).join(","),r=new ie.c("JOB_SERVICE_DASHBOARD.CONFIRM_FREE_WORKERS","JOB_SERVICE_DASHBOARD.CONFIRM_FREE_WORKERS_CONTENT",t,this.selected,35,0);this.operateDialogService.openComfirmDialog(r)}refreshWorkers(){this.loadingWorkers=!0,this.jobServiceDashboardSharedDataService.retrieveAllWorkers().pipe((0,d.x)(()=>this.loadingWorkers=!1)).subscribe()}executeFreeWorkers(){this.loadingFree=!0;const t=new l.gB;t.name="JOB_SERVICE_DASHBOARD.OPERATION_FREE_SPECIFIED_WORKERS",t.state=l.yb.progressing,t.data.name=this.selected.map(r=>r.id).join(","),this.operationService.publishInfo(t),(0,R.D)(this.selected.map(r=>this.jobServiceService.stopRunningJob({jobId:r.job_id}))).pipe((0,d.x)(()=>this.loadingFree=!1)).subscribe({next:r=>{this.messageHandlerService.info("JOB_SERVICE_DASHBOARD.FREE_WORKER_SUCCESS"),this.refreshWorkers(),(0,l.hm)(t,l.yb.success)},error:r=>{this.messageHandlerService.error(r),(0,l.hm)(t,l.yb.failure,(0,S.Po)(r))}})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(L.af),e.Y36(A.d),e.Y36(b.O),e.Y36(D.f9),e.Y36(O))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-worker-list"]],decls:36,vars:43,consts:[[3,"clrDgLoading","clrDgSingleSelected","clrDgRefresh","clrDgSelectedChange","clrDgSingleSelectedChange"],[1,"action-bar","mt-0"],[1,"refresh-btn",3,"click"],["shape","refresh"],[3,"clrDgField"],[3,"clrDgField","clrDgColType"],[3,"clrDgItem",4,"clrDgItems","clrDgItemsOf"],[3,"clrDgPageSize","clrDgTotalItems"],["pagination",""],[3,"clrPageSizeOptions"],[4,"ngIf"],[3,"clrDgItem"],[3,"clrDgLoading","clrDgSelected","clrDgRefresh","clrDgSelectedChange"],[1,"action-bar-worker"],["type","button",1,"btn","btn-secondary",3,"clrLoading","disabled","click"],["clrTooltipTrigger","","shape","info-circle","size","24"],["clrPosition","top-right","clrSize","lg",4,"clrIfOpen"],["clrPosition","top-right","clrSize","lg"]],template:function(t,r){1&t&&(e.TgZ(0,"h2"),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"clr-datagrid",0),e.NdJ("clrDgRefresh",function(a){return r.clrLoadPool(a)})("clrDgSelectedChange",function(){return r.refreshWorkers()})("clrDgSingleSelectedChange",function(a){return r.selectedPool=a}),e.TgZ(4,"clr-dg-action-bar",1)(5,"span",2),e.NdJ("click",function(){return r.getPools()}),e._UZ(6,"clr-icon",3),e.qZA()(),e.TgZ(7,"clr-dg-column",4),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"clr-dg-column",4),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"clr-dg-column",4),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"clr-dg-column",4),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.TgZ(19,"clr-dg-column",5),e._uU(20),e.ALo(21,"translate"),e.qZA(),e.TgZ(22,"clr-dg-placeholder"),e._uU(23),e.ALo(24,"translate"),e.qZA(),e.YNc(25,ne,13,10,"clr-dg-row",6),e.TgZ(26,"clr-dg-footer")(27,"clr-dg-pagination",7,8)(29,"clr-dg-page-size",9),e._uU(30),e.ALo(31,"translate"),e.qZA(),e.YNc(32,oe,3,5,"span",10),e._uU(33),e.ALo(34,"translate"),e.qZA()()(),e.YNc(35,ue,43,46,"ng-container",10)),2&t&&(e.xp6(1),e.Oqu(e.lcZ(2,24,"JOB_SERVICE_DASHBOARD.WORKER_POOL")),e.xp6(2),e.Q6J("clrDgLoading",r.loadingPools)("clrDgSingleSelected",r.selectedPool),e.xp6(4),e.Q6J("clrDgField","worker_pool_id"),e.xp6(1),e.Oqu(e.lcZ(9,26,"JOB_SERVICE_DASHBOARD.WORKER_POOL_ID")),e.xp6(2),e.Q6J("clrDgField","pid"),e.xp6(1),e.Oqu(e.lcZ(12,28,"JOB_SERVICE_DASHBOARD.PID")),e.xp6(2),e.Q6J("clrDgField","start_at"),e.xp6(1),e.Oqu(e.lcZ(15,30,"JOB_SERVICE_DASHBOARD.START_AT")),e.xp6(2),e.Q6J("clrDgField","heartbeat_at"),e.xp6(1),e.Oqu(e.lcZ(18,32,"JOB_SERVICE_DASHBOARD.HEARTBEAT_AT")),e.xp6(2),e.Q6J("clrDgField","concurrency")("clrDgColType","number"),e.xp6(1),e.Oqu(e.lcZ(21,34,"JOB_SERVICE_DASHBOARD.CONCURRENCY")),e.xp6(3),e.Oqu(e.lcZ(24,36,"JOB_SERVICE_DASHBOARD.NO_WORKER_POOL")),e.xp6(2),e.Q6J("clrDgItemsOf",r.pools),e.xp6(2),e.Q6J("clrDgPageSize",5)("clrDgTotalItems",null==r.pools?null:r.pools.length),e.xp6(2),e.Q6J("clrPageSizeOptions",e.DdM(42,ge)),e.xp6(1),e.Oqu(e.lcZ(31,38,"PAGINATION.PAGE_SIZE")),e.xp6(2),e.Q6J("ngIf",null==r.pools?null:r.pools.length),e.xp6(1),e.AsE(" ",null==r.pools?null:r.pools.length," ",e.lcZ(34,40,"GROUP.ITEMS")," "),e.xp6(2),e.Q6J("ngIf",r.selectedPool))},dependencies:[n.C9t,n.Gwl,n.m4W,n.f6,n.Z4N,n.fv_,n.dRQ,n.Ltv,n.YYR,n.F7K,n.PDs,n.KHL,n.Gcc,n.jND,n.Nh1,n.dml,n.K8c,n.qvL,n.cCV,n.nqY,n.MPb,n.Jmj,n.bMv,n.zDF,f.O5,m.X$,B.Z],styles:[".link-normal[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap;max-width:10rem;text-transform:unset}.action-bar[_ngcontent-%COMP%]{display:flex;justify-content:right}.refresh-btn[_ngcontent-%COMP%]{margin-right:1rem}.action-bar-worker[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.pre[_ngcontent-%COMP%]{min-width:25rem}"]}),i})()},{path:"",redirectTo:"pending-jobs",pathMatch:"full"}]}];let pe=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[O],imports:[x.m,E.Bz.forChild(de)]}),i})()}}]);