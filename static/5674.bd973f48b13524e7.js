"use strict";(self.webpackChunkharbor_portal=self.webpackChunkharbor_portal||[]).push([[5674],{4710:(M,T,l)=>{l.d(T,{U:()=>A});var s=l(529),Q=l(2529),O=l(9300),h=l(4004),t=l(4650),U=l(5060);let A=(()=>{class _ extends Q.b{constructor(n,i){super(n,i)}listQuotasResponse(n){let i=this.newParams(),g=new s.WM;null!=n.sort&&(i=i.set("sort",n.sort.toString())),null!=n.referenceId&&(i=i.set("reference_id",n.referenceId.toString())),null!=n.reference&&(i=i.set("reference",n.reference.toString())),null!=n.pageSize&&(i=i.set("page_size",n.pageSize.toString())),null!=n.page&&(i=i.set("page",n.page.toString())),null!=n.XRequestId&&(g=g.set("X-Request-Id",n.XRequestId.toString()));let f=new s.aW("GET",this.rootUrl+"/quotas",null,{headers:g,params:i,responseType:"json"});return this.http.request(f).pipe((0,O.h)(m=>m instanceof s.Zn),(0,h.U)(m=>m))}listQuotas(n){return this.listQuotasResponse(n).pipe((0,h.U)(i=>i.body))}getQuotaResponse(n){let i=this.newParams(),g=new s.WM;null!=n.XRequestId&&(g=g.set("X-Request-Id",n.XRequestId.toString()));let f=new s.aW("GET",this.rootUrl+`/quotas/${n.id}`,null,{headers:g,params:i,responseType:"json"});return this.http.request(f).pipe((0,O.h)(m=>m instanceof s.Zn),(0,h.U)(m=>m))}getQuota(n){return this.getQuotaResponse(n).pipe((0,h.U)(i=>i.body))}updateQuotaResponse(n){let i=this.newParams(),g=new s.WM,d=null;d=n.hard,null!=n.XRequestId&&(g=g.set("X-Request-Id",n.XRequestId.toString()));let f=new s.aW("PUT",this.rootUrl+`/quotas/${n.id}`,d,{headers:g,params:i,responseType:"json"});return this.http.request(f).pipe((0,O.h)(m=>m instanceof s.Zn),(0,h.U)(m=>m))}updateQuota(n){return this.updateQuotaResponse(n).pipe((0,h.U)(i=>i.body))}}return _.listQuotasPath="/quotas",_.getQuotaPath="/quotas/{id}",_.updateQuotaPath="/quotas/{id}",_.\u0275fac=function(n){return new(n||_)(t.LFG(U.p),t.LFG(s.eN))},_.\u0275prov=t.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()},5674:(M,T,l)=>{l.r(T),l.d(T,{ProjectQuotasModule:()=>B});var s=l(6296),Q=l(858),O=l(8746),h=l(7138),t=l(4650),U=l(1992),A=l(946),_=l(9151),P=l(6895),n=l(3526),i=l(6742),g=l(4128),d=l(9646),f=l(5577),m=l(8348),E=l(4710),q=l(2466),Z=l(2443),b=l(5266),c=l(9375),C=l(4006),L=l(2421),I=l(1884);const D=["quotaForm"];function y(a,p){1&a&&(t.TgZ(0,"clr-tooltip-content",19)(1,"span"),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&a&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"PROJECT.QUOTA_UNLIMIT_TIP")))}function H(a,p){if(1&a&&(t.TgZ(0,"option",21),t._uU(1),t.qZA()),2&a){const e=t.oxw().$implicit;t.Q6J("value",e.UNIT),t.xp6(1),t.hij(" ",null==e?null:e.UNIT," ")}}function S(a,p){1&a&&t.YNc(0,H,2,2,"option",20),2&a&&t.Q6J("ngIf",p.index>1)}function x(a,p){if(1&a&&(t.TgZ(0,"div",22)(1,"div",23),t._UZ(2,"progress",24),t.qZA(),t.TgZ(3,"label",25),t._uU(4),t.ALo(5,"translate"),t.ALo(6,"translate"),t.ALo(7,"translate"),t.qZA()()),2&a){const e=t.oxw(),o=t.MAs(21);t.xp6(1),t.ekj("danger",e.isDangerColor(+e.quotaHardLimitValue.storageLimit,e.quotaHardLimitValue.storageUsed,e.quotaHardLimitValue.storageUnit))("warning",e.isWarningColor(+e.quotaHardLimitValue.storageLimit,e.quotaHardLimitValue.storageUsed,e.quotaHardLimitValue.storageUnit)),t.xp6(1),t.s9C("value",o.invalid||-1==+e.quotaHardLimitValue.storageLimit?0:e.quotaHardLimitValue.storageUsed),t.s9C("max",o.invalid?0:e.getByte(+e.quotaHardLimitValue.storageLimit,e.quotaHardLimitValue.storageUnit)),t.xp6(2),t.HOy(" ",-1!=+e.quotaHardLimitValue.storageLimit?e.getIntegerAndUnit(e.getByte(e.quotaHardLimitValue.storageLimit,e.quotaHardLimitValue.storageUnit),e.quotaHardLimitValue.storageUsed).partNumberUsed+e.getIntegerAndUnit(e.getByte(e.quotaHardLimitValue.storageLimit,e.quotaHardLimitValue.storageUnit),e.quotaHardLimitValue.storageUsed).partCharacterUsed:e.getSuitableUnit(e.quotaHardLimitValue.storageUsed)," ",t.lcZ(5,10,"QUOTA.OF")," ",null!=o&&o.valid?-1==+(null==e.quotaHardLimitValue?null:e.quotaHardLimitValue.storageLimit)?t.lcZ(6,12,"QUOTA.UNLIMITED"):null==e.quotaHardLimitValue?null:e.quotaHardLimitValue.storageLimit:t.lcZ(7,14,"QUOTA.INVALID_INPUT")," ",-1==+(null==e.quotaHardLimitValue?null:e.quotaHardLimitValue.storageLimit)?"":null==e.quotaHardLimitValue?null:e.quotaHardLimitValue.storageUnit," ")}}let j=(()=>{class a{constructor(){this.defaultTextsObj={editQuota:"",setQuota:"",storageQuota:"",isSystemDefaultQuota:!1},this.quotaHardLimitValue={storageLimit:-1,storageUnit:""},this.quotaUnits=i.NZ,this.staticBackdrop=!0,this.closable=!1,this.confirmAction=new t.vpe,this.quotaDangerCoefficient=i.u1,this.quotaWarningCoefficient=i.HE}onSubmit(){this.confirmAction.emit({formValue:this.currentForm.value,isSystemDefaultQuota:this.defaultTextsObj.isSystemDefaultQuota,id:this.quotaHardLimitValue.id})}onCancel(){this.openEditQuota=!1}openEditQuotaModal(e){this.defaultTextsObj=e,this.quotaHardLimitValue=this.defaultTextsObj.isSystemDefaultQuota?{storageLimit:e.quotaHardLimitValue.storageLimit===i.GI?i.GI:(0,n.gv)(e.quotaHardLimitValue.storageLimit,(0,n.d9)(i.NZ),0,(0,n.d9)(i.NZ)).partNumberHard,storageUnit:e.quotaHardLimitValue.storageLimit===i.GI?i.NZ[3].UNIT:(0,n.gv)(e.quotaHardLimitValue.storageLimit,(0,n.d9)(i.NZ),0,(0,n.d9)(i.NZ)).partCharacterHard}:{storageLimit:e.quotaHardLimitValue.hard.storage===i.GI?i.GI:(0,n.gv)(e.quotaHardLimitValue.hard.storage,(0,n.d9)(i.NZ),e.quotaHardLimitValue.used.storage,(0,n.d9)(i.NZ)).partNumberHard,storageUnit:e.quotaHardLimitValue.hard.storage===i.GI?i.NZ[3].UNIT:(0,n.gv)(e.quotaHardLimitValue.hard.storage,(0,n.d9)(i.NZ),e.quotaHardLimitValue.used.storage,(0,n.d9)(i.NZ)).partCharacterHard,id:e.quotaHardLimitValue.id,storageUsed:e.quotaHardLimitValue.used.storage},this.currentForm.resetForm({storage:this.quotaHardLimitValue.storageLimit,storageUnit:this.quotaHardLimitValue.storageUnit}),this.openEditQuota=!0,this.currentForm.form.controls.storage.setValidators([C.kI.required,C.kI.pattern("(^-1$)|(^([1-9]+)([0-9]+)*$)"),(0,n.CG)(this.currentForm.form.controls.storageUnit)]),this.currentForm.form.valueChanges.pipe((0,I.x)((r,u)=>JSON.stringify(r)===JSON.stringify(u))).subscribe(r=>{["storage","storageUnit"].forEach(u=>{this.currentForm.form.get(u)&&null!==this.currentForm.form.get(u).value&&this.currentForm.form.get(u).updateValueAndValidity()})})}get isValid(){return this.currentForm.valid&&this.currentForm.dirty}getSuitableUnit(e){const o=(0,n.d9)(i.NZ);return(0,n.kU)(e,o)}getIntegerAndUnit(e,o){return(0,n.gv)(e,(0,n.d9)(i.NZ),o,(0,n.d9)(i.NZ))}getByte(e,o){return+e==+e?(0,n.J1)(+e,o):0}isDangerColor(e,o,r){return r?e!==i.GI&&+o/(0,n.J1)(+e,r)>=this.quotaDangerCoefficient:e!==i.GI&&+o/+e>=this.quotaDangerCoefficient}isWarningColor(e,o,r){return r?e!==i.GI&&+o/(0,n.J1)(+e,r)>=this.quotaWarningCoefficient&&+o/(0,n.J1)(+e,r)<=this.quotaDangerCoefficient:e!==i.GI&&+o/+e>=this.quotaWarningCoefficient&&+o/+e<=this.quotaDangerCoefficient}}return a.\u0275fac=function(e){return new(e||a)},a.\u0275cmp=t.Xpm({type:a,selectors:[["edit-project-quotas"]],viewQuery:function(e,o){if(1&e&&(t.Gf(L.l,5),t.Gf(D,7)),2&e){let r;t.iGM(r=t.CRH())&&(o.inlineAlert=r.first),t.iGM(r=t.CRH())&&(o.currentForm=r.first)}},outputs:{confirmAction:"confirmAction"},decls:32,vars:24,consts:[[1,"quota-modal",3,"clrModalOpen","clrModalStaticBackdrop","clrModalClosable","clrModalOpenChange"],[1,"modal-title"],[1,"modal-title","p-0"],[1,"modal-body"],[1,"body-label"],[1,"clr-form","clr-form-horizontal"],["quotaForm","ngForm"],["for","count",1,"left-label","required"],["clrTooltipTrigger","","shape","info-circle","size","24"],["clrPosition","top-right","clrSize","lg",4,"clrIfOpen"],[1,"clr-select-wrapper"],["id","select-error","name","storageUnit",1,"clr-select",3,"ngModel","ngModelChange"],["ngFor","",3,"ngForOf"],["class","progress-block progress-min-width progress-div",4,"ngIf"],["clrInput","","name","storage","type","text","id","storage","size","40",1,"quota-input",3,"ngModel","ngModelChange"],["storageInput","ngModel"],[1,"modal-footer"],["type","button",1,"btn","btn-outline",3,"click"],["id","edit-quota-save","type","button",1,"btn","btn-primary",3,"disabled","click"],["clrPosition","top-right","clrSize","lg"],[3,"value",4,"ngIf"],[3,"value"],[1,"progress-block","progress-min-width","progress-div"],[1,"progress","success"],["data-displayval","100%",3,"value","max"],[1,"progress-label"]],template:function(e,o){1&e&&(t.TgZ(0,"clr-modal",0),t.NdJ("clrModalOpenChange",function(u){return o.openEditQuota=u}),t.TgZ(1,"h3",1),t._uU(2),t.qZA(),t._UZ(3,"inline-alert",2),t.TgZ(4,"div",3)(5,"label",4),t._uU(6),t.qZA(),t.TgZ(7,"form",5,6)(9,"clr-input-container")(10,"label",7),t._uU(11),t.ALo(12,"translate"),t.TgZ(13,"clr-tooltip"),t._UZ(14,"clr-icon",8),t.YNc(15,y,4,3,"clr-tooltip-content",9),t.qZA(),t.TgZ(16,"div",10)(17,"select",11),t.NdJ("ngModelChange",function(u){return o.quotaHardLimitValue.storageUnit=u}),t.YNc(18,S,1,1,"ng-template",12),t.qZA()(),t.YNc(19,x,8,16,"div",13),t.qZA(),t.TgZ(20,"input",14,15),t.NdJ("ngModelChange",function(u){return o.quotaHardLimitValue.storageLimit=u}),t.qZA(),t.TgZ(22,"clr-control-error"),t._uU(23),t.ALo(24,"translate"),t.qZA()()()(),t.TgZ(25,"div",16)(26,"button",17),t.NdJ("click",function(){return o.onCancel()}),t._uU(27),t.ALo(28,"translate"),t.qZA(),t.TgZ(29,"button",18),t.NdJ("click",function(){return o.onSubmit()}),t._uU(30),t.ALo(31,"translate"),t.qZA()()()),2&e&&(t.Q6J("clrModalOpen",o.openEditQuota)("clrModalStaticBackdrop",o.staticBackdrop)("clrModalClosable",o.closable),t.xp6(2),t.Oqu(o.defaultTextsObj.editQuota),t.xp6(4),t.Oqu(o.defaultTextsObj.setQuota),t.xp6(1),t.ekj("clr-form-compact-common",!o.defaultTextsObj.isSystemDefaultQuota),t.xp6(4),t.hij("",t.lcZ(12,16,o.defaultTextsObj.storageQuota)," "),t.xp6(6),t.Q6J("ngModel",o.quotaHardLimitValue.storageUnit),t.xp6(1),t.Q6J("ngForOf",o.quotaUnits),t.xp6(1),t.Q6J("ngIf",!o.defaultTextsObj.isSystemDefaultQuota),t.xp6(1),t.Q6J("ngModel",o.quotaHardLimitValue.storageLimit),t.xp6(3),t.Oqu(t.lcZ(24,18,"PROJECT.STORAGE_QUOTA_TIP")),t.xp6(4),t.hij(" ",t.lcZ(28,20,"BUTTON.CANCEL")," "),t.xp6(2),t.Q6J("disabled",!o.isValid),t.xp6(1),t.hij(" ",t.lcZ(31,22,"BUTTON.OK")," "))},dependencies:[C._Y,C.YN,C.Kr,C.Fj,C.EJ,C.JJ,C.JL,C.On,C.F,c.qvL,c.qAN,c.VLi,c.nqY,c.MgK,c.VqA,c.xRP,c.G55,c.Jmj,c.bMv,c.zDF,P.sg,P.O5,L.l,q.X$],styles:["[_nghost-%COMP%]  .modal-dialog{width:29rem}.modal-body[_ngcontent-%COMP%]{outline:none;padding-top:.8rem;overflow-y:visible;overflow-x:visible}.modal-body[_ngcontent-%COMP%]   .body-label[_ngcontent-%COMP%]{font-size:14px}.modal-body[_ngcontent-%COMP%]   .clr-form[_ngcontent-%COMP%]{padding-left:0}.modal-body[_ngcontent-%COMP%]   .clr-form[_ngcontent-%COMP%]   .left-label[_ngcontent-%COMP%]{width:11.5rem;font-weight:100;position:relative}.modal-body[_ngcontent-%COMP%]   .clr-form[_ngcontent-%COMP%]   .mr-3px[_ngcontent-%COMP%]{margin-right:3px}.modal-body[_ngcontent-%COMP%]   .clr-form[_ngcontent-%COMP%]   .quota-input[_ngcontent-%COMP%]{width:2.25rem;margin-left:1rem;margin-right:.2rem}.modal-body[_ngcontent-%COMP%]   .clr-form[_ngcontent-%COMP%]   .clr-validate-icon[_ngcontent-%COMP%]{margin-left:-.6rem}.modal-body[_ngcontent-%COMP%]   .clr-form[_ngcontent-%COMP%]   .select-div[_ngcontent-%COMP%]{width:2.5rem}.modal-body[_ngcontent-%COMP%]   .clr-form[_ngcontent-%COMP%]   .clr-select-wrapper[_ngcontent-%COMP%]{position:absolute;right:-8rem;top:-.11rem}.modal-body[_ngcontent-%COMP%]   .clr-form-compact-common[_ngcontent-%COMP%]   .left-label[_ngcontent-%COMP%]{width:9.5rem}.modal-body[_ngcontent-%COMP%]   .clr-form-compact-common[_ngcontent-%COMP%]   .quota-input[_ngcontent-%COMP%]{margin-left:0}.modal-body[_ngcontent-%COMP%]   .clr-form-compact-common[_ngcontent-%COMP%]   .select-div[_ngcontent-%COMP%]{width:1.6rem}.modal-body[_ngcontent-%COMP%]   .clr-form-compact-common[_ngcontent-%COMP%]   .clr-select-wrapper[_ngcontent-%COMP%]{right:-5.5rem}select[_ngcontent-%COMP%]{font-weight:100}.progress-block[_ngcontent-%COMP%]{width:8rem}.progress-div[_ngcontent-%COMP%]{position:absolute;padding-right:.6rem;width:7.5rem;top:.2rem;right:-13.3rem}.progress-label[_ngcontent-%COMP%]{position:absolute;right:-4rem;margin-top:0;width:5rem;font-weight:100;font-size:10px}  .clr-error .clr-validate-icon{margin-left:-12px}"]}),a})();const V=["editProjectQuotas"];function N(a,p){if(1&a){const e=t.EpF();t.TgZ(0,"clr-dg-row",24)(1,"clr-dg-cell")(2,"a",25),t.NdJ("click",function(){const u=t.CHM(e).$implicit,v=t.oxw();return t.KtG(v.goToLink(null==u||null==u.ref?null:u.ref.id))}),t._uU(3),t.qZA()(),t.TgZ(4,"clr-dg-cell"),t._uU(5),t.qZA(),t.TgZ(6,"clr-dg-cell")(7,"div",26)(8,"div",27),t._UZ(9,"progress",28),t.qZA(),t.TgZ(10,"label",29),t._uU(11),t.ALo(12,"translate"),t.ALo(13,"translate"),t.qZA()()()()}if(2&a){const e=p.$implicit,o=t.oxw();t.Q6J("clrDgItem",e),t.xp6(3),t.Oqu(null==e||null==e.ref?null:e.ref.name),t.xp6(2),t.Oqu(null==e||null==e.ref?null:e.ref.owner_name),t.xp6(3),t.ekj("danger",-1!==e.hard.storage&&e.used.storage/e.hard.storage>o.quotaDangerCoefficient)("warning",-1!==e.hard.storage&&e.used.storage/e.hard.storage>=o.quotaWarningCoefficient&&e.used.storage/e.hard.storage<=o.quotaDangerCoefficient),t.xp6(1),t.s9C("value",-1===e.hard.storage?0:e.used.storage),t.s9C("max",e.hard.storage),t.xp6(2),t.lnq("",-1===(null==e||null==e.hard?null:e.hard.storage)?o.getSuitableUnit(null==e||null==e.used?null:e.used.storage):o.getIntegerAndUnit(null==e||null==e.hard?null:e.hard.storage,null==e||null==e.used?null:e.used.storage).partNumberUsed+o.getIntegerAndUnit(null==e||null==e.hard?null:e.hard.storage,null==e||null==e.used?null:e.used.storage).partCharacterUsed," ",t.lcZ(12,12,"QUOTA.OF")," ",t.lcZ(13,14,-1===(null==e||null==e.hard?null:e.hard.storage)?"QUOTA.UNLIMITED":o.getIntegerAndUnit(null==e||null==e.hard?null:e.hard.storage,null==e||null==e.used?null:e.used.storage).partNumberHard+o.getIntegerAndUnit(null==e||null==e.hard?null:e.hard.storage,null==e||null==e.used?null:e.used.storage).partCharacterHard)," ")}}function w(a,p){if(1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a){t.oxw();const e=t.MAs(44);t.xp6(1),t.lnq("",e.firstItem+1," - ",e.lastItem+1," ",t.lcZ(2,3,"DESTINATION.OF"),"")}}const R=function(){return[15,25,50]};let J=(()=>{class a{constructor(e,o,r,u,v,W){this.configService=e,this.quotaService=o,this.translate=r,this.router=u,this.errorHandler=v,this.projectService=W,this.config=new h.VK,this.loading=!0,this.configChange=new t.vpe,this.refreshAllconfig=new t.vpe,this.quotaList=[],this.currentPage=1,this.totalCount=0,this.pageSize=(0,n.tb)(n.V2.PROJECT_QUOTA_COMPONENT),this.quotaDangerCoefficient=i.u1,this.quotaWarningCoefficient=i.HE,this.selectedRow=[]}get allConfig(){return this.config}set allConfig(e){this.config=e,this.configChange.emit(this.config)}editQuota(){if(this.selectedRow&&1===this.selectedRow.length){const e=[this.translate.get("QUOTA.EDIT_PROJECT_QUOTAS"),this.translate.get("QUOTA.SET_QUOTAS",{params:this.selectedRow[0].ref.name}),this.translate.get("QUOTA.STORAGE_QUOTA")];(0,g.D)(...e).subscribe(o=>{this.editQuotaDialog.openEditQuotaModal({editQuota:o[0],setQuota:o[1],storageQuota:o[2],quotaHardLimitValue:this.selectedRow[0],isSystemDefaultQuota:!1})})}}editDefaultQuota(e){const o=[this.translate.get("QUOTA.EDIT_DEFAULT_PROJECT_QUOTAS"),this.translate.get("QUOTA.SET_DEFAULT_QUOTAS"),this.translate.get("QUOTA.STORAGE_DEFAULT_QUOTA")];(0,g.D)(...o).subscribe(r=>{this.editQuotaDialog.openEditQuotaModal({editQuota:r[0],setQuota:r[1],storageQuota:r[2],quotaHardLimitValue:e,isSystemDefaultQuota:!0})})}getChanges(){let e=(0,n.My)(this.originalConfig,this.config);return e?this.getQuotaChanges(e):null}getQuotaChanges(e){let o={};for(let r in e)"storage_per_project"===r&&(o[r]=e[r]);return o}saveConfig(e){this.allConfig.storage_per_project.value=+e.storage===i.GI?e.storage:(0,n.J1)(e.storage,e.storageUnit);let o=this.getChanges();(0,n.xb)(o)?this.translate.get("CONFIG.NO_CHANGE").subscribe(r=>{this.editQuotaDialog.inlineAlert.showInlineError(r)}):(this.loading=!0,this.configService.saveConfiguration(o).pipe((0,O.x)(()=>{this.loading=!1,this.editQuotaDialog.openEditQuota=!1})).subscribe(r=>{this.refreshAllconfig.emit(),this.errorHandler.info("CONFIG.SAVE_SUCCESS")},r=>{this.errorHandler.error(r)}))}confirmEdit(e){e.isSystemDefaultQuota?this.saveConfig(e.formValue):this.saveCurrentQuota(e)}saveCurrentQuota(e){let r={hard:{storage:+e.formValue.storage===i.GI?+e.formValue.storage:(0,n.J1)(+e.formValue.storage,e.formValue.storageUnit)}};this.loading=!0,this.quotaService.updateQuota({id:e.id,hard:r}).subscribe(u=>{this.editQuotaDialog.openEditQuota=!1,this.getQuotaList(this.currentState),this.errorHandler.info("QUOTA.SAVE_SUCCESS")},u=>{this.editQuotaDialog.inlineAlert.showInlineError(u),this.loading=!1})}getquotaHardLimitValue(){const e=this.allConfig.storage_per_project?this.allConfig.storage_per_project.value:i.GI,o=e,r=this.getIntegerAndUnit(e,0).partCharacterHard;this.quotaHardLimitValue={storageLimit:o,storageUnit:r}}getQuotaList(e){if(!e||!e.page)return;this.pageSize=e.page.size,(0,n.Pe)(n.V2.PROJECT_QUOTA_COMPONENT,this.pageSize),this.currentState=e;let o=(0,n.wy)(e);o<=0&&(o=1),this.loading=!0,this.quotaService.listQuotasResponse({reference:"project",page:o,pageSize:this.pageSize}).pipe((0,O.x)(()=>{this.loading=!1,this.selectedRow=[]})).subscribe(r=>{if(r.headers){let u=r.headers.get("X-Total-Count");u&&(this.totalCount=parseInt(u,0))}this.quotaList=r.body.filter(u=>null!==u.ref)},r=>{this.errorHandler.error(r)})}ngOnChanges(e){e&&e.allConfig&&(this.originalConfig=(0,n.d9)(this.config),this.getquotaHardLimitValue())}getSuitableUnit(e){const o=(0,n.d9)(i.NZ);return(0,n.kU)(e,o)}getIntegerAndUnit(e,o){return(0,n.gv)(e,(0,n.d9)(i.NZ),o,(0,n.d9)(i.NZ))}goToLink(e){this.router.navigate(["harbor","projects",e])}refresh(){this.filterComponent&&(this.filterComponent.currentValue=null),this.currentPage=1,this.selectedRow=[],this.getQuotaList(this.currentState)}doSearch(e){e?this.projectService.listProjects({withDetail:!1,q:encodeURIComponent(`name=${e}`)}).pipe((0,f.z)(o=>o&&o.length?this.quotaService.listQuotas({referenceId:o[0].project_id.toString()}):(0,d.of)([]))).subscribe(o=>{this.quotaList=o}):this.refresh()}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(A.e),t.Y36(E.U),t.Y36(q.sK),t.Y36(Q.F0),t.Y36(Z.q),t.Y36(b.Y))},a.\u0275cmp=t.Xpm({type:a,selectors:[["project-quotas"]],viewQuery:function(e,o){if(1&e&&(t.Gf(V,5),t.Gf(m.z,5)),2&e){let r;t.iGM(r=t.CRH())&&(o.editQuotaDialog=r.first),t.iGM(r=t.CRH())&&(o.filterComponent=r.first)}},inputs:{allConfig:"allConfig"},outputs:{configChange:"configChange",refreshAllconfig:"refreshAllconfig"},features:[t.TTD],decls:53,vars:46,consts:[[1,"color-0","pt-19px","font-size-13"],[1,"row","label-config"],[1,"col-lg-12","col-md-12","col-sm-12","col-xs-12","quota-top"],[1,"default-quota"],[1,"default-quota-text"],[1,"width-10rem"],[1,"num-count"],["id","open-edit",1,"btn","btn-link","btn-sm","default-quota-edit-button",3,"click"],[1,"col-lg-12","col-md-12","col-sm-12","col-xs-12"],[3,"clrDgSelected","clrDgLoading","clrDgSelectedChange","clrDgRefresh"],[1,"clr-row"],[1,"clr-col"],["type","button",1,"btn","btn-secondary",3,"disabled","click"],[1,"clr-row","search"],[3,"withDivider","filterPlaceholder","filterEvt"],[1,"refresh-btn",3,"click"],["shape","refresh"],[3,"clrDgItem",4,"ngFor","ngForOf"],[3,"clrDgPageSize","clrDgPage","clrDgTotalItems","clrDgPageChange"],["pagination",""],[3,"clrPageSizeOptions"],[4,"ngIf"],[3,"confirmAction"],["editProjectQuotas",""],[3,"clrDgItem"],["href","javascript:void(0)",3,"click"],[1,"progress-block","progress-min-width"],[1,"progress","success"],["data-displayval","100%",3,"value","max"],[1,"min-label-width"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div")(5,"div",4)(6,"span",5),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.TgZ(9,"span",6),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"button",7),t.NdJ("click",function(){return o.editDefaultQuota(o.quotaHardLimitValue)}),t._uU(13),t.ALo(14,"translate"),t.qZA()()()()(),t.TgZ(15,"div",8)(16,"clr-datagrid",9),t.NdJ("clrDgSelectedChange",function(u){return o.selectedRow=u})("clrDgRefresh",function(u){return o.getQuotaList(u)}),t.TgZ(17,"clr-dg-action-bar")(18,"div",10)(19,"div",11)(20,"button",12),t.NdJ("click",function(){return o.editQuota()}),t._uU(21),t.ALo(22,"translate"),t.qZA()(),t.TgZ(23,"div",11)(24,"div",13)(25,"hbr-filter",14),t.NdJ("filterEvt",function(u){return o.doSearch(u)}),t.ALo(26,"translate"),t.qZA(),t.TgZ(27,"span",15),t.NdJ("click",function(){return o.refresh()}),t._UZ(28,"clr-icon",16),t.qZA()()()()(),t.TgZ(29,"clr-dg-column"),t._uU(30),t.ALo(31,"translate"),t.qZA(),t.TgZ(32,"clr-dg-column"),t._uU(33),t.ALo(34,"translate"),t.qZA(),t.TgZ(35,"clr-dg-column"),t._uU(36),t.ALo(37,"translate"),t.qZA(),t.TgZ(38,"clr-dg-placeholder"),t._uU(39),t.ALo(40,"translate"),t.qZA(),t.YNc(41,N,14,16,"clr-dg-row",17),t.TgZ(42,"clr-dg-footer")(43,"clr-dg-pagination",18,19),t.NdJ("clrDgPageChange",function(u){return o.currentPage=u}),t.TgZ(45,"clr-dg-page-size",20),t._uU(46),t.ALo(47,"translate"),t.qZA(),t.YNc(48,w,3,5,"span",21),t._uU(49),t.ALo(50,"translate"),t.qZA()()()()(),t.TgZ(51,"edit-project-quotas",22,23),t.NdJ("confirmAction",function(u){return o.confirmEdit(u)}),t.qZA()()),2&e&&(t.xp6(7),t.Oqu(t.lcZ(8,23,"QUOTA.PROJECT_QUOTA_DEFAULT_DISK")),t.xp6(3),t.AsE("",-1===(null==o.quotaHardLimitValue?null:o.quotaHardLimitValue.storageLimit)?t.lcZ(11,25,"QUOTA.UNLIMITED"):o.getIntegerAndUnit(null==o.quotaHardLimitValue?null:o.quotaHardLimitValue.storageLimit,0).partNumberHard," ",-1===(null==o.quotaHardLimitValue?null:o.quotaHardLimitValue.storageLimit)?"":null==o.quotaHardLimitValue?null:o.quotaHardLimitValue.storageUnit,""),t.xp6(3),t.hij(" ",t.lcZ(14,27,"QUOTA.EDIT")," "),t.xp6(3),t.Q6J("clrDgSelected",o.selectedRow)("clrDgLoading",o.loading),t.xp6(4),t.Q6J("disabled",!(o.selectedRow&&1===o.selectedRow.length)),t.xp6(1),t.hij(" ",t.lcZ(22,29,"QUOTA.EDIT")," "),t.xp6(4),t.s9C("filterPlaceholder",t.lcZ(26,31,"QUOTA.FILTER_PLACEHOLDER")),t.Q6J("withDivider",!0),t.xp6(5),t.Oqu(t.lcZ(31,33,"QUOTA.PROJECT")),t.xp6(3),t.Oqu(t.lcZ(34,35,"QUOTA.OWNER")),t.xp6(3),t.Oqu(t.lcZ(37,37,"QUOTA.STORAGE")),t.xp6(3),t.Oqu(t.lcZ(40,39,"QUOTA.PLACEHOLDER")),t.xp6(2),t.Q6J("ngForOf",o.quotaList),t.xp6(2),t.Q6J("clrDgPageSize",o.pageSize)("clrDgPage",o.currentPage)("clrDgTotalItems",o.totalCount),t.xp6(2),t.Q6J("clrPageSizeOptions",t.DdM(45,R)),t.xp6(1),t.Oqu(t.lcZ(47,41,"PAGINATION.PAGE_SIZE")),t.xp6(2),t.Q6J("ngIf",o.totalCount),t.xp6(1),t.AsE(" ",o.totalCount," ",t.lcZ(50,43,"SUMMARY.QUOTAS")," "))},dependencies:[c.C9t,c.Gwl,c.m4W,c.Z4N,c.fv_,c.dRQ,c.Ltv,c.YYR,c.F7K,c.PDs,c.KHL,c.Gcc,c.jND,c.Nh1,c.dml,c.K8c,c.qvL,c.MgK,P.sg,P.O5,m.z,j,q.X$],styles:[".default-quota[_ngcontent-%COMP%]{display:flex}.default-quota[_ngcontent-%COMP%]   .default-quota-text[_ngcontent-%COMP%]{display:flex;align-items:center;font-family:Metropolis,Avenir Next,Helvetica Neue,Arial,sans-serif}.default-quota[_ngcontent-%COMP%]   .default-quota-text[_ngcontent-%COMP%]   .width-10rem[_ngcontent-%COMP%]{width:15rem;font-size:15px}.default-quota[_ngcontent-%COMP%]   .default-quota-text[_ngcontent-%COMP%]   .num-count[_ngcontent-%COMP%]{display:inline-block;min-width:2rem;font-weight:600;font-size:15px;text-transform:uppercase}.pt-19px[_ngcontent-%COMP%]{padding-top:19px}.font-size-13[_ngcontent-%COMP%]{font-size:13px}.progress-block[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:400!important;width:30%;font-size:10px}.default-quota-edit-button[_ngcontent-%COMP%]{font-size:14px;margin-left:60px}.min-label-width[_ngcontent-%COMP%]{min-width:120px}.quota-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;line-height:1.55;margin-bottom:.35rem}[_nghost-%COMP%]  .progress.warning>progress{color:orange}[_nghost-%COMP%]  .progress.warning>progress::-webkit-progress-value{background-color:orange}[_nghost-%COMP%]  .progress.warning>progress::-moz-progress-bar{background-color:orange}[_nghost-%COMP%]  .progress>progress{height:75%}.action-head-pos[_ngcontent-%COMP%]{padding-right:18px;height:100%;display:flex;justify-content:flex-end;align-items:center}.search[_ngcontent-%COMP%]{align-items:baseline;padding-top:.2rem;justify-content:flex-end;margin-right:2rem}[_nghost-%COMP%]  .filter-input{width:210px}"]}),a})();function G(a,p){if(1&a){const e=t.EpF();t.TgZ(0,"project-quotas",3),t.NdJ("refreshAllconfig",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.refreshAllconfig())}),t.qZA()}if(2&a){const e=t.oxw();t.Q6J("allConfig",e.allConfig)}}const z=[{path:"",component:(()=>{class a{constructor(e,o,r){this.session=e,this.configService=o,this.msgHandler=r,this.allConfig=new h.VK,this.loading=!1}ngOnInit(){let e=this.session.getCurrentUser();e&&e.has_admin_role&&this.retrieveConfig()}refreshAllconfig(){this.retrieveConfig()}retrieveConfig(){this.loading=!0,this.configService.getConfiguration().pipe((0,O.x)(()=>this.loading=!1)).subscribe(e=>{this.allConfig=e},e=>{this.msgHandler.handleError(e)})}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(U.m),t.Y36(A.e),t.Y36(_.d))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-project-quotas"]],decls:5,vars:5,consts:[["sub-header-title","",1,"custom-h2"],[1,"spinner","spinner-inline","ml-1","v-mid",3,"hidden"],[3,"allConfig","refreshAllconfig",4,"ngIf"],[3,"allConfig","refreshAllconfig"]],template:function(e,o){1&e&&(t.TgZ(0,"h2",0),t._uU(1),t.ALo(2,"translate"),t._UZ(3,"span",1),t.qZA(),t.YNc(4,G,1,1,"project-quotas",2)),2&e&&(t.xp6(1),t.hij(" ",t.lcZ(2,3,"CONFIG.PROJECT_QUOTAS"),""),t.xp6(2),t.Q6J("hidden",!o.loading),t.xp6(1),t.Q6J("ngIf",!o.loading))},dependencies:[P.O5,J,q.X$],styles:[".v-mid[_ngcontent-%COMP%]{vertical-align:middle}"]}),a})()}];let B=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[s.m,Q.Bz.forChild(z)]}),a})()},8348:(M,T,l)=>{l.d(T,{z:()=>P});var s=l(4650),Q=l(7579),O=l(8372),h=l(4006),t=l(6895),U=l(9375);const A=["inputElement"];function _(n,i){1&n&&s._UZ(0,"span",4)}let P=(()=>{class n{constructor(g){this.cd=g,this.placeHolder="",this.filterTerms=new Q.x,this.isExpanded=!1,this.filterEvt=new s.vpe,this.openFlag=new s.vpe,this.readonly=null,this.expandMode=!1,this.withDivider=!1}set filterPlaceholder(g){this.placeHolder=g}ngOnInit(){this.filterTerms.pipe((0,O.b)(500)).subscribe(g=>{this.filterEvt.emit(g)})}valueChange(){this.filterTerms.next(this.currentValue&&this.currentValue.trim())}inputFocus(){this.openFlag.emit(this.isExpanded)}onClick(){this.expandMode||(this.isExpanded=!this.isExpanded,this.isExpanded&&(this.cd.detectChanges(),this.inputElement.nativeElement.focus()),this.openFlag.emit(this.isExpanded))}get isShowSearchBox(){return this.expandMode||!this.expandMode&&this.isExpanded}}return n.\u0275fac=function(g){return new(g||n)(s.Y36(s.sBO))},n.\u0275cmp=s.Xpm({type:n,selectors:[["hbr-filter"]],viewQuery:function(g,d){if(1&g&&s.Gf(A,5),2&g){let f;s.iGM(f=s.CRH())&&(d.inputElement=f.first)}},inputs:{readonly:"readonly",currentValue:"currentValue",filterPlaceholder:"filterPlaceholder",expandMode:"expandMode",withDivider:"withDivider",width:"width"},outputs:{filterEvt:"filterEvt",openFlag:"openFlag"},decls:5,vars:9,consts:[["shape","search","size","20",1,"search-btn",3,"click"],["type","text","autofocus","",1,"filter-input","clr-input",3,"hidden","placeholder","ngModel","keyup","focus","ngModelChange"],["inputElement",""],["class","filter-divider",4,"ngIf"],[1,"filter-divider"]],template:function(g,d){1&g&&(s.TgZ(0,"span")(1,"clr-icon",0),s.NdJ("click",function(){return d.onClick()}),s.qZA(),s.TgZ(2,"input",1,2),s.NdJ("keyup",function(){return d.valueChange()})("focus",function(){return d.inputFocus()})("ngModelChange",function(m){return d.currentValue=m}),s.qZA(),s.YNc(4,_,1,0,"span",3),s.qZA()),2&g&&(s.xp6(1),s.ekj("filter-icon",d.isShowSearchBox),s.xp6(1),s.Udp("width",d.width,"px"),s.s9C("placeholder",d.placeHolder),s.Q6J("hidden",!d.isShowSearchBox)("ngModel",d.currentValue),s.uIk("readOnly",d.readonly),s.xp6(2),s.Q6J("ngIf",d.withDivider))},dependencies:[h.Fj,h.JJ,h.On,t.O5,U.qvL],styles:[".filter-icon[_ngcontent-%COMP%]{position:relative;right:-20px}.filter-divider[_ngcontent-%COMP%]{display:inline-block;height:16px;width:1px;padding-top:12px;padding-bottom:12px;position:relative;top:9px;margin-right:6px;margin-left:6px}.search-btn[_ngcontent-%COMP%]{cursor:pointer}.search-btn[_ngcontent-%COMP%]:hover{color:#007cbb}.filter-input[_ngcontent-%COMP%]{padding-left:24px}"]}),n})()}}]);