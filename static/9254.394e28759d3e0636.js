"use strict";(self.webpackChunkharbor_portal=self.webpackChunkharbor_portal||[]).push([[9254],{4373:(N,T,l)=>{l.d(T,{K:()=>M});var e=l(529),c=l(262),u=l(4004),h=l(2843),_=l(4050),m=l(3526),w=l(4650);const g=m.S$+"/users",P=m.S$+"/users/search?",C=m.S$+"/ldap/users";let M=(()=>{class U{constructor(o){this.http=o}getUserListByPaging(o,s,f){let d=new e.LE;return o&&s&&(d=d.set("page",o+"").set("page_size",s+"")),f&&(d=d.set("username",f)),this.http.get(g,(0,m.gm)(d)).pipe((0,c.K)(E=>(0,h._)(E)))}handleError(o){return(0,h._)(o)}getUsersNameList(o,s){return this.http.get(`${P}page_size=${s}&username=${o}`,m.EX).pipe((0,u.U)(f=>f),(0,c.K)(f=>this.handleError(f)))}getUsers(){return this.http.get(g).pipe((0,u.U)(o=>o,(0,c.K)(o=>this.handleError(o))))}addUser(o){return this.http.post(g,JSON.stringify(o),m.T0).pipe((0,u.U)(()=>null),(0,c.K)(s=>this.handleError(s)))}deleteUser(o){return this.http.delete(g+"/"+o,m.T0).pipe((0,u.U)(()=>null),(0,c.K)(s=>this.handleError(s)))}updateUser(o){return this.http.put(g+"/"+o.user_id,JSON.stringify(o),m.T0).pipe((0,u.U)(()=>null),(0,c.K)(s=>this.handleError(s)))}updateUserRole(o){return this.http.put(g+"/"+o.user_id+"/sysadmin",JSON.stringify(o),m.T0).pipe((0,u.U)(()=>null),(0,c.K)(s=>this.handleError(s)))}changePassword(o,s,f){return o&&s?this.http.put(g+"/"+o+"/password",{old_password:s,new_password:f},m.T0).pipe((0,u.U)(d=>d),(0,c.K)(d=>(0,h._)(d))):(0,h._)("Invalid change uid or password")}getLDAPUsers(o){return this.http.get(`${C}/search?username=${o}`,m.EX).pipe((0,u.U)(s=>(s||[]).map(d=>(0,_.Z)(d))),(0,c.K)(s=>this.handleError(s)))}importLDAPUsers(o){return this.http.post(`${C}/import`,JSON.stringify({ldap_uid_list:o}),m.T0).pipe((0,u.U)(()=>null),(0,c.K)(s=>this.handleError(s)))}}return U.\u0275fac=function(o){return new(o||U)(w.LFG(e.eN))},U.\u0275prov=w.Yz7({token:U,factory:U.\u0275fac,providedIn:"root"}),U})()},4050:(N,T,l)=>{l.d(T,{Z:()=>u,n:()=>e});class e{}const u=function c(h){let _=new e;return _.user_id=0,_.username=h.ldap_username,_.realname=h.ldap_realname,_.email=h.ldap_email,_}},7954:(N,T,l)=>{l.d(T,{T:()=>L});var e=l(4650),c=l(4050),u=l(5832),h=l(1992),_=l(4006),m=l(6895),w=l(9375),g=l(1201),P=l(2466);const C=["newUserFrom"];function M(t,p){if(1&t&&(e.TgZ(0,"clr-control-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t){const n=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,1,n.usernameTooltip)," ")}}function U(t,p){1&t&&(e.TgZ(0,"clr-control-helper"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"TOOLTIP.SIGN_UP_MAIL")))}function O(t,p){if(1&t&&(e.TgZ(0,"clr-control-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t){const n=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,1,n.emailTooltip)," ")}}function o(t,p){1&t&&(e.TgZ(0,"clr-control-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"TOOLTIP.FULL_NAME")," "))}function s(t,p){if(1&t){const n=e.EpF();e.TgZ(0,"clr-icon",26),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.showNewPwd=!i.showNewPwd)}),e.qZA()}}function f(t,p){if(1&t){const n=e.EpF();e.TgZ(0,"clr-icon",27),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.showNewPwd=!i.showNewPwd)}),e.qZA()}}function d(t,p){1&t&&(e.TgZ(0,"clr-control-helper"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"CHANGE_PWD.PASS_TIPS")))}function E(t,p){1&t&&(e.TgZ(0,"clr-control-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"TOOLTIP.PASSWORD")," "))}function I(t,p){if(1&t){const n=e.EpF();e.TgZ(0,"clr-icon",26),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.showConfirmPwd=!i.showConfirmPwd)}),e.qZA()}}function v(t,p){if(1&t){const n=e.EpF();e.TgZ(0,"clr-icon",27),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.showConfirmPwd=!i.showConfirmPwd)}),e.qZA()}}function F(t,p){1&t&&(e.TgZ(0,"clr-control-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"TOOLTIP.CONFIRM_PWD")," "))}function Z(t,p){1&t&&(e.TgZ(0,"clr-control-error"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&t&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"TOOLTIP.COMMENT")," "))}let L=(()=>{class t{constructor(n,r){this.session=n,this.ref=r,this.showNewPwd=!1,this.showConfirmPwd=!1,this.isSelfRegistration=!1,this.valueChange=new e.vpe,this.newUser=new c.n,this.validationStateMap={},this.mailAlreadyChecked={},this.userNameAlreadyChecked={},this.emailTooltip="TOOLTIP.EMAIL",this.usernameTooltip="TOOLTIP.USER_NAME",this.formValueChanged=!1,this.checkOnGoing={}}ngOnInit(){this.resetState()}resetState(){this.showConfirmPwd=!1,this.showNewPwd=!1,this.mailAlreadyChecked={},this.userNameAlreadyChecked={},this.emailTooltip="TOOLTIP.EMAIL",this.usernameTooltip="TOOLTIP.USER_NAME",this.formValueChanged=!1,this.checkOnGoing={username:!1,email:!1},this.validationStateMap={username:!0,email:!0,realname:!0,newPassword:!0,confirmPassword:!0,comment:!0}}isChecking(n){return!this.checkOnGoing[n]}forceRefreshView(n){this.timerHandler&&clearInterval(this.timerHandler),this.timerHandler=setInterval(()=>this.ref.markForCheck(),100),setTimeout(()=>{this.timerHandler&&(clearInterval(this.timerHandler),this.timerHandler=null)},n)}getValidationState(n){return!this.validationStateMap[n]}handleValidation(n,r){if(r){let i=this.newUserForm.controls[n];if(i&&(this.validationStateMap[n]=i.valid,i.valid&&this.formValueChanged)){if("username"===n&&""!==this.newUser.username.trim())return this.userNameAlreadyChecked[this.newUser.username.trim()]?(this.validationStateMap[n]=!this.userNameAlreadyChecked[this.newUser.username.trim()].result,void(this.validationStateMap[n]||(this.usernameTooltip="TOOLTIP.USER_EXISTING"))):(this.checkOnGoing[n]=!0,void this.session.checkUserExisting("username",this.newUser.username).subscribe(a=>{this.checkOnGoing[n]=!1,this.validationStateMap[n]=!a,a&&(this.usernameTooltip="TOOLTIP.USER_EXISTING"),this.userNameAlreadyChecked[this.newUser.username.trim()]={result:a},this.forceRefreshView(2e3)},a=>{this.checkOnGoing[n]=!1,this.validationStateMap[n]=!1,this.forceRefreshView(2e3)}));if("email"===n&&""!==this.newUser.email.trim())return this.mailAlreadyChecked[this.newUser.email.trim()]?(this.validationStateMap[n]=!this.mailAlreadyChecked[this.newUser.email.trim()].result,void(this.validationStateMap[n]||(this.emailTooltip="TOOLTIP.EMAIL_EXISTING"))):(this.checkOnGoing[n]=!0,void this.session.checkUserExisting("email",this.newUser.email).subscribe(a=>{this.checkOnGoing[n]=!1,this.validationStateMap[n]=!a,a&&(this.emailTooltip="TOOLTIP.EMAIL_EXISTING"),this.mailAlreadyChecked[this.newUser.email.trim()]={result:a},this.forceRefreshView(2e3)},a=>{this.checkOnGoing[n]=!1,this.validationStateMap[n]=!1,this.forceRefreshView(2e3)}));if("confirmPassword"===n||"newPassword"===n){let A=this.newUserForm.controls["confirmPassword"===n?"newPassword":"confirmPassword"];A&&A.valid&&(this.validationStateMap.confirmPassword=i.value===A.value)}}}else this.validationStateMap[n]=!0,"email"===n&&(this.emailTooltip="TOOLTIP.EMAIL"),"username"===n&&(this.usernameTooltip="TOOLTIP.USER_NAME")}get isValid(){let n=!0;return this.newUserForm.controls.confirmPassword&&this.newUserForm.controls.newPassword&&(n=this.newUserForm.controls.confirmPassword.value===this.newUserForm.controls.newPassword.value),this.newUserForm&&this.newUserForm.valid&&n&&this.validationStateMap.username&&this.validationStateMap.email}ngAfterViewChecked(){this.newUserFormRef!==this.newUserForm&&(this.newUserFormRef=this.newUserForm,this.newUserFormRef&&this.newUserFormRef.valueChanges.subscribe(n=>{this.formValueChanged=!0,this.valueChange.emit(!0)}))}getData(){return this.newUser}reset(){this.resetState(),this.newUserForm&&this.newUserForm.reset()}isEmpty(){return(0,u.Oc)(this.newUserForm)}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(h.m),e.Y36(e.sBO))},t.\u0275cmp=e.Xpm({type:t,selectors:[["new-user-form"]],viewQuery:function(n,r){if(1&n&&e.Gf(C,7),2&n){let i;e.iGM(i=e.CRH())&&(r.newUserForm=i.first)}},inputs:{isSelfRegistration:"isSelfRegistration"},outputs:{valueChange:"valueChange"},decls:65,vars:48,consts:[[1,"clr-form","clr-form-horizontal"],["newUserFrom","ngForm"],[1,"clr-form-control"],[1,"required","clr-control-label"],[1,"clr-control-container"],[1,"clr-input-wrapper"],["type","text","required","","pattern",'[^"~#$%]+',"maxLengthExt","255","name","username","id","username","size","30",1,"clr-input",3,"ngModel","ngModelChange","input","blur"],["usernameInput","ngModel"],["shape","exclamation-circle",1,"clr-validate-icon"],[1,"spinner","spinner-inline","spinner-pos",3,"hidden"],[4,"ngIf"],["name","email","type","text","required","","email","","id","email","size","30",1,"clr-input",3,"ngModel","ngModelChange","input","blur"],["eamilInput","ngModel"],[1,"required"],["clrInput","","type","text","name","realname","required","","maxLengthExt","80","id","realname","size","30",3,"ngModel","ngModelChange","input","blur"],["fullNameInput","ngModel"],["for","newPassword",1,"clr-control-label","required"],["id","newPassword","required","","pattern","^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\\s).{8,128}$","name","newPassword","size","30",1,"clr-input","pwd-input",3,"type","ngModel","ngModelChange","input","blur"],["newPassInput","ngModel"],["shape","eye","class","pw-eye",3,"click",4,"ngIf"],["shape","eye-hide","class","pw-eye",3,"click",4,"ngIf"],["for","confirmPassword",1,"clr-control-label","required"],["id","confirmPassword","required","","pattern","^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\\s).{8,128}$","name","confirmPassword","size","30",1,"clr-input","pwd-input",3,"type","ngModel","ngModelChange","input","blur"],["confirmPassInput","ngModel"],["clrInput","","type","text","name","comment","maxLengthExt","30","id","comment","size","30",3,"ngModel","ngModelChange","input","blur"],["commentInput","ngModel"],["shape","eye",1,"pw-eye",3,"click"],["shape","eye-hide",1,"pw-eye",3,"click"]],template:function(n,r){1&n&&(e.TgZ(0,"div")(1,"form",0,1)(3,"div",2)(4,"label",3),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"div",4)(8,"div",5)(9,"input",6,7),e.NdJ("ngModelChange",function(a){return r.newUser.username=a})("input",function(){return r.handleValidation("username",!1)})("blur",function(){return r.handleValidation("username",!0)}),e.qZA(),e._UZ(11,"clr-icon",8)(12,"span",9),e.qZA(),e.YNc(13,M,3,3,"clr-control-error",10),e.qZA()(),e.TgZ(14,"div",2)(15,"label",3),e._uU(16),e.ALo(17,"translate"),e.qZA(),e.TgZ(18,"div",4)(19,"div",5)(20,"input",11,12),e.NdJ("ngModelChange",function(a){return r.newUser.email=a})("input",function(){return r.handleValidation("email",!1)})("blur",function(){return r.handleValidation("email",!0)}),e.qZA(),e._UZ(22,"clr-icon",8)(23,"span",9),e.YNc(24,U,3,3,"clr-control-helper",10),e.YNc(25,O,3,3,"clr-control-error",10),e.qZA()()(),e.TgZ(26,"clr-input-container")(27,"label",13),e._uU(28),e.ALo(29,"translate"),e.qZA(),e.TgZ(30,"input",14,15),e.NdJ("ngModelChange",function(a){return r.newUser.realname=a})("input",function(){return r.handleValidation("realname",!1)})("blur",function(){return r.handleValidation("realname",!0)}),e.qZA(),e.YNc(32,o,3,3,"clr-control-error",10),e.qZA(),e.TgZ(33,"div",2)(34,"label",16),e._uU(35),e.ALo(36,"translate"),e.qZA(),e.TgZ(37,"div",4)(38,"div",5)(39,"input",17,18),e.NdJ("ngModelChange",function(a){return r.newUser.password=a})("input",function(){return r.handleValidation("newPassword",!1)})("blur",function(){return r.handleValidation("newPassword",!0)}),e.qZA(),e.YNc(41,s,1,0,"clr-icon",19),e.YNc(42,f,1,0,"clr-icon",20),e._UZ(43,"clr-icon",8),e.qZA(),e.YNc(44,d,3,3,"clr-control-helper",10),e.YNc(45,E,3,3,"clr-control-error",10),e.qZA()(),e.TgZ(46,"div",2)(47,"label",21),e._uU(48),e.ALo(49,"translate"),e.qZA(),e.TgZ(50,"div",4)(51,"div",5)(52,"input",22,23),e.NdJ("ngModelChange",function(a){return r.confirmedPwd=a})("input",function(){return r.handleValidation("confirmPassword",!1)})("blur",function(){return r.handleValidation("confirmPassword",!0)}),e.qZA(),e.YNc(54,I,1,0,"clr-icon",19),e.YNc(55,v,1,0,"clr-icon",20),e._UZ(56,"clr-icon",8),e.qZA(),e.YNc(57,F,3,3,"clr-control-error",10),e.qZA()(),e.TgZ(58,"clr-input-container")(59,"label"),e._uU(60),e.ALo(61,"translate"),e.qZA(),e.TgZ(62,"input",24,25),e.NdJ("ngModelChange",function(a){return r.newUser.comment=a})("input",function(){return r.handleValidation("comment",!1)})("blur",function(){return r.handleValidation("comment",!0)}),e.qZA(),e.YNc(64,Z,3,3,"clr-control-error",10),e.qZA()()()),2&n&&(e.xp6(5),e.Oqu(e.lcZ(6,36,"PROFILE.USER_NAME")),e.xp6(2),e.ekj("clr-error",r.getValidationState("username")),e.xp6(2),e.Q6J("ngModel",r.newUser.username),e.xp6(3),e.Q6J("hidden",r.isChecking("username")),e.xp6(1),e.Q6J("ngIf",r.getValidationState("username")),e.xp6(3),e.Oqu(e.lcZ(17,38,"PROFILE.EMAIL")),e.xp6(2),e.ekj("clr-error",r.getValidationState("email")),e.xp6(2),e.Q6J("ngModel",r.newUser.email),e.xp6(3),e.Q6J("hidden",r.isChecking("email")),e.xp6(1),e.Q6J("ngIf",r.isSelfRegistration),e.xp6(1),e.Q6J("ngIf",r.getValidationState("email")),e.xp6(3),e.Oqu(e.lcZ(29,40,"PROFILE.FULL_NAME")),e.xp6(2),e.Q6J("ngModel",r.newUser.realname),e.xp6(2),e.Q6J("ngIf",r.getValidationState("realname")),e.xp6(3),e.Oqu(e.lcZ(36,42,"PROFILE.PASSWORD")),e.xp6(2),e.ekj("clr-error",r.getValidationState("newPassword")),e.xp6(2),e.Q6J("type",r.showNewPwd?"text":"password")("ngModel",r.newUser.password),e.xp6(2),e.Q6J("ngIf",!r.showNewPwd),e.xp6(1),e.Q6J("ngIf",r.showNewPwd),e.xp6(2),e.Q6J("ngIf",r.isSelfRegistration),e.xp6(1),e.Q6J("ngIf",r.getValidationState("newPassword")),e.xp6(3),e.Oqu(e.lcZ(49,44,"CHANGE_PWD.CONFIRM_PWD")),e.xp6(2),e.ekj("clr-error",r.getValidationState("confirmPassword")),e.xp6(2),e.Q6J("type",r.showConfirmPwd?"text":"password")("ngModel",r.confirmedPwd),e.xp6(2),e.Q6J("ngIf",!r.showConfirmPwd),e.xp6(1),e.Q6J("ngIf",r.showConfirmPwd),e.xp6(2),e.Q6J("ngIf",r.getValidationState("confirmPassword")),e.xp6(3),e.Oqu(e.lcZ(61,46,"PROFILE.COMMENT")),e.xp6(2),e.Q6J("ngModel",r.newUser.comment),e.xp6(2),e.Q6J("ngIf",r.getValidationState("comment")))},dependencies:[_._Y,_.Fj,_.JJ,_.JL,_.Q7,_.c5,_.on,_.On,_.F,m.O5,w.qvL,w.MgK,w.VqA,w.CM6,w.xRP,w.G55,g.GA,P.X$],styles:[".label-info[_ngcontent-%COMP%]{margin:-5px 0 0!important;padding:0!important}.spinner-pos[_ngcontent-%COMP%]{margin-right:0!important;top:2px}.pw-eye[_ngcontent-%COMP%]{margin-left:-24px;margin-right:8px;cursor:pointer}.pwd-input[_ngcontent-%COMP%]{padding-right:26px;width:228px}",".form-group-override[_ngcontent-%COMP%]{padding-left:170px!important}.form-group-label-override[_ngcontent-%COMP%]{font-size:14px;font-weight:400}.sub-label-for-input[_ngcontent-%COMP%]{position:absolute;top:26px;font-size:10px;font-weight:400;line-height:12px;left:170px}.body-format[_ngcontent-%COMP%]{overflow-y:hidden}.loading-top[_ngcontent-%COMP%]{top:8px}"]}),t})()}}]);